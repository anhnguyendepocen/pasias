## Sparrowhawks



 One of nature's patterns is the relationship
between the percentage of adult birds in a colony that return from the
previous year, and the number of new adults that join the colony. Data
for 13 colonies of sparrowhawks can be found at
[http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt](http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt). The
columns are the percentage of adults returning from the previous year,
and the number of new adults that join the colony.



(a) Create a new R Markdown report, give it a suitable title, and
ask for HTML output. Answer the questions that follow in your
report. At any stage, you can Knit HTML
to see how the report looks so far.


Solution


In R Studio, select File, New File, R Markdown. Fill in the Title,
Author and leave the Default Output Format at HTML. You'll see a
template report with the document info at the top. This is mine:

```

---
title: "Sparrowhawks"
author: "Ken Butler"
date: "October 13, 2015"
output: html_document
---

```

This is known in the jargon as a "YAML block".\endnote{YAML
stands for "yet another markup language", but we're not using
it in this course, other than as the top bit of an R Markdown document.}
Below that is the template R Markdown document. You can copy and cut it,
or leave it lying around for reminders and delete it later. Up to you.



(b) Read in the data and display all the values (there are only 13
rows, so this is OK). Add some text saying how many rows of data
there are.


Solution


Copy the data as usual to a file that R Studio can find. In your
report, add some text like "we read in the data", perhaps
after a section heading like "The data". Then add a \emph{code
chunk} by selecting Chunks and Insert Chunk, or by pressing
control-alt-I. So far you have something like this. (I'm using level-3 headings, for annoying technical reasons, but you should probably use second-level headings.)

```

### The data

We begin by reading in the data.

```{r}

```

```

Inside the code chunk, that is, in the bit between the
backtick characters, put R code, just as you would type it at
the Console or put in an  R script. In this case, that would be
the following code, minus the message that comes out of
`read_delim`: 
```{r results="hide"}
library(tidyverse)
my_url="http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt"
sparrowhawks=read_delim(my_url," ")
sparrowhawks
```     
For you, it looks like this:


```

The data
========
We begin by reading in the data, and loading in our usual stuff (for
use later):
```{r}
library(tidyverse)
my_url="http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt"
sparrowhawks=read_delim(my_url," ")
sparrowhawks
```

There are xxx rows of data altogether.

```

We don't know how many rows of data there are yet, so I've left a
"placeholder" for it, when we figure it out.
The file is annoyingly called `sparrowhawk.txt`,
singular. Sorry about that. 
If you knit this (click on "Knit HTML" next to the ball of wool,
or press control-shift-K), it should run, and you'll see a viewer
pop up with the HTML output. Now you can see how many rows there
are, and you can go back and edit the R Markdown and put in 13 in
place of `xxx`, and knit again.
You might be worried about how hard R is working with all this
knitting. Don't worry about that. R can take it.
Mine looked like this:

![](waluj.png)

There is a better way of adding values that come from the output,
which I mention here in case you are interested (if you are not,
feel free to skip this). What you do is to make what is called an
"inline code chunk". Where you want a number to appear in the
text, you have some R Markdown that looks like this:

```

There are `r nrow(sparrowhawks)` rows altogether.

```

The piece inside the backticks is the letter `r`, a space,
and then one line of R code. The one line of code will be run, and
all of the stuff within the backticks will be replaced in the
output by the result of running the R code, in this case the
number 13. Typically, you are extracting a number from the data,
like the number of rows or a mean of something. If it's a decimal
number, it will come out with a lot of decimal places unless you
explicitly `round` it.
OK, let me try it: the data frame has `r nrow(sparrowhawks)`
rows altogether. I didn't type that number; it was calculated from
the data frame. Woo hoo!



(c) Create a new section entitled "Exploratory analysis", and
create a scatterplot for predicting number of new adults from the
percentage of returning adults.  Describe what you see, adding some
suitable text to your report.


Solution


The R code you add should look like this, with the results shown
(when you knit the report again):
```{r }
library(tidyverse)
ggplot(sparrowhawks,aes(x=returning,y=newadults))+
geom_point()+geom_smooth()
``` 
The piece of report that I added looks like this:


```

### Exploratory analysis

We should look at a scatterplot of the data, to see what, if any,
relationship there is. We add a smooth trend, to guide the eye:

```{r}
ggplot(sparrowhawks,aes(x=returning,y=newadults))+
geom_point()+geom_smooth()
```

This seems to be something of a downward trend, though it is not
completely convincing.  That is, a larger percentage of returning
adults is associated with a *smaller* number of new adults. Is the
relationship straight? Well, the smooth trend has a strange
wiggle in the middle, but the trend overall does not seem
obviously curved. 

```


Note (i) that you have to do nothing special to get the plot to
appear, and (ii) that I put "smaller" in italics, and you see
how. 



(d) Obtain the correlation between the two variables. Is this
consistent with the scatterplot? Explain briefly. (The R function
you need is `cor`. You can feed it a data frame.)


Solution


The appropriate R code  is this, in another code chunk:
```{r }
with(sparrowhawks,cor(newadults,returning))
``` 

Or you can ask for the correlations of the whole data frame:

```{r }
cor(sparrowhawks)
``` 

This latter is a "correlation matrix" with a correlation between each
column and each other column. Obviously the correlation between a
column and itself is 1, and that is *not* the one we want.

I added this to the report (still in the Exploratory Analysis
section, since it seems to belong there):

```

What is the correlation between these two variables?

```{r}
with(sparrowhawks,cor(newadults,returning))
```

The correlation is about -0.75. This seems surprisingly close to -1 to me, since I
didn't think the trend was that strong, but it is no surprise that the correlation
is negative, since the trend is definitely downward rather than
upward. 

```




(e) Obtain the regression line for predicting the number of new
adults from the percentage of returning adults.


Solution


This R code, in another code chunk:
```{r }
newadults.1=lm(newadults~returning,data=sparrowhawks)
summary(newadults.1)  
``` 



(f) What are the intercept and slope of your regression line? Is
the slope significant? What does that mean, in the context of the data?


Solution


See the output in the previous part. That's what we need to talk about.
I added this to the report. I thought we deserved a new section here:

```

### Regression analysis
The regression for predicting the number of new adults from the
percentage of returning adults is as shown: 

```{r}
newadults.1=lm(newadults~returning,data=sparrowhawks)
summary(newadults.1)
```

The intercept is about 32 and the slope is about -0.3. This means that
each additional one percentage point in returning adults is associated
with a *decrease* of approximately 0.3 new adults.  

The P-value attached to the slope is about 0.003. This means that the
slope is *not* zero, and that there is a significant association
between the number of returning adults and the number of new
adults. (This is despite the apparently weak trend, and the small
number, 13, of data points.) 

```




(g) Create a scatterplot of the data with the regression line on it.


Solution


This code. Using `geom_smooth= with `method`"lm"`
will add the regression line to the plot:

```{r }
ggplot(sparrowhawks,aes(x=returning,y=newadults))+
geom_point()+geom_smooth(method="lm")
``` 

I added a bit of text to the report, which I will show in a moment.



(h) For short-lived birds, the association between these two
variables is positive: changes in weather and food supply cause the
populations of new and returning birds to increase together. For
long-lived territorial birds, however, the association is negative
because returning birds claim their territories in the colony and do
not leave room for new recruits. Which type of species is the
sparrowhawk? Add a short Conclusions section to your report with
discussion of this issue.


Solution


My addition to the report looks like this:


```

A plot of the data with the regression line superimposed is as shown:

```{r}
ggplot(sparrowhawks,aes(x=returning,y=newadults))+
geom_point()+geom_smooth(method="lm")
```

### Conclusions
The association is negative, as seen from the scatterplot and
correlation, and also from the negative slope of the regression
line. This suggests that sparrowhawks are long-lived territorial
birds rather than short-lived birds. We would expect to observe
returning birds displaying territorial behaviour that would
discourage new adults from joining the colony.

```


I think that rounds off the report nicely. 




