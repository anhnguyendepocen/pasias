<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2018-10-09" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li class="has-sub"><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a><ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
</ul></li>
<li class="has-sub"><a href="reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">3</span> Reading in data and drawing some graphs</a><ul>
<li><a href="reading-in-data-and-drawing-some-graphs.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">4.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">4.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">4.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">4.4</span> Computerized accounting</a></li>
</ul></li>
<li class="has-sub"><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">5</span> One-sample inference</a><ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">5.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">5.2</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">5.3</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">6</span> Two-sample inference</a><ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">6.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">6.2</span> Parking close to the curb</a></li>
</ul></li>
<li class="has-sub"><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">7</span> Power and sample size</a><ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">7.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">7.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">7.3</span> Simulating power for proportions</a></li>
</ul></li>
<li class="has-sub"><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">8</span> The sign test and Mood’s median test</a><ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">8.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">8.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">8.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">8.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">8.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">8.6</span> Medical instructions</a></li>
</ul></li>
<li class="has-sub"><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">9</span> Matched pairs t and sign test</a><ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">9.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">9.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">9.3</span> Changes in salary</a></li>
</ul></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">10</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">10.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">10.2</span> Ferritin and normality</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">11</span> Analysis of variance</a><ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">11.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">11.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">11.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">11.4</span> Atomic weight of carbon</a></li>
</ul></li>
<li class="has-sub"><a href="tidying-and-selecting-data.html#tidying-and-selecting-data"><span class="toc-section-number">12</span> Tidying and selecting data</a><ul>
<li><a href="tidying-and-selecting-data.html#tidying-the-jays-data"><span class="toc-section-number">12.1</span> Tidying the Jays data</a></li>
<li><a href="tidying-and-selecting-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">12.2</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-and-selecting-data.html#growth-of-tomatoes"><span class="toc-section-number">12.3</span> Growth of tomatoes</a></li>
<li><a href="tidying-and-selecting-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">12.4</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-and-selecting-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">12.5</span> Location, species and disease in plants</a></li>
<li><a href="tidying-and-selecting-data.html#kens-cars"><span class="toc-section-number">12.6</span> Ken’s cars</a></li>
<li><a href="tidying-and-selecting-data.html#number-1-songs"><span class="toc-section-number">12.7</span> Number 1 songs</a></li>
</ul></li>
<li class="has-sub"><a href="regression.html#regression"><span class="toc-section-number">13</span> Regression</a><ul>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">13.1</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">13.2</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">13.3</span> Sparrowhawks</a></li>
</ul></li>
<li class="has-sub"><a href="the-data.html#the-data"><span class="toc-section-number">14</span> The data</a><ul>
<li><a href="the-data.html#exploratory-analysis"><span class="toc-section-number">14.0.1</span> Exploratory analysis</a></li>
<li><a href="the-data.html#regression-analysis"><span class="toc-section-number">14.0.2</span> Regression analysis</a></li>
<li><a href="the-data.html#conclusions"><span class="toc-section-number">14.0.3</span> Conclusions</a></li>
<li><a href="the-data.html#salaries-of-social-workers"><span class="toc-section-number">14.1</span> Salaries of social workers</a></li>
<li><a href="the-data.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">14.2</span> Predicting volume of wood in pine trees</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="tidying-and-selecting-data" class="section level1">
<h1><span class="header-section-number">Chapter 12</span> Tidying and selecting data</h1>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb722-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="tidying-the-jays-data" class="section level2">
<h2><span class="header-section-number">12.1</span> Tidying the Jays data</h2>
<p>This question is about the Blue Jays data set (that I used
in class).</p>
<ol style="list-style-type: lower-alpha">
<li>The Blue Jays baseball data set is at
<a href="http://www.utsc.utoronto.ca/~butler/c32/jays15-home.csv" class="uri">http://www.utsc.utoronto.ca/~butler/c32/jays15-home.csv</a>. Read
it into R. Check that you have 25 rows and a bunch of variables.</li>
</ol>
<p>Solution</p>
<p>Save the URL into a variable and then read from the URL, using
<code>read_csv</code> because it’s a <code>.csv</code> file:</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1">myurl=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/jays15-home.csv&quot;</span></a>
<a class="sourceLine" id="cb726-2" data-line-number="2">jays=<span class="kw">read_csv</span>(myurl)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   row = col_integer(),
##   game = col_integer(),
##   runs = col_integer(),
##   Oppruns = col_integer(),
##   innings = col_integer(),
##   position = col_integer(),
##   `game time` = col_time(format = &quot;&quot;),
##   attendance = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb729-1" data-line-number="1">jays</a></code></pre></div>
<pre><code>## # A tibble: 25 x 21
##      row  game date  box   team  venue opp   result  runs Oppruns innings
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;   &lt;int&gt;   &lt;int&gt;
##  1    82     7 Mond… boxs… TOR   &lt;NA&gt;  TBR   L          1       2      NA
##  2    83     8 Tues… boxs… TOR   &lt;NA&gt;  TBR   L          2       3      NA
##  3    84     9 Wedn… boxs… TOR   &lt;NA&gt;  TBR   W         12       7      NA
##  4    85    10 Thur… boxs… TOR   &lt;NA&gt;  TBR   L          2       4      NA
##  5    86    11 Frid… boxs… TOR   &lt;NA&gt;  ATL   L          7       8      NA
##  6    87    12 Satu… boxs… TOR   &lt;NA&gt;  ATL   W-wo       6       5      10
##  7    88    13 Sund… boxs… TOR   &lt;NA&gt;  ATL   L          2       5      NA
##  8    89    14 Tues… boxs… TOR   &lt;NA&gt;  BAL   W         13       6      NA
##  9    90    15 Wedn… boxs… TOR   &lt;NA&gt;  BAL   W          4       2      NA
## 10    91    16 Thur… boxs… TOR   &lt;NA&gt;  BAL   W          7       6      NA
## # ... with 15 more rows, and 10 more variables: wl &lt;chr&gt;, position &lt;int&gt;,
## #   gb &lt;chr&gt;, winner &lt;chr&gt;, loser &lt;chr&gt;, save &lt;chr&gt;, `game time` &lt;time&gt;,
## #   Daynight &lt;chr&gt;, attendance &lt;int&gt;, streak &lt;chr&gt;</code></pre>
<p>If you must, copy and paste the spreadsheet into R Studio, and read it
in with <code>read_delim</code> (or possibly <code>read_tsv</code>), but
this runs the risk of being defeated by spreadsheet cells that contain
spaces. I don’t think there are any here, but you might run into a
pitcher whose name has more than one word, like (Andy) Van Hekken, who
is in the Seattle Mariners farm system.
<label for="tufte-mn-32" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-32" class="margin-toggle"><span class="marginnote">I found this by googling, after I had scrolled past all the pages of articles about the baseball pitcher who <em>lives</em> in a van.</span></p>
<p>Anyway, 25 rows and 21 columns. As usual, it’s a tibble, so you see 10
rows and as many columns as will fit. This is often enough to see
whether we have the right thing (as we appear to have, here). You can
run through all the columns and check that they’re the right kind of
thing; most of them are text with a few numbers and one <code>time</code>,
which is <code>game time</code>, the length of the game in hours and
minutes, which is turned into an R <code>time</code> in hours, minutes and
seconds.</p>
<p>With all those columns, <code>read_csv</code> doesn’t tell you what
column specification it inferred for all of them, but you can type</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb731-1" data-line-number="1"><span class="kw">spec</span>(jays)</a></code></pre></div>
<pre><code>## cols(
##   row = col_integer(),
##   game = col_integer(),
##   date = col_character(),
##   box = col_character(),
##   team = col_character(),
##   venue = col_character(),
##   opp = col_character(),
##   result = col_character(),
##   runs = col_integer(),
##   Oppruns = col_integer(),
##   innings = col_integer(),
##   wl = col_character(),
##   position = col_integer(),
##   gb = col_character(),
##   winner = col_character(),
##   loser = col_character(),
##   save = col_character(),
##   `game time` = col_time(format = &quot;&quot;),
##   Daynight = col_character(),
##   attendance = col_integer(),
##   streak = col_character()
## )</code></pre>
<p>to find it all out.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Pick out only the games that were against the New York Yankees
(the variable <code>opp</code> is equal to <code>NYY</code>). Investigate all
the columns. What do you notice about these games?</li>
</ol>
<p>Solution</p>
<p>I get to do this:</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb733-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(opp<span class="op">==</span><span class="st">&quot;NYY&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">width=</span><span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 21
##     row  game date             box      team  venue opp   result  runs
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;
## 1    92    27 Monday, May 4    boxscore TOR   &lt;NA&gt;  NYY   W          3
## 2    93    28 Tuesday, May 5   boxscore TOR   &lt;NA&gt;  NYY   L          3
## 3    94    29 Wednesday, May 6 boxscore TOR   &lt;NA&gt;  NYY   W          5
##   Oppruns innings wl    position gb    winner  loser    save   `game time`
##     &lt;int&gt;   &lt;int&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;time&gt;     
## 1       1      NA 13-14        4 3.5   Dickey  Martin   Cecil  02:18      
## 2       6      NA 13-15        5 4.5   Pineda  Estrada  Miller 02:54      
## 3       1      NA 14-15        3 3.5   Buehrle Sabathia &lt;NA&gt;   02:30      
##   Daynight attendance streak
##   &lt;chr&gt;         &lt;int&gt; &lt;chr&gt; 
## 1 N             19217 +     
## 2 N             21519 -     
## 3 N             21312 +</code></pre>
<p>but you will probably need to click the little right-arrow at the top
to see more columns.</p>
<p>I forgot the <code>width</code> thing and had to look it up. Also, all the
columns come out in one row, so I had to display it tiny so that you
could see it all.</p>
<p>What I notice is that these games are all on consecutive nights
(against the same team). This is quite common, and goes back to the
far-off days when teams travelled by train: teams play several games
on one visit, rather than coming back many times. You might have noticed something else;
that’s fine for this. For example, ``each of the games lasted less
than three hours’’, or “the attendances were all small” (since we
looked at all the attendances in class). I just want you to notice
something meaningful that seems to be interesting about these games.</p>
<p>You could also print all the columns in two or more goes, using
<code>select</code>, for example:</p>
<div class="sourceCode" id="cb735"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb735-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(opp<span class="op">==</span><span class="st">&quot;NYY&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(row<span class="op">:</span>innings) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">width=</span><span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##     row  game date             box      team  venue opp   result  runs
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;
## 1    92    27 Monday, May 4    boxscore TOR   &lt;NA&gt;  NYY   W          3
## 2    93    28 Tuesday, May 5   boxscore TOR   &lt;NA&gt;  NYY   L          3
## 3    94    29 Wednesday, May 6 boxscore TOR   &lt;NA&gt;  NYY   W          5
##   Oppruns innings
##     &lt;int&gt;   &lt;int&gt;
## 1       1      NA
## 2       6      NA
## 3       1      NA</code></pre>
<div class="sourceCode" id="cb737"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb737-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(opp<span class="op">==</span><span class="st">&quot;NYY&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(wl<span class="op">:</span>streak) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">print</span>(<span class="dt">width=</span><span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 10
##   wl    position gb    winner  loser    save   `game time` Daynight
##   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;time&gt;      &lt;chr&gt;   
## 1 13-14        4 3.5   Dickey  Martin   Cecil  02:18       N       
## 2 13-15        5 4.5   Pineda  Estrada  Miller 02:54       N       
## 3 14-15        3 3.5   Buehrle Sabathia &lt;NA&gt;   02:30       N       
##   attendance streak
##        &lt;int&gt; &lt;chr&gt; 
## 1      19217 +     
## 2      21519 -     
## 3      21312 +</code></pre>
<ol start="3" style="list-style-type: lower-alpha">
<li>From the whole data frame, pick out only the games where the
attendance was more than 30,000, showing only the columns
<code>attendance</code> and <code>Daynight</code>. How many of them are there
(just count them)? How many are day games and how many night games
(just count those too)?</li>
</ol>
<p>Solution</p>
<p>Two steps, since we selecting rows <em>and</em> columns:</p>
<div class="sourceCode" id="cb739"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb739-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(attendance<span class="op">&gt;</span><span class="dv">30000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb739-2" data-line-number="2"><span class="kw">select</span>(<span class="kw">c</span>(attendance,Daynight))</a></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   attendance Daynight
##        &lt;int&gt; &lt;chr&gt;   
## 1      48414 N       
## 2      34743 D       
## 3      44794 D       
## 4      30430 N       
## 5      42917 D       
## 6      42419 D       
## 7      33086 D       
## 8      37929 D</code></pre>
<p>The column names do not need quotes; this is part of the nice stuff
about <code>dplyr</code>. Or this way, since we are selecting
<em>consecutive</em> columns:</p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb741-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(attendance<span class="op">&gt;</span><span class="dv">30000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb741-2" data-line-number="2"><span class="kw">select</span>(<span class="kw">c</span>(Daynight<span class="op">:</span>attendance))  </a></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   Daynight attendance
##   &lt;chr&gt;         &lt;int&gt;
## 1 N             48414
## 2 D             34743
## 3 D             44794
## 4 N             30430
## 5 D             42917
## 6 D             42419
## 7 D             33086
## 8 D             37929</code></pre>
<p>There are eight games selected (see the eight rows in the
result). Only two of them are night games, while the other six are day
(weekend) games.</p>
<p>If you wanted to, you could automate the counting, like this:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb743-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(attendance<span class="op">&gt;</span><span class="dv">30000</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb743-2" data-line-number="2"><span class="kw">count</span>(Daynight)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Daynight     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 D            6
## 2 N            2</code></pre>
<p>Six day games and two night games.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Display the mean and standard deviation of attendances at all
day and night games.</li>
</ol>
<p>Solution</p>
<p>Two steps: the grouping according to what I want to group by, then
summarizing according to what I want to summarize by. Since I am
summarizing, only the summaries find their way into the final data
frame, so I don’t need to “select out” the other variables:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb745-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Daynight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb745-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">mean.att=</span><span class="kw">mean</span>(attendance),</a>
<a class="sourceLine" id="cb745-3" data-line-number="3"><span class="dt">sd.att=</span><span class="kw">sd</span>(attendance))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   Daynight mean.att sd.att
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
## 1 D          37885.  5775.
## 2 N          20087.  8084.</code></pre>
<p>The mean attendances are about 38 thousand and about 20 thousand. Note
that the night games have much the larger SD, possibly because of the
large outlier night attendance (opening night). Which we can also
investigate.</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb747-1" data-line-number="1">jays <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Daynight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb747-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">median.att=</span><span class="kw">median</span>(attendance),</a>
<a class="sourceLine" id="cb747-3" data-line-number="3"><span class="dt">iqr.att=</span><span class="kw">IQR</span>(attendance))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   Daynight median.att iqr.att
##   &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;
## 1 D            37929    8754.
## 2 N            17928.   6005.</code></pre>
<p>This time, the night attendances have a <em>smaller</em> spread and a
noticeably smaller median (compared to the mean), so it must have been
the outlier that made the difference. There was another high value
that R marked as an outlier:</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb749-1" data-line-number="1"><span class="kw">ggplot</span>(jays,<span class="kw">aes</span>(<span class="dt">x=</span>Daynight,<span class="dt">y=</span>attendance))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="11-tidying-and-selecting-data_files/figure-html/unnamed-chunk-11-1.png" width="672"  /></p>
<p>So when you take away those unusual values, the night game attendances
are indeed less variable.</p>
<p>The right test, as you might have guessed, for comparing the medians
of these non-normal data, is Mood’s median test:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb750-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb750-2" data-line-number="2"><span class="kw">median_test</span>(jays,attendance,Daynight)</a></code></pre></div>
<pre><code>## $table
##      above
## group above below
##     D     7     0
##     N     5    12
## 
## $test
##        what       value
## 1 statistic 9.882352941
## 2        df 1.000000000
## 3   P-value 0.001668714</code></pre>
<p>There was one attendance exactly equal to the overall median (as you
would expect: with an odd number of data values, the median is one of
the data values). <code>smmr</code> removed it; if you did the test by
hand, what happens to it depends on whether you counted aboves or
belows, and this will have a small effect on the P-value, though not
on the conclusion.</p>
<p>The overall median attendance was 21,000, and <em>none</em> of the day
games had attendance less than that. With the small frequencies, the
accuracy of the P-value is a bit questionable, but taking it at face
value, there <em>is</em> a significant difference between median
attendances at day and night games.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Make normal quantile plots of the day attendances and the night
attendances, separately. Do you see any evidence of non-normality?
(You would expect to on the night attendances because of the big
opening-night value.)</li>
</ol>
<p>Solution</p>
<p>The best way to do this is facetted normal quantile
plots. Remember that the facetting part goes right at the end:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb752-1" data-line-number="1"><span class="kw">ggplot</span>(jays,<span class="kw">aes</span>(<span class="dt">sample=</span>attendance))<span class="op">+</span></a>
<a class="sourceLine" id="cb752-2" data-line-number="2"><span class="kw">stat_qq</span>()<span class="op">+</span><span class="kw">stat_qq_line</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb752-3" data-line-number="3"><span class="kw">facet_wrap</span>(<span class="op">~</span>Daynight,<span class="dt">ncol=</span><span class="dv">1</span>)</a></code></pre></div>
<p><img src="11-tidying-and-selecting-data_files/figure-html/unnamed-chunk-13-1.png" width="672"  />
The day attendances are pretty normal, though it is hard to be sure
with only 7 of them.</p>
<p>The night attendances are not normal. The lone point top right is the
outlier. On top of that, the lowest attendances are not quite low enough and
the second-highest attendance is a bit too high, so there is a bit of
evidence of right-skewness as well as just the one outlier.</p>
<p>If you leave out the <code>ncol=1</code>, you’ll get the two normal
quantile plots side by side (which means that each one is tall and
skinny, and thus hard to read). The <code>ncol=1</code> displays all the
facets in <em>one</em> column, and though it would be nice to have the
graphs be about square, landscape mode is easier to read than portrait
mode.</p>
<p>One of the reasons for skewness is often a limit on the values of the
variable. The Rogers Centre has a capacity around 55,000. The day game
attendances don’t get especially close to that, which suggests that
everyone who wants to go to the game can get a ticket. In that sort of
situation, you’d expect attendances to vary around a “typical”
value, with a random deviation that depends on things like the weather
and the opposing team, which is the typical situation in which you get
bell-shaped data. (If the Jays often sold out their stadium for day
games, you’d see a lot of attendances close to the capacity, with a
few lower: ie., a left skew.)</p>
<p>As for the night games, well, there seems to be a minimum attendance
that the Blue Jays get, somewhere around 15,000: no matter who they’re
playing or what the weather’s like, this many people will show up
(season-ticket holders, for example). On special occasions, such as
opening night, the attendance will be much bigger, which points to a
<em>right</em> skew.</p>
</div>
<div id="ethanol-and-sleep-time-in-rats" class="section level2">
<h2><span class="header-section-number">12.2</span> Ethanol and sleep time in rats</h2>
<p>A biologist wished to study the effects of ethanol on sleep
time in rats. A sample of 20 rats (all the same age) was selected, and
each rat was given an injection having a particular concentration (0,
1, 2 or 4 grams per kilogram of body weight) of ethanol. These are
labelled <code>e0, e1, e2, e4</code>. The “0”
treatment was a control group. The rapid eye movement (REM) sleep time
was then recorded for each rat. The data are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/ratsleep.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/ratsleep.txt</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data in from the file. Check that you have four rows
of observations and five columns of sleep times.</li>
</ol>
<p>Solution</p>
<p>Separated by single spaces:</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb753-1" data-line-number="1">sleep1=<span class="kw">read_delim</span>(<span class="st">&quot;ratsleep.txt&quot;</span>,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   treatment = col_character(),
##   obs1 = col_double(),
##   obs2 = col_double(),
##   obs3 = col_double(),
##   obs4 = col_double(),
##   obs5 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb755-1" data-line-number="1">sleep1</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   treatment  obs1  obs2  obs3  obs4  obs5
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 e0         88.6  73.2  91.4  68    75.2
## 2 e1         63    53.9  69.2  50.1  71.5
## 3 e2         44.9  59.5  40.2  56.3  38.7
## 4 e4         31    39.6  45.3  25.2  22.7</code></pre>
<p>There are six columns, but one of them labels the groups, and there
are correctly five columns of sleep times.</p>
<p>I used a “temporary” name for my data frame, because I’m going to be
doing some processing on it in a minute, and I want to reserve the
name <code>sleep</code> for my processed data frame.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Unfortunately, the data are in the wrong format. All the sleep
times for each treatment group are on one row, and we should have
<em>one</em> column containing <em>all</em> the sleep times, and the
corresponding row should show which treatment group that sleep time
came from.
If you prefer to skip this part: read in the data from
<a href="http://www.utsc.utoronto.ca/~butler/c32/ratsleep2.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/ratsleep2.txt</a>, and
proceed to the boxplots in (c).
The <code>tidyr</code> function <code>gather</code> turns wide format (which
we have) into long format (which we want). <code>gather</code> needs
four things fed into it: a data frame, what makes the columns
different, what makes them the same, and finally which columns are
to be <code>gather</code>ed together (combined into one column), the
first one, a colon, and the last one. Save the result of
<code>gather</code> into a data frame, and look at it. Do you have 20
rows of not-very-many variables?</li>
</ol>
<p>Solution</p>
<p>What makes the columns <code>obs1</code> through <code>obs5</code>
different is that they are different observation numbers
(“replicates”, in the jargon). I’ll call that <code>rep</code>. What
makes them the same is that they are all sleep times. Columns
<code>obs1</code> through <code>obs5</code> are the ones we want to
combine, thus.
Here is where I use the name <code>sleep</code>: I save the result of
the <code>gather</code> into a data frame <code>sleep</code>. Note that I
also used the brackets-around-the-outside to display what I had,
so that I didn’t have to do a separate display. This is a handy
way of saving <em>and</em> displaying in one shot:</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb757-1" data-line-number="1">(sleep1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(rep,sleeptime,obs1<span class="op">:</span>obs5) -&gt;<span class="st"> </span>sleep)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    treatment rep   sleeptime
##    &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt;
##  1 e0        obs1       88.6
##  2 e1        obs1       63  
##  3 e2        obs1       44.9
##  4 e4        obs1       31  
##  5 e0        obs2       73.2
##  6 e1        obs2       53.9
##  7 e2        obs2       59.5
##  8 e4        obs2       39.6
##  9 e0        obs3       91.4
## 10 e1        obs3       69.2
## 11 e2        obs3       40.2
## 12 e4        obs3       45.3
## 13 e0        obs4       68  
## 14 e1        obs4       50.1
## 15 e2        obs4       56.3
## 16 e4        obs4       25.2
## 17 e0        obs5       75.2
## 18 e1        obs5       71.5
## 19 e2        obs5       38.7
## 20 e4        obs5       22.7</code></pre>
<p>We have 20 rows of 3 columns. I got all the rows, but you will
probably get an output with ten rows as usual, and will need to click
Next to see the last ten rows. The initial display will say how many
rows (20) and columns (3) you have.</p>
<p>The column <code>rep</code> is not very interesting: it just says which
observation each one was within its group. The interesting things are <code>treatment</code> and
<code>sleeptime</code>, which are the two variables we’ll need for our
analysis of variance.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Using your new data frame, make side-by-side boxplots of sleep
time by treatment group.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb759-1" data-line-number="1"><span class="kw">ggplot</span>(sleep,<span class="kw">aes</span>(<span class="dt">x=</span>treatment,<span class="dt">y=</span>sleeptime))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="11-tidying-and-selecting-data_files/figure-html/unnamed-chunk-16-1.png" width="672"  /></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>In your boxplots, how does the median sleep time appear to
depend on treatment group?</li>
</ol>
<p>Solution</p>
<p>It appears to <em>decrease</em> as the dose of ethanol increases,
and pretty substantially so (in that the differences ought to be
significant, but that’s coming up).</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>There is an assumption about spread that the analysis of
variance needs in order to be reliable. Do your boxplots indicate that
this assumption is satisfied for these data, bearing in mind that you
have only five observations per group?</li>
</ol>
<p>Solution</p>
<p>The assumption is that the population SDs of each group are all
equal. Now, the boxplots show IQRs, which are kind of a surrogate
for SD, and because we only have five observations per group to
base the IQRs on, the <em>sample</em> IQRs might vary a bit. So we
should look at the heights of the boxes on the boxplot, and see
whether they are grossly unequal. They appear to be to be of very
similar heights, all things considered, so I am happy.
If you want the SDs themselves:</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb760-1" data-line-number="1">sleep <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(treatment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb760-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">stddev=</span><span class="kw">sd</span>(sleeptime))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   treatment stddev
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 e0         10.2 
## 2 e1          9.34
## 3 e2          9.46
## 4 e4          9.56</code></pre>
<p>Those are <em>very</em> similar, given only 5 observations per group. No
problems here.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Run an analysis of variance to see whether sleep time differs
significantly among treatment groups. What do you conclude?</li>
</ol>
<p>Solution</p>
<p>I use <code>aov</code> here, because I might be following up with
Tukey in a minute:</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb762-1" data-line-number="1">sleep<span class="fl">.1</span>=<span class="kw">aov</span>(sleeptime<span class="op">~</span>treatment,<span class="dt">data=</span>sleep)  </a>
<a class="sourceLine" id="cb762-2" data-line-number="2"><span class="kw">summary</span>(sleep<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## treatment    3   5882    1961   21.09 8.32e-06 ***
## Residuals   16   1487      93                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This is a very small P-value, so my conclusion is that the mean sleep
times are not all the same for the treatment groups. Further than that
I am not entitled to say (yet).</p>
<p>The technique here is to save the output from <code>aov</code> in
something, look at that (via <code>summary</code>), and then that same
something gets fed into <code>TukeyHSD</code> later.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Would it be a good idea to run Tukey’s method here? Explain
briefly why or why not, and if you think it would be a good idea, run
it.</li>
</ol>
<p>Solution</p>
<p>Tukey’s method is useful when (i) we have run an analysis of
variance and got a significant result and (ii) when we want to know
which groups differ significantly from which. Both (i) and (ii) are
true here. So:</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb764-1" data-line-number="1"><span class="kw">TukeyHSD</span>(sleep<span class="fl">.1</span>)  </a></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = sleeptime ~ treatment, data = sleep)
## 
## $treatment
##         diff       lwr         upr     p adj
## e1-e0 -17.74 -35.18636  -0.2936428 0.0455781
## e2-e0 -31.36 -48.80636 -13.9136428 0.0005142
## e4-e0 -46.52 -63.96636 -29.0736428 0.0000056
## e2-e1 -13.62 -31.06636   3.8263572 0.1563545
## e4-e1 -28.78 -46.22636 -11.3336428 0.0011925
## e4-e2 -15.16 -32.60636   2.2863572 0.1005398</code></pre>
<ol start="8" style="list-style-type: lower-alpha">
<li>What do you conclude from Tukey’s method? (This is liable to be
a bit complicated.) Is there a treatment that is clearly best, in
terms of the sleep time being largest?</li>
</ol>
<p>Solution</p>
<p>All the differences are significant except treatment <code>e2</code>
vs. <code>e1</code> and <code>e4</code>. All the differences involving
the control group <code>e0</code> are significant, and if you look
back at the boxplots in (c), you’ll see that the control group <code>e0</code>
had the <em>highest</em> mean sleep time. So the control group is
best (from this point of view), or another way of saying it is
that <em>any</em> dose of ethanol is significantly reducing mean
sleep time.
The other comparisons are a bit confusing, because the 1-4
difference is significant, but neither of the differences
involving 2 are. That is, 1 is better than 4, but 2 is not
significantly worse than 1 nor better than 4. This seems like it
should be a logical impossibility, but the story is that we don’t
have enough data to decide where 2 fits relative to 1 or 4. If we
had 10 or 20 observations per group, we might be able to conclude
that 2 is in between 1 and 4 as the boxplots suggest.</p>
</div>
<div id="growth-of-tomatoes" class="section level2">
<h2><span class="header-section-number">12.3</span> Growth of tomatoes</h2>
<p>A biology graduate student exposed each of 32
tomato plants to one of four different colours of light (8 plants to
each colour). The growth rate of each plant, in millimetres per week,
was recorded. The data are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/tomatoes.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/tomatoes.txt</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and confirm that you have 8 rows and 5
columns of data.</li>
</ol>
<p>Solution</p>
<p>This kind of thing:</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb766-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/tomatoes.txt&quot;</span></a>
<a class="sourceLine" id="cb766-2" data-line-number="2">toms1=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   plant = col_integer(),
##   blue = col_double(),
##   red = col_double(),
##   yellow = col_double(),
##   green = col_double()
## )</code></pre>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" data-line-number="1">toms1</a></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   plant  blue   red yellow green
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1     1  5.34  13.7   4.61  2.72
## 2     2  7.45  13.0   6.63  1.08
## 3     3  7.15  10.2   5.29  3.97
## 4     4  5.53  13.1   5.29  2.66
## 5     5  6.34  11.1   4.76  3.69
## 6     6  7.16  11.4   5.57  1.96
## 7     7  7.77  14.0   6.57  3.38
## 8     8  5.09  13.5   5.25  1.87</code></pre>
<p>I do indeed have 8 rows and 5 columns.</p>
<p>With only 8 rows, listing the data like this is good.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Re-arrange the data so that you have <em>one</em> column
containing all the growth rates, and another column saying which
colour light each plant was exposed to. (The aim here is to produce
something suitable for feeding into <code>aov</code> later.)</li>
</ol>
<p>Solution</p>
<p>This is a job for <code>gather</code>:</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb770-1" data-line-number="1">toms2 =<span class="st"> </span>toms1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(colour,growthrate,blue<span class="op">:</span>green)</a>
<a class="sourceLine" id="cb770-2" data-line-number="2">toms2</a></code></pre></div>
<pre><code>## # A tibble: 32 x 3
##    plant colour growthrate
##    &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
##  1     1 blue         5.34
##  2     2 blue         7.45
##  3     3 blue         7.15
##  4     4 blue         5.53
##  5     5 blue         6.34
##  6     6 blue         7.16
##  7     7 blue         7.77
##  8     8 blue         5.09
##  9     1 red         13.7 
## 10     2 red         13.0 
## # ... with 22 more rows</code></pre>
<p>Reminder: data frame to gather, what makes the columns different
(they’re different colours), what makes them the same (they’re all
growth rates), which columns to gather together (all the colour ones).</p>
<p>Since the column <code>plant</code> was never mentioned, this gets
repeated as necessary, so now it denotes ``plant within colour
group’’, which in this case is not very useful. (Where you have
matched pairs, or repeated measures in general, you <em>do</em> want to
keep track of which individual is which. But this is not repeated
measures because plant number 1 in the blue group and plant number 1
in the red group are <em>different</em> plants.)</p>
<p>There were 8 rows originally and 4 different colours, so there should
be, and are, <span class="math inline">\(8 \times 4=32\)</span> rows in the gathered-up data set.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Save the data in the new format to a text file. This is
most easily done using <code>write_csv</code>, which is the opposite
of <code>read_csv</code>. It requires two things: a data frame, and
the name of a file to save in, which should have a <code>.csv</code>
extension.</li>
</ol>
<p>Solution</p>
<p>The code is easy enough:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb772-1" data-line-number="1"><span class="kw">write_csv</span>(toms2,<span class="st">&quot;tomatoes2.csv&quot;</span>)</a></code></pre></div>
<p>If no error, it worked. That’s all you need.</p>
<p>To verify (for my satisfaction) that it was saved correctly:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb773-1" data-line-number="1"><span class="fu">cat</span> tomatoes2.csv </a></code></pre></div>
<pre><code>## plant,colour,growthrate
## 1,blue,5.34
## 2,blue,7.45
## 3,blue,7.15
## 4,blue,5.53
## 5,blue,6.34
## 6,blue,7.16
## 7,blue,7.77
## 8,blue,5.09
## 1,red,13.67
## 2,red,13.04
## 3,red,10.16
## 4,red,13.12
## 5,red,11.06
## 6,red,11.43
## 7,red,13.98
## 8,red,13.49
## 1,yellow,4.61
## 2,yellow,6.63
## 3,yellow,5.29
## 4,yellow,5.29
## 5,yellow,4.76
## 6,yellow,5.57
## 7,yellow,6.57
## 8,yellow,5.25
## 1,green,2.72
## 2,green,1.08
## 3,green,3.97
## 4,green,2.66
## 5,green,3.69
## 6,green,1.96
## 7,green,3.38
## 8,green,1.87</code></pre>
<p>On my system, that will list the contents of the file. Or you can just
open it in R Studio (if you saved it the way I did, it’ll be in the
same folder, and you can find it in the Files pane.)</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Make a suitable boxplot, and use it to assess the assumptions
for ANOVA. What do you conclude? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Nothing terribly surprising here. My data frame is called
<code>toms2</code>, for some reason:</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb775-1" data-line-number="1"><span class="kw">ggplot</span>(toms2,<span class="kw">aes</span>(<span class="dt">x=</span>colour, <span class="dt">y=</span>growthrate))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="11-tidying-and-selecting-data_files/figure-html/unnamed-chunk-24-1.png" width="672"  /></p>
<p>There are no outliers, but there is a little skewness (compare the
<em>whiskers</em>, not the placement of the median within the box,
because what matters with skewness is the <em>tails</em>, not the middle
of the distribution; it’s problems in the tails that make the mean
unsuitable as a measure of centre). The Red group looks the most
skewed. Also, the Yellow group has smaller spread than the others (we
assume that the population variances within each group are equal). The
thing to bear in mind here, though, is that there are only eight
observations per group, so the distributions could appear to have
unequal variances or some non-normality by chance.</p>
<p>My take is that these data, all things considered, are  OK for ANOVA. Another option would be to do Welch’s ANOVA as
well and compare with the regular ANOVA: if they give more or less the
same P-value, that’s a sign that I didn’t need to worry.</p>
<p>Extra: some people like to run a formal test on the variances to test
them for equality. My favourite (for reasons explained elsewhere) is
the Levene test, if you insist on going this way. It lives in package
<code>car</code>, and <em>does not</em> take a <code>data=</code>, so you need
to do the <code>with</code> thing:</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1"><span class="kw">library</span>(car)</a></code></pre></div>
<pre><code>## Loading required package: carData</code></pre>
<pre><code>## 
## Attaching package: &#39;car&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     recode</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     some</code></pre>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1"><span class="kw">with</span>(toms2,<span class="kw">leveneTest</span>(growthrate,colour))</a></code></pre></div>
<pre><code>## Warning in leveneTest.default(growthrate, colour): colour coerced to
## factor.</code></pre>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  3  0.9075 0.4499
##       28</code></pre>
<p>The warning is because <code>colour</code> was actually text, but the test
did the right thing by turning it into a factor, so that’s OK.</p>
<p>There is no way we can reject equal variances in the four groups. The
<span class="math inline">\(F\)</span>-statistic is less than 1, in fact, which says that if the four
groups have the same population variances, the sample variances will
be <em>more</em> different than the ones we observed on average, and so
there is no way that these sample variances indicate different
population variances. (This is because of 8 observations only per
group; if there had been 80 observations per group, it would have been
a different story.)</p>
<p>With that in mind, I think the regular ANOVA will be perfectly good,
and we would expect that and the Welch ANOVA to give very similar results.</p>
<p>I don’t need <code>car</code> again, so let’s get rid of it:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" data-line-number="1"><span class="kw">detach</span>(<span class="st">&quot;package:car&quot;</span>,<span class="dt">unload=</span>T)</a></code></pre></div>
<ol start="5" style="list-style-type: lower-alpha">
<li>Run (regular) ANOVA on these data. What do you conclude?
(Optional extra: if you think that some other variant of ANOVA would
be better, run that as well and compare the results.)</li>
</ol>
<p>Solution</p>
<p><code>aov</code>, bearing in mind that Tukey is likely to follow:</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb785-1" data-line-number="1">toms<span class="fl">.1</span>=<span class="kw">aov</span>(growthrate<span class="op">~</span>colour,<span class="dt">data=</span>toms2)</a>
<a class="sourceLine" id="cb785-2" data-line-number="2"><span class="kw">summary</span>(toms<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value   Pr(&gt;F)    
## colour       3  410.5  136.82   118.2 5.28e-16 ***
## Residuals   28   32.4    1.16                     
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This is a tiny P-value, so the mean growth rate for the different
colours is definitely <em>not</em> the same for all colours. Or, if you
like, one or more of the colours has a different mean growth rate than
the others.</p>
<p>This, remember, is as far as we go right now.</p>
<p>Extra: if you thought that normality was OK but not equal spreads,
then Welch ANOVA is the way to go:</p>
<div class="sourceCode" id="cb787"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb787-1" data-line-number="1">toms<span class="fl">.2</span>=<span class="kw">oneway.test</span>(growthrate<span class="op">~</span>colour,<span class="dt">data=</span>toms2)</a>
<a class="sourceLine" id="cb787-2" data-line-number="2">toms<span class="fl">.2</span></a></code></pre></div>
<pre><code>## 
##  One-way analysis of means (not assuming equal variances)
## 
## data:  growthrate and colour
## F = 81.079, num df = 3.000, denom df = 15.227, p-value = 1.377e-09</code></pre>
<p>The P-value is not <em>quite</em> as small as for the regular ANOVA, but
it is still very small, and the conclusion is the same.</p>
<p>If you had doubts about the normality (that were sufficiently great,
even given the small sample sizes), then go with Mood’s median test
for multiple groups:</p>
<div class="sourceCode" id="cb789"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb789-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb789-2" data-line-number="2"><span class="kw">median_test</span>(toms2,growthrate,colour)</a></code></pre></div>
<pre><code>## $table
##         above
## group    above below
##   blue       5     3
##   green      0     8
##   red        8     0
##   yellow     3     5
## 
## $test
##        what        value
## 1 statistic 1.700000e+01
## 2        df 3.000000e+00
## 3   P-value 7.067424e-04</code></pre>
<p>The P-value is again extremely small (though not quite as small as for
the other two tests, for the usual reason that Mood’s median test
doesn’t use the data very efficiently: it doesn’t use how <em>far</em>
above or below the overall median the data values are.)</p>
<p>The story here, as ever, is consistency: whatever you thought was
wrong, looking at the boxplots, needs to guide the test you do. This
should probably be a flow chart, but this way works too:</p>
<ul>
<li><p>if you are not happy with normality, go with
<code>median_test</code> from <code>smmr</code> (Mood’s median test).</p></li>
<li><p>if you are happy with normality and equal variances, go with
<code>aov</code>.</p></li>
<li><p>if you are happy with normality but not equal variances, go with
<code>oneway.test</code> (Welch ANOVA).</p></li>
</ul>
<p>So the first thing to think about is normality, and if you are OK with
normality, then think about equal spreads. Bear in mind that you need
to be willing to tolerate a certain amount of non-normality and
inequality in the spreads, given that your data are only samples from
their populations. (Don’t expect perfection, in short.)</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>If warranted, run Tukey. (If not warranted, explain briefly
why not.)</li>
</ol>
<p>Solution</p>
<p>The reason to run Tukey is that you have found some differences
among the groups, and you want to know what they are. Here, we
<em>have</em> said that the colours do not all have the same mean
growth rate, so we want to find what the differences
are. (Looking at the boxplots suggests that red is clearly best
and green clearly worst, and it is possible that all the colours
are significantly different from each other.)</p>
<div class="sourceCode" id="cb791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb791-1" data-line-number="1"><span class="kw">TukeyHSD</span>(toms<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = growthrate ~ colour, data = toms2)
## 
## $colour
##                 diff       lwr        upr     p adj
## green-blue   -3.8125 -5.281129 -2.3438706 0.0000006
## red-blue      6.0150  4.546371  7.4836294 0.0000000
## yellow-blue  -0.9825 -2.451129  0.4861294 0.2825002
## red-green     9.8275  8.358871 11.2961294 0.0000000
## yellow-green  2.8300  1.361371  4.2986294 0.0000766
## yellow-red   -6.9975 -8.466129 -5.5288706 0.0000000</code></pre>
<p>All of the differences are (strongly) significant, except for yellow
and blue, the two with middling growth rates on the boxplot. Thus we
would have no hesitation in saying that growth rate is biggest in red
light and smallest in green light.</p>
</div>
<div id="pain-relief-in-migraine-headaches-again" class="section level2">
<h2><span class="header-section-number">12.4</span> Pain relief in migraine headaches (again)</h2>
<p>The data in
<a href="http://www.utsc.utoronto.ca/~butler/c32/migraine.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/migraine.txt</a> are from a
study of pain relief in migraine headaches. Specifically, 27 subjects
were randomly assigned to receive <em>one</em> of three pain relieving
drugs, labelled A, B and C. Each subject reported the number of hours
of pain relief they obtained (that is, the number of hours between
taking the drug and the migraine symptoms returning). A higher value
is therefore better. Can we make some recommendation about which drug
is best for the population of migraine sufferers?</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display the data. Take a look at the data
file first, and see if you can say why <code>read_table</code> will
work and <code>read_delim</code> will not.</li>
</ol>
<p>Solution</p>
<p>The key is two things: the data values are , and . The second thing is why <code>read_delim</code> will not
work. If you look carefully at the data file, you’ll see that
the column names are above and aligned with the columns, which
is what <code>read_table</code> wants. If the column names had
<em>not</em> been aligned with the columns, we would have needed
<code>read_table2</code>.</p>
<div class="sourceCode" id="cb793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb793-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/migraine.txt&quot;</span></a>
<a class="sourceLine" id="cb793-2" data-line-number="2">migraine=<span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   DrugA = col_integer(),
##   DrugB = col_integer(),
##   DrugC = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb795-1" data-line-number="1">migraine</a></code></pre></div>
<pre><code>## # A tibble: 9 x 3
##   DrugA DrugB DrugC
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     4     6     6
## 2     5     8     7
## 3     4     4     6
## 4     3     5     6
## 5     2     4     7
## 6     4     6     5
## 7     3     5     6
## 8     4    11     5
## 9     4    10     5</code></pre>
<p>Success.
We’ll not be reading data like this into SAS in this course, but you
might like to know how it goes (for future reference). It uses a
<code>data</code> step, like we’ve been using to create new variables, thus:</p>



<ol start="2" style="list-style-type: lower-alpha">
<li>What is it about the experimental design that makes a one-way
analysis of variance plausible for data like this?</li>
</ol>
<p>Solution</p>
<p>Each experimental subject only tested <em>one</em> drug, so that
we have 27 independent observations, nine from each drug. This
is exactly the setup that a one-way ANOVA requires.
Compare that to, for example, a situation where you had only 9
subjects, but they each tested <em>all</em> the drugs (so that
each subject produced three measurements). That is like a
three-measurement version of matched pairs, a so-called
<strong>repeated-measures design</strong>, which requires its own kind
of analysis.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>What is wrong with the current format of the data as far as
doing a one-way ANOVA analysis is concerned? (This is related to the
idea of whether or not the data are “tidy”.)</li>
</ol>
<p>Solution</p>
<p>For our analysis, we need one column of pain relief time and one
column labelling the drug that the subject in question took.
Or, if you prefer to think about what would make these data
“tidy”: there are 27 subjects, so there ought to be 27 rows,
and all three columns are measurements of pain relief, so they
ought to be in one column.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>“Tidy” the data to produce a data frame suitable for your
analysis.</li>
</ol>
<p>Solution</p>
<p><code>gather</code> the columns that are all measurements of one
thing.
The syntax of <code>gather</code> is: what
makes the columns different, what makes them the same, and which
columns need to be gathered together. Use a pipe to name the
dataframe to work with. I’m going to save my new data frame:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" data-line-number="1">(migraine <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(drug,painrelief,DrugA<span class="op">:</span>DrugC) -&gt;<span class="st"> </span>migraine2)</a></code></pre></div>
<pre><code>## # A tibble: 27 x 2
##    drug  painrelief
##    &lt;chr&gt;      &lt;int&gt;
##  1 DrugA          4
##  2 DrugA          5
##  3 DrugA          4
##  4 DrugA          3
##  5 DrugA          2
##  6 DrugA          4
##  7 DrugA          3
##  8 DrugA          4
##  9 DrugA          4
## 10 DrugB          6
## # ... with 17 more rows</code></pre>
<p>The brackets around the whole thing print out the result as well as
saving it. If you don’t have those, you’ll need to type
<code>migraine2</code> again to display it.</p>
<p>We do indeed have a new data frame with 27 rows, one per observation,
and 2 columns, one for each variable: the pain relief hours, plus a
column identifying which drug that pain relief time came from. Exactly
what <code>aov</code> needs.</p>
<p>You can probably devise a better name for your new data frame.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Go ahead and run your one-way ANOVA (and Tukey if
necessary). Assume for this that the pain relief hours in each group
are sufficiently close to normally distributed with sufficiently
equal spreads.</li>
</ol>
<p>Solution</p>
<p>My last sentence absolves us from doing the boxplots that we
would normally insist on doing.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb799-1" data-line-number="1">painrelief<span class="fl">.1</span>=<span class="kw">aov</span>(painrelief<span class="op">~</span>drug,<span class="dt">data=</span>migraine2)</a>
<a class="sourceLine" id="cb799-2" data-line-number="2"><span class="kw">summary</span>(painrelief<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## drug         2  41.19   20.59   7.831 0.00241 **
## Residuals   24  63.11    2.63                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>There are (strongly) significant differences among the drugs, so it is
definitely worth firing up Tukey to figure out where the differences are:</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb801-1" data-line-number="1"><span class="kw">TukeyHSD</span>(painrelief<span class="fl">.1</span>)  </a></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = painrelief ~ drug, data = migraine2)
## 
## $drug
##                   diff        lwr      upr     p adj
## DrugB-DrugA  2.8888889  0.9798731 4.797905 0.0025509
## DrugC-DrugA  2.2222222  0.3132065 4.131238 0.0203671
## DrugC-DrugB -0.6666667 -2.5756824 1.242349 0.6626647</code></pre>
<p>Both the differences involving drug A are significant, and because a
high value of <code>painrelief</code> is better, in both cases drug A is
<em>worse</em> than the other drugs. Drugs B and C are not significantly
different from each other.</p>
<p>Extra: we can also use the “pipe” to do this all in one go:</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb803-1" data-line-number="1">migraine <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-2" data-line-number="2"><span class="kw">gather</span>(drug,painrelief,DrugA<span class="op">:</span>DrugC) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-3" data-line-number="3"><span class="kw">aov</span>(painrelief<span class="op">~</span>drug,<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-4" data-line-number="4"><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## drug         2  41.19   20.59   7.831 0.00241 **
## Residuals   24  63.11    2.63                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>with the same results as before. Notice that I never actually created
a second data frame by name; it was created by <code>gather</code> and
then immediately used as input to <code>aov</code>. I also used the
<code>data=.</code> trick to use `<code>the data frame that came out of the previous step'' as my input to</code>aov`.</p>
<p>Read the above like this: `<code>take</code>migraine<code>, and then gather together the</code>DrugA<code>through</code>DrugC<code>columns into a column</code>painrelief<code>, labelling each by its drug, and then do an ANOVA of</code>painrelief<code>by</code>drug`, and then summarize the results.’’</p>
<p>What is even more alarming is that I can feed the output from
<code>aov</code> straight into <code>TukeyHSD</code>:</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb805-1" data-line-number="1">migraine <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb805-2" data-line-number="2"><span class="kw">gather</span>(drug,painrelief,DrugA<span class="op">:</span>DrugC) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb805-3" data-line-number="3"><span class="kw">aov</span>(painrelief<span class="op">~</span>drug,<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb805-4" data-line-number="4"><span class="kw">TukeyHSD</span>()</a></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = painrelief ~ drug, data = .)
## 
## $drug
##                   diff        lwr      upr     p adj
## DrugB-DrugA  2.8888889  0.9798731 4.797905 0.0025509
## DrugC-DrugA  2.2222222  0.3132065 4.131238 0.0203671
## DrugC-DrugB -0.6666667 -2.5756824 1.242349 0.6626647</code></pre>
<p>I wasn’t sure whether this would work, since the output from
<code>aov</code> is an R <code>list</code> rather than a data frame, but the
output from <code>aov</code> is sent into <code>TukeyHSD</code> whatever
kind of thing it is.</p>
<p>What I am missing here is to display the result of <code>aov</code>
<em>and</em> use it as input to <code>TukeyHSD</code>. Of course, I had to
discover that this could be solved, and indeed it can:</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb807-1" data-line-number="1">migraine <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-2" data-line-number="2"><span class="kw">gather</span>(drug,painrelief,DrugA<span class="op">:</span>DrugC) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-3" data-line-number="3"><span class="kw">aov</span>(painrelief<span class="op">~</span>drug,<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-4" data-line-number="4">{ <span class="kw">print</span>(<span class="kw">summary</span>(.)) ; . } <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-5" data-line-number="5"><span class="kw">TukeyHSD</span>()</a></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value  Pr(&gt;F)   
## drug         2  41.19   20.59   7.831 0.00241 **
## Residuals   24  63.11    2.63                   
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = painrelief ~ drug, data = .)
## 
## $drug
##                   diff        lwr      upr     p adj
## DrugB-DrugA  2.8888889  0.9798731 4.797905 0.0025509
## DrugC-DrugA  2.2222222  0.3132065 4.131238 0.0203671
## DrugC-DrugB -0.6666667 -2.5756824 1.242349 0.6626647</code></pre>
<p>The odd-looking second-last line of that uses that <code>.</code> trick
for “whatever came out of the previous step”. The thing inside the
curly brackets is two commands one after the other; the first is to
display the <code>summary</code> of that <code>aov</code> and the second
part after the <code>;</code> is to just pass whatever came out of the
previous line, the output from <code>aov</code>, on, unchanged, into
<code>TukeyHSD</code>.</p>
<p>In the Unix world this is called <code>tee</code>,
where you print something <em>and</em> pass it on to the next step. The
name <code>tee</code> comes from a (real) pipe that plumbers would use to
split water flow into two, which looks like a letter T.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>What recommendation would you make about the best drug or
drugs? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Drug A is significantly the worst, so we eliminate that. But
there is no significant difference between drugs B and C, so we
have no reproducible reason for preferring one rather than the
other. Thus, we recommend “either B or C”.
If you weren’t sure which way around the drugs actually came
out, then you should work out the mean pain relief score by
drug:</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb810-1" data-line-number="1">migraine2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb810-2" data-line-number="2"><span class="kw">group_by</span>(drug) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb810-3" data-line-number="3"><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(painrelief))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   drug      m
##   &lt;chr&gt; &lt;dbl&gt;
## 1 DrugA  3.67
## 2 DrugB  6.56
## 3 DrugC  5.89</code></pre>
<p>These confirm that A is worst, and there is nothing much to choose
between B and C.
You should <em>not</em> recommend drug C over drug B on this evidence,
just because its (sample) mean is higher than B’s. The point about significant
differences is that they are supposed to stand up to replication: in
another experiment, or in real-life experiences with these drugs, the
mean pain relief score for drug A is expected to be worst, but between
drugs B and C, sometimes the mean of B will come out higher and
sometimes C’s mean will be higher, because there is no significant
difference between them.
<label for="tufte-mn-33" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-33" class="margin-toggle"><span class="marginnote">This talks about emph{means</span> rather
than individual observations; in individual cases, sometimes even
drug <em>A</em> will come out best. But we’re interested in
population means, since we want to do the greatest good for the
greatest number.}
Another way is to draw a boxplot of pain-relief scores:</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb812-1" data-line-number="1"><span class="kw">ggplot</span>(migraine2,<span class="kw">aes</span>(<span class="dt">x=</span>drug,<span class="dt">y=</span>painrelief))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="11-tidying-and-selecting-data_files/figure-html/unnamed-chunk-39-1.png" width="672"  /></p>
<p>The medians of drugs B and C are actually exactly the same. Because
the pain relief values are all whole numbers (and there are only 9 in
each group), you get that thing where enough of them are equal that
the median and third quartiles are equal, actually for all three
groups.</p>
<p>Despite the outlier, I’m willing to call these groups sufficiently
symmetric for the ANOVA to be OK (but I didn’t ask you to draw the
boxplot, because I didn’t want to confuse the issue with this. The
point of this question was to get the data tidy enough to do an
analysis.) Think about it for a moment: that outlier is a value of 8.
This is really not that much bigger than the value of 7 that is the
highest one on drug C. The 7 for drug C is not an outlier. The only
reason the 8 came out as an outlier was because the IQR was only 1. If
the IQR on drug B had happened to be a bit bigger, the 8 would not
have been an outlier.</p>
<p>As I said, I didn’t want you to have to get into this, but if you are
worried, you know what the remedy is — Mood’s median test. Don’t
forget to use the right data frame:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb813-1" data-line-number="1"><span class="kw">library</span>(smmr)</a>
<a class="sourceLine" id="cb813-2" data-line-number="2"><span class="kw">median_test</span>(migraine2,painrelief,drug)</a></code></pre></div>
<pre><code>## $table
##        above
## group   above below
##   DrugA     0     8
##   DrugB     5     2
##   DrugC     6     0
## 
## $test
##        what        value
## 1 statistic 1.527273e+01
## 2        df 2.000000e+00
## 3   P-value 4.825801e-04</code></pre>
<p>Because the pain relief scores are integers, there are probably a lot
of them equal to the overall median. There were 27 observations
altogether, but Mood’s median test will discard any that are equal to
this value. There must have been 9 observations in each group to start
with, but if you look at each row of the table, there are only 8
observations listed for drug A, 7 for drug B and 6 for drug C, so
there must have been 1, 2 and 3 (totalling 6) observations equal to
the median that were discarded.</p>
<p>The P-value is a little bigger than came out of the <span class="math inline">\(F\)</span>-test, but the
conclusion is still that there are definitely differences among the
drugs in terms of pain relief. The table at the top of the output
again suggests that drug A is worse than the others, but to confirm
that you’d have to do Mood’s median test on all three <em>pairs</em> of
drugs, and then use Bonferroni to allow for your having done three tests:</p>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb815-1" data-line-number="1"><span class="kw">pairwise_median_test</span>(migraine2, painrelief, drug)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   g1    g2     p_value adj_p_value
##   &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;       &lt;dbl&gt;
## 1 DrugA DrugB 0.00721     0.0216  
## 2 DrugA DrugC 0.000183    0.000548
## 3 DrugB DrugC 0.921       2.76</code></pre>
<p>Drug A gives worse pain relief (fewer hours) than both drugs B and C,
which are not significantly different from each hour. This is exactly
what you would have guessed from the boxplot.</p>
<p>I gotta do something about those adjusted P-values bigger than 1!</p>
</div>
<div id="location-species-and-disease-in-plants" class="section level2">
<h2><span class="header-section-number">12.5</span> Location, species and disease in plants</h2>
<p>The table below is a “contingency table”, showing
frequencies of diseased and undiseased plants of two different species
in two different locations:</p>
<pre><code>
Species     Disease present         Disease absent
Location X Location Y  Location X Location Y
A            44         12          38        10
B            28         22          20        18
</code></pre>
<p>The data were saved as
<a href="http://www.utsc.utoronto.ca/~butler/c32/disease.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/disease.txt</a>. In that
file, the columns are coded by two letters: a <code>p</code> or an
<code>a</code> to denote presence or absence of disease, and an <code>x</code>
or a <code>y</code> to denote location X or Y. The data are separated by
multiple spaces and aligned with the variable names.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in and display the data.</li>
</ol>
<p>Solution</p>
<p><code>read_table</code> again. You know this because, when you looked
at the data file, which of course you did (didn’t you?), you saw
that the data values were aligned by columns with multiple spaces
between them:</p>
<div class="sourceCode" id="cb818"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb818-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/disease.txt&quot;</span></a>
<a class="sourceLine" id="cb818-2" data-line-number="2">tbl=<span class="kw">read_table</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   Species = col_character(),
##   px = col_integer(),
##   py = col_integer(),
##   ax = col_integer(),
##   ay = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb820"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb820-1" data-line-number="1">tbl</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   Species    px    py    ax    ay
##   &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1 A          44    12    38    10
## 2 B          28    22    20    18</code></pre>
<p>I was thinking ahead, since I’ll be wanting to have one of my columns
called <code>disease</code>, so I’m <em>not</em> calling the data frame
<code>disease</code>.</p>
<p>You’ll also have noticed that I simplified the data frame that I had
you read in, because the original contingency table I showed you has
<em>two</em> header rows, and we have to have <em>one</em> header row. So
I mixed up the information in the two header rows into one.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Explain briefly how these data are not “tidy”.</li>
</ol>
<p>Solution</p>
<p>The simple answer is that there are 8 frequencies, that each ought
to be in a row by themselves. Or, if you like, there are three
variables, Species, Disease status and Location, and each of
<em>those</em> should be in a <em>column</em> of its own.
Either one
of these ideas, or something like it, is good. I need you to
demonstrate that you know something about “tidy data” in this context.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Use a suitable <code>tidyr</code> tool to get all the things
that are the same into a single column. (You’ll need to make up a
temporary name for the other new column that you create.) Show your
result.</li>
</ol>
<p>Solution</p>
<p><code>gather</code> is the tool. All the columns apart from
<code>Species</code> contain frequencies, so that’s what’s “the same”.
They are frequencies in disease-location combinations, so
I’ll call the column of “what’s different” <code>disloc</code>. Feel
free to call it <code>temp</code> for now if you prefer:</p>
<div class="sourceCode" id="cb822"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb822-1" data-line-number="1">(tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(disloc,frequency,px<span class="op">:</span>ay) -&gt;<span class="st"> </span>tbl<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Species disloc frequency
##   &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;
## 1 A       px            44
## 2 B       px            28
## 3 A       py            12
## 4 B       py            22
## 5 A       ax            38
## 6 B       ax            20
## 7 A       ay            10
## 8 B       ay            18</code></pre>
<p>This also works (“gather together everything but <code>Species</code>”):</p>
<div class="sourceCode" id="cb824"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb824-1" data-line-number="1">(tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(disloc,frequency,<span class="op">-</span>Species) -&gt;<span class="st"> </span>tbl<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Species disloc frequency
##   &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;
## 1 A       px            44
## 2 B       px            28
## 3 A       py            12
## 4 B       py            22
## 5 A       ax            38
## 6 B       ax            20
## 7 A       ay            10
## 8 B       ay            18</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Explain briefly how the data frame you just created is
still not “tidy” yet.</li>
</ol>
<p>Solution</p>
<p>The column I called <code>disloc</code> actually contains <em>two</em>
variables, disease and location, which need to be split up. A
check on this is that we
have two columns (not including the frequencies), but back in
(b) we found <em>three</em> variables, so there
ought to be three non-frequency columns.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Use one more <code>tidyr</code> tool to make these data tidy,
and show your result.</li>
</ol>
<p>Solution</p>
<p>This means splitting up <code>disloc</code> into two separate columns,
splitting after the first character, thus:</p>
<div class="sourceCode" id="cb826"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb826-1" data-line-number="1">(tbl<span class="fl">.2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">separate</span>(disloc,<span class="kw">c</span>(<span class="st">&quot;disease&quot;</span>,<span class="st">&quot;location&quot;</span>),<span class="dv">1</span>) -&gt;<span class="st"> </span>tbl<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   Species disease location frequency
##   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;        &lt;int&gt;
## 1 A       p       x               44
## 2 B       p       x               28
## 3 A       p       y               12
## 4 B       p       y               22
## 5 A       a       x               38
## 6 B       a       x               20
## 7 A       a       y               10
## 8 B       a       y               18</code></pre>
<p>This is now tidy: eight frequencies in rows, and three non-frequency
and note that the issues you found there have all been resolved now.)</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Let’s see if we can re-construct the original contingency
table (or something equivalent to it). Use the function
<code>xtabs</code>. This requires first a model formula with the frequency
variable on the left of the squiggle, and the other variables
separated by plus signs on the right. Second it requires a data
frame, with <code>data=</code>. Feed
your data frame from the previous part into <code>xtabs</code>. Save the
result in a variable and display the result.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb828"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb828-1" data-line-number="1">tbl<span class="fl">.4</span>=<span class="kw">xtabs</span>(frequency<span class="op">~</span>Species<span class="op">+</span>disease<span class="op">+</span>location,<span class="dt">data=</span>tbl<span class="fl">.3</span>)</a>
<a class="sourceLine" id="cb828-2" data-line-number="2">tbl<span class="fl">.4</span></a></code></pre></div>
<pre><code>## , , location = x
## 
##        disease
## Species  a  p
##       A 38 44
##       B 20 28
## 
## , , location = y
## 
##        disease
## Species  a  p
##       A 10 12
##       B 18 22</code></pre>
<p>This shows a pair of contingency tables, one each for each of the two
locations (in general, the variable you put last on the right side of
the model formula). You can check that everything corresponds with the
original data layout at the beginning of the question, possibly with
some things rearranged (but with the same frequencies in the same
places).</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Take the output from the last part and feed it into the
function <code>ftable</code>. How has the output been changed? Which do
you like better? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>This:</p>
<div class="sourceCode" id="cb830"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb830-1" data-line-number="1"><span class="kw">ftable</span>(tbl<span class="fl">.4</span>)  </a></code></pre></div>
<pre><code>##                 location  x  y
## Species disease               
## A       a                38 10
##         p                44 12
## B       a                20 18
##         p                28 22</code></pre>
<p>This is the same output, but shown more compactly. (Rather like a
vertical version of the original data, in fact.) I like
<code>ftable</code> better because it displays the data in the smallest
amount of space, though I’m fine if you prefer the <code>xtabs</code>
output because it spreads things out more. This is a matter of
taste. Pick one and tell me why you prefer it, and I’m good.</p>
<p>That’s the end of what you had to do, but I thought I would do some
modelling and try to find out what’s associated with disease. The
appropriate modelling with frequencies is called ``log-linear
modelling’’, and it assumes that the log of the frequencies has a
linear relationship with the effects of the other variables. This is
not quite as simple as the log transformations we had before, because
bigger frequencies are going to be more variable, so we fit a
generalized linear model with a Poisson-distributed response and log
link. (It’s better if you know what that means, but you ought to be
able to follow the logic if you don’t.)</p>
<p>First, fit a model predicting frequency from everything, including all
the interactions. (The reason for doing it this way will become clear later):</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb832-1" data-line-number="1">model<span class="fl">.1</span>=<span class="kw">glm</span>(frequency<span class="op">~</span>Species<span class="op">*</span>location<span class="op">*</span>disease,<span class="dt">data=</span>tbl<span class="fl">.3</span>,<span class="dt">family=</span><span class="st">&quot;poisson&quot;</span>)</a>
<a class="sourceLine" id="cb832-2" data-line-number="2"><span class="kw">drop1</span>(model<span class="fl">.1</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ Species * location * disease
##                          Df Deviance    AIC      LRT Pr(&gt;Chi)
## &lt;none&gt;                      0.000000 55.291                  
## Species:location:disease  1 0.070257 53.362 0.070257    0.791</code></pre>
<p>The residuals are all zero because this model fits perfectly. The
problem is that it is very complicated, so it offers no insight. So
what we do is to look at the highest-order interaction
<code>Species:location:disease</code> and see whether it is
significant. It is not, so we can remove it. This is reminiscent of
variable selection in regression, where we pull the least significant
thing out of the model in turn until we can go no further. But here,
we have additional things to think about: we have to get rid of all
the three-way interactions before we can tackle the two-way ones, and
all the two-way ones before we can tackle the main effects. There is a
so-called “nested” structure happening here that says you don’t look
at, say, <code>Species</code>, until you have removed <em>all</em> the
higher-order interactions involving <code>Species</code>. Not clear yet?
Don’t fret. <code>drop1</code> allows you to assess what is currently up
for grabs (here, only the three-way interaction, which is not
significant, so out it comes).</p>
<p>Let’s get rid of that three-way interaction. This is another use for
<code>update</code> that we’ve seen in connection with multiple regression
(to make small changes to a big model):</p>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb834-1" data-line-number="1">model<span class="fl">.2</span>=<span class="kw">update</span>(model<span class="fl">.1</span>,.<span class="op">~</span>.<span class="op">-</span>Species<span class="op">:</span>location<span class="op">:</span>disease)</a>
<a class="sourceLine" id="cb834-2" data-line-number="2"><span class="kw">drop1</span>(model<span class="fl">.2</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ Species + location + disease + Species:location + 
##     Species:disease + location:disease
##                  Df Deviance    AIC     LRT  Pr(&gt;Chi)    
## &lt;none&gt;                0.0703 53.362                      
## Species:location  1  13.0627 64.354 12.9924 0.0003128 ***
## Species:disease   1   0.2696 51.561  0.1993 0.6552865    
## location:disease  1   0.1043 51.396  0.0340 0.8536877    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Notice how <code>update</code> saved us having to write the whole model
out again.</p>
<p>Now the three two-way interactions are up for grabs:
<code>Species:location</code>, <code>Species:disease</code> and
<code>location:disease</code>. The last of these is the least significant,
so out it comes. I did some copying and pasting, but I had to remember
which model I was working with and what I was removing:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb836-1" data-line-number="1">model<span class="fl">.3</span>=<span class="kw">update</span>(model<span class="fl">.2</span>,.<span class="op">~</span>.<span class="op">-</span>location<span class="op">:</span>disease)</a>
<a class="sourceLine" id="cb836-2" data-line-number="2"><span class="kw">drop1</span>(model<span class="fl">.3</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)  </a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ Species + location + disease + Species:location + 
##     Species:disease
##                  Df Deviance    AIC     LRT  Pr(&gt;Chi)    
## &lt;none&gt;                0.1043 51.396                      
## Species:location  1  13.0678 62.359 12.9635 0.0003176 ***
## Species:disease   1   0.2746 49.566  0.1703 0.6798021    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>Species:disease</code> comes out, but it looks as if
<code>Species:location</code> will have to stay:</p>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb838-1" data-line-number="1">model<span class="fl">.4</span>=<span class="kw">update</span>(model<span class="fl">.3</span>,.<span class="op">~</span>.<span class="op">-</span>Species<span class="op">:</span>disease)</a>
<a class="sourceLine" id="cb838-2" data-line-number="2"><span class="kw">drop1</span>(model<span class="fl">.4</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)  </a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ Species + location + disease + Species:location
##                  Df Deviance    AIC     LRT  Pr(&gt;Chi)    
## &lt;none&gt;                0.2746 49.566                      
## disease           1   2.3617 49.653  2.0871 0.1485461    
## Species:location  1  13.2381 60.530 12.9635 0.0003176 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p><code>Species:location</code> indeed stays. That means that anything
“contained in” it also has to stay, regardless of its main
effect. So the only candidate for removal now is <code>disease</code>: not
significant, out it comes:</p>
<div class="sourceCode" id="cb840"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb840-1" data-line-number="1">model<span class="fl">.5</span>=<span class="kw">update</span>(model<span class="fl">.4</span>,.<span class="op">~</span>.<span class="op">-</span>disease)</a>
<a class="sourceLine" id="cb840-2" data-line-number="2"><span class="kw">drop1</span>(model<span class="fl">.5</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)  </a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ Species + location + Species:location
##                  Df Deviance    AIC    LRT  Pr(&gt;Chi)    
## &lt;none&gt;                2.3617 49.653                     
## Species:location  1  15.3252 60.617 12.963 0.0003176 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>And now we have to stop.</p>
<p>What does this final model mean? Well, frequency depends significantly
on the <code>Species:location</code> combination, but not on anything
else. To see how, we make a contingency table of species by location
(totalling up over disease status, since that is not significant):</p>
<div class="sourceCode" id="cb842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb842-1" data-line-number="1"><span class="kw">xtabs</span>(frequency<span class="op">~</span>Species<span class="op">+</span>location,<span class="dt">data=</span>tbl<span class="fl">.3</span>)  </a></code></pre></div>
<pre><code>##        location
## Species  x  y
##       A 82 22
##       B 48 40</code></pre>
<p>Most of the species A’s are at location X, but the species B’s are
about evenly divided between the two locations. Or, if you prefer
(equally good): location X has mostly species A, while location Y has
mostly species B. You can condition on either variable and compare the
conditional distribution of the other one.</p>
<p>Now, this is rather interesting, because this began as a study of
disease, but disease has completely disappeared from our final model!
That means that nothing in our final model has any relationship with
disease. Indeed, if you check the original table, you’ll find that
disease is present slightly more than it’s absent, for all
combinations of species and location. That is, neither species nor
location has any particular association with (effect on) disease,
since disease prevalence doesn’t change appreciably if you change
location, species or the combination of them.</p>
<p>The way an association with disease would show up is if a
<code>disease:</code>something interaction had been significant and had
stayed in the model, that something would have been associated with
disease. For example, if the <code>disease:Species</code> table had looked
like this:</p>
<div class="sourceCode" id="cb844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb844-1" data-line-number="1">disease=<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>,<span class="st">&quot;a&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;p&quot;</span>)</a>
<a class="sourceLine" id="cb844-2" data-line-number="2">Species=<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>)</a>
<a class="sourceLine" id="cb844-3" data-line-number="3">frequency=<span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">30</span>,<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb844-4" data-line-number="4">xx=<span class="kw">data.frame</span>(disease,Species,frequency)</a>
<a class="sourceLine" id="cb844-5" data-line-number="5"><span class="kw">xtabs</span>(frequency<span class="op">~</span>disease<span class="op">+</span>Species)</a></code></pre></div>
<pre><code>##        Species
## disease  A  B
##       a 10 50
##       p 30 30</code></pre>
<p>For species A, disease is present 75% of the time, but for species B
it’s present less than 40% of the time. So in this one there ought to be a
significant association between disease and species:</p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb846-1" data-line-number="1">xx<span class="fl">.1</span>=<span class="kw">glm</span>(frequency<span class="op">~</span>disease<span class="op">*</span>Species,<span class="dt">data=</span>xx,<span class="dt">family=</span><span class="st">&quot;poisson&quot;</span>)</a>
<a class="sourceLine" id="cb846-2" data-line-number="2"><span class="kw">drop1</span>(xx<span class="fl">.1</span>,<span class="dt">test=</span><span class="st">&quot;Chisq&quot;</span>)</a></code></pre></div>
<pre><code>## Single term deletions
## 
## Model:
## frequency ~ disease * Species
##                 Df Deviance    AIC    LRT  Pr(&gt;Chi)    
## &lt;none&gt;                0.000 28.400                     
## disease:Species  1   15.518 41.918 15.518 8.171e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>And so there is. Nothing can come out of the model. (This is the same
kind of test as a chi-squared test for association, if you know about
that. The log-linear model is a multi-variable generalization of that.)</p>
</div>
<div id="kens-cars" class="section level2">
<h2><span class="header-section-number">12.6</span> Ken’s cars</h2>
<p>My cars data file can be found at
<a href="http://www.utsc.utoronto.ca/~butler/c32/cars.csv" class="uri">http://www.utsc.utoronto.ca/~butler/c32/cars.csv</a>. We’re doing
this question in R now, but later we’ll be doing the exact same thing
in SAS, so you’ll be able then to compare your results. The values in
the data file are separated by commas; the car names are up to 29
characters long. Display your results for each part after (a). In R,
displaying a <code>tibble</code> normally shows its first ten lines, which
is all you need here; there’s no need to display all the lines unless
you want to.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and list the values.</li>
</ol>
<p>Solution</p>
<p><code>read_csv</code> will do it:</p>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/cars.csv&quot;</span></a>
<a class="sourceLine" id="cb848-2" data-line-number="2">cars=<span class="kw">read_csv</span>(my_url)  </a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   car = col_character(),
##   MPG = col_double(),
##   weight = col_double(),
##   cylinders = col_integer(),
##   hp = col_integer(),
##   country = col_character()
## )</code></pre>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb850-1" data-line-number="1">cars</a></code></pre></div>
<pre><code>## # A tibble: 38 x 6
##    car                  MPG weight cylinders    hp country
##    &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;     &lt;int&gt; &lt;int&gt; &lt;chr&gt;  
##  1 Buick Skylark       28.4   2.67         4    90 U.S.   
##  2 Dodge Omni          30.9   2.23         4    75 U.S.   
##  3 Mercury Zephyr      20.8   3.07         6    85 U.S.   
##  4 Fiat Strada         37.3   2.13         4    69 Italy  
##  5 Peugeot 694 SL      16.2   3.41         6   133 France 
##  6 VW Rabbit           31.9   1.92         4    71 Germany
##  7 Plymouth Horizon    34.2   2.2          4    70 U.S.   
##  8 Mazda GLC           34.1   1.98         4    65 Japan  
##  9 Buick Estate Wagon  16.9   4.36         8   155 U.S.   
## 10 Audi 5000           20.3   2.83         5   103 Germany
## # ... with 28 more rows</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li>Display only the car names and the countries they come from.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb852"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb852-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(car,country)</a></code></pre></div>
<pre><code>## # A tibble: 38 x 2
##    car                country
##    &lt;chr&gt;              &lt;chr&gt;  
##  1 Buick Skylark      U.S.   
##  2 Dodge Omni         U.S.   
##  3 Mercury Zephyr     U.S.   
##  4 Fiat Strada        Italy  
##  5 Peugeot 694 SL     France 
##  6 VW Rabbit          Germany
##  7 Plymouth Horizon   U.S.   
##  8 Mazda GLC          Japan  
##  9 Buick Estate Wagon U.S.   
## 10 Audi 5000          Germany
## # ... with 28 more rows</code></pre>
<p>This <em>almost</em> works, but not quite:</p>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb854-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;c&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 38 x 3
##    car                cylinders country
##    &lt;chr&gt;                  &lt;int&gt; &lt;chr&gt;  
##  1 Buick Skylark              4 U.S.   
##  2 Dodge Omni                 4 U.S.   
##  3 Mercury Zephyr             6 U.S.   
##  4 Fiat Strada                4 Italy  
##  5 Peugeot 694 SL             6 France 
##  6 VW Rabbit                  4 Germany
##  7 Plymouth Horizon           4 U.S.   
##  8 Mazda GLC                  4 Japan  
##  9 Buick Estate Wagon         8 U.S.   
## 10 Audi 5000                  5 Germany
## # ... with 28 more rows</code></pre>
<p>It gets <em>all</em> the columns that start with <code>c</code>, which
includes <code>cylinders</code> as well.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Display everything <em>except</em> horsepower:</li>
</ol>
<p>Solution</p>
<p>Naming what you <em>don’t</em> want is sometimes easier:</p>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb856-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>hp)  </a></code></pre></div>
<pre><code>## # A tibble: 38 x 5
##    car                  MPG weight cylinders country
##    &lt;chr&gt;              &lt;dbl&gt;  &lt;dbl&gt;     &lt;int&gt; &lt;chr&gt;  
##  1 Buick Skylark       28.4   2.67         4 U.S.   
##  2 Dodge Omni          30.9   2.23         4 U.S.   
##  3 Mercury Zephyr      20.8   3.07         6 U.S.   
##  4 Fiat Strada         37.3   2.13         4 Italy  
##  5 Peugeot 694 SL      16.2   3.41         6 France 
##  6 VW Rabbit           31.9   1.92         4 Germany
##  7 Plymouth Horizon    34.2   2.2          4 U.S.   
##  8 Mazda GLC           34.1   1.98         4 Japan  
##  9 Buick Estate Wagon  16.9   4.36         8 U.S.   
## 10 Audi 5000           20.3   2.83         5 Germany
## # ... with 28 more rows</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Display only the cars that have 8-cylinder engines (but
display all the variables for those cars).</li>
</ol>
<p>Solution</p>
<p>This:</p>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb858-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(cylinders<span class="op">==</span><span class="dv">8</span>)  </a></code></pre></div>
<pre><code>## # A tibble: 8 x 6
##   car                         MPG weight cylinders    hp country
##   &lt;chr&gt;                     &lt;dbl&gt;  &lt;dbl&gt;     &lt;int&gt; &lt;int&gt; &lt;chr&gt;  
## 1 Buick Estate Wagon         16.9   4.36         8   155 U.S.   
## 2 Chevy Malibu Wagon         19.2   3.60         8   125 U.S.   
## 3 Chrysler LeBaron Wagon     18.5   3.94         8   150 U.S.   
## 4 Ford LTD                   17.6   3.72         8   129 U.S.   
## 5 Dodge St Regis             18.2   3.83         8   135 U.S.   
## 6 Ford Country Squire Wagon  15.5   4.05         8   142 U.S.   
## 7 Mercury Grand Marquis      16.5   3.96         8   138 U.S.   
## 8 Chevy Caprice Classic      17     3.84         8   130 U.S.</code></pre>
<p>8 of them, all from the US.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Display the cylinders and horsepower for the cars that have
horsepower 70 or less.</li>
</ol>
<p>Solution</p>
<p>This one is selecting some observations and some variables:</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(hp<span class="op">&lt;=</span><span class="dv">70</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(cylinders<span class="op">:</span>hp)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   cylinders    hp
##       &lt;int&gt; &lt;int&gt;
## 1         4    69
## 2         4    70
## 3         4    65
## 4         4    65
## 5         4    68
## 6         4    68</code></pre>
<p>Cylinders and horsepower are consecutive columns, so we can select
them either using the colon <code>:</code> or by
<code>c(cylinders,hp)</code>.</p>
<p>You can also do the <code>filter</code> and the
<code>select</code> the other way around.
This one works because the <em>rows</em> you want to
choose are determined by a column you’re going to keep. If you wanted
to display the cylinders and horsepower of the cars with <code>mpg</code>
over 30, you would have to choose the rows first, because after you’ve
chosen the columns, there is no <code>mpg</code> any more.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Find the mean and SD of gas mileage of the cars with 4 cylinders.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb862-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(cylinders<span class="op">==</span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(MPG),<span class="dt">s=</span><span class="kw">sd</span>(MPG))  </a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       m     s
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  30.0  4.18</code></pre>
<p>Or you can get the mean and SD of gas mileage for all numbers of
cylinders, and pick out the one you want:</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb864-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cylinders) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(MPG),<span class="dt">s=</span><span class="kw">sd</span>(MPG))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   cylinders     m     s
##       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1         4  30.0  4.18
## 2         5  20.3 NA   
## 3         6  21.1  4.08
## 4         8  17.4  1.19</code></pre>
<p>Top row is the same as before. And since the output is a data frame,
you can do any of these things with <em>that</em>, for example:</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb866-1" data-line-number="1">cars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(cylinders) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb866-2" data-line-number="2"><span class="kw">summarize</span>(<span class="dt">m=</span><span class="kw">mean</span>(MPG),<span class="dt">s=</span><span class="kw">sd</span>(MPG)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb866-3" data-line-number="3"><span class="kw">filter</span>(cylinders<span class="op">==</span><span class="dv">4</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   cylinders     m     s
##       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1         4  30.0  4.18</code></pre>
<p>to pick out just the right row.
This is a very easy kind of question to set on an exam. Just so you know.</p>
</div>
<div id="number-1-songs" class="section level2">
<h2><span class="header-section-number">12.7</span> Number 1 songs</h2>
<p>The data file
<a href="http://stat405.had.co.nz/data/billboard.csv" class="uri">http://stat405.had.co.nz/data/billboard.csv</a> contains a lot of
information about songs popular in 2000. This dataset is untidy. Our
ultimate aim is to answer ``which song occupied the #1 position for
the largest number of weeks?’’. To do that, we will build a pipe that
starts from the data frame read in from the URL above, and finishes
with an answer to the question. I will take you through this step by
step. Each part will involve adding something to the pipe you built
previously (possibly after removing a line or two that you used to
display the previous result).</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data and display what you have.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb868-1" data-line-number="1">billboard=<span class="kw">read_csv</span>(<span class="st">&quot;http://stat405.had.co.nz/data/billboard.csv&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_integer(),
##   artist.inverted = col_character(),
##   track = col_character(),
##   time = col_time(format = &quot;&quot;),
##   genre = col_character(),
##   date.entered = col_date(format = &quot;&quot;),
##   date.peaked = col_date(format = &quot;&quot;),
##   x66th.week = col_character(),
##   x67th.week = col_character(),
##   x68th.week = col_character(),
##   x69th.week = col_character(),
##   x70th.week = col_character(),
##   x71st.week = col_character(),
##   x72nd.week = col_character(),
##   x73rd.week = col_character(),
##   x74th.week = col_character(),
##   x75th.week = col_character(),
##   x76th.week = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>There are a <em>lot</em> of columns. What does this look like?</p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb871-1" data-line-number="1">billboard</a></code></pre></div>
<pre><code>## # A tibble: 317 x 83
##     year artist.inverted track time  genre date.entered date.peaked
##    &lt;int&gt; &lt;chr&gt;           &lt;chr&gt; &lt;tim&gt; &lt;chr&gt; &lt;date&gt;       &lt;date&gt;     
##  1  2000 Destiny&#39;s Child Inde… 03:38 Rock  2000-09-23   2000-11-18 
##  2  2000 Santana         Mari… 04:18 Rock  2000-02-12   2000-04-08 
##  3  2000 Savage Garden   I Kn… 04:07 Rock  1999-10-23   2000-01-29 
##  4  2000 Madonna         Music 03:45 Rock  2000-08-12   2000-09-16 
##  5  2000 Aguilera, Chri… Come… 03:38 Rock  2000-08-05   2000-10-14 
##  6  2000 Janet           Does… 04:17 Rock  2000-06-17   2000-08-26 
##  7  2000 Destiny&#39;s Child Say … 04:31 Rock  1999-12-25   2000-03-18 
##  8  2000 Iglesias, Enri… Be W… 03:36 Latin 2000-04-01   2000-06-24 
##  9  2000 Sisqo           Inco… 03:52 Rock  2000-06-24   2000-08-12 
## 10  2000 Lonestar        Amaz… 04:25 Coun… 1999-06-05   2000-03-04 
## # ... with 307 more rows, and 76 more variables: x1st.week &lt;int&gt;,
## #   x2nd.week &lt;int&gt;, x3rd.week &lt;int&gt;, x4th.week &lt;int&gt;, x5th.week &lt;int&gt;,
## #   x6th.week &lt;int&gt;, x7th.week &lt;int&gt;, x8th.week &lt;int&gt;, x9th.week &lt;int&gt;,
## #   x10th.week &lt;int&gt;, x11th.week &lt;int&gt;, x12th.week &lt;int&gt;,
## #   x13th.week &lt;int&gt;, x14th.week &lt;int&gt;, x15th.week &lt;int&gt;,
## #   x16th.week &lt;int&gt;, x17th.week &lt;int&gt;, x18th.week &lt;int&gt;,
## #   x19th.week &lt;int&gt;, x20th.week &lt;int&gt;, x21st.week &lt;int&gt;,
## #   x22nd.week &lt;int&gt;, x23rd.week &lt;int&gt;, x24th.week &lt;int&gt;,
## #   x25th.week &lt;int&gt;, x26th.week &lt;int&gt;, x27th.week &lt;int&gt;,
## #   x28th.week &lt;int&gt;, x29th.week &lt;int&gt;, x30th.week &lt;int&gt;,
## #   x31st.week &lt;int&gt;, x32nd.week &lt;int&gt;, x33rd.week &lt;int&gt;,
## #   x34th.week &lt;int&gt;, x35th.week &lt;int&gt;, x36th.week &lt;int&gt;,
## #   x37th.week &lt;int&gt;, x38th.week &lt;int&gt;, x39th.week &lt;int&gt;,
## #   x40th.week &lt;int&gt;, x41st.week &lt;int&gt;, x42nd.week &lt;int&gt;,
## #   x43rd.week &lt;int&gt;, x44th.week &lt;int&gt;, x45th.week &lt;int&gt;,
## #   x46th.week &lt;int&gt;, x47th.week &lt;int&gt;, x48th.week &lt;int&gt;,
## #   x49th.week &lt;int&gt;, x50th.week &lt;int&gt;, x51st.week &lt;int&gt;,
## #   x52nd.week &lt;int&gt;, x53rd.week &lt;int&gt;, x54th.week &lt;int&gt;,
## #   x55th.week &lt;int&gt;, x56th.week &lt;int&gt;, x57th.week &lt;int&gt;,
## #   x58th.week &lt;int&gt;, x59th.week &lt;int&gt;, x60th.week &lt;int&gt;,
## #   x61st.week &lt;int&gt;, x62nd.week &lt;int&gt;, x63rd.week &lt;int&gt;,
## #   x64th.week &lt;int&gt;, x65th.week &lt;int&gt;, x66th.week &lt;chr&gt;,
## #   x67th.week &lt;chr&gt;, x68th.week &lt;chr&gt;, x69th.week &lt;chr&gt;,
## #   x70th.week &lt;chr&gt;, x71st.week &lt;chr&gt;, x72nd.week &lt;chr&gt;,
## #   x73rd.week &lt;chr&gt;, x74th.week &lt;chr&gt;, x75th.week &lt;chr&gt;, x76th.week &lt;chr&gt;</code></pre>
<p>On yours, you will definitely see a little arrow top right saying
“there are more columns”, and you will have to click on it several
times to see them all.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>The columns <code>x1st.week</code> through
<code>x76th.week</code> contain the rank of each song in the Billboard
chart in that week, with week 1 being the first week that the song
appeared in the chart. Convert all these columns into two: an
indication of week, called <code>week</code>, and of rank, called
<code>rank</code>. Most songs appeared in the Billboard chart for a
lot less than 76 weeks, so there are missing values, which you
want to remove. (I say “indication of week” since this will
probably be text at the moment). Display your new data frame. Do
you have fewer columns? Why do you have a lot more rows? Explain
briefly.</li>
</ol>
<p>Solution</p>
<p>This is <code>gather</code>ing up all those columns, with
<code>na.rm=T</code> to get rid of the missings:</p>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb873-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) </a></code></pre></div>
<pre><code>## # A tibble: 5,307 x 9
##     year artist.inverted track time  genre date.entered date.peaked week 
##  * &lt;int&gt; &lt;chr&gt;           &lt;chr&gt; &lt;tim&gt; &lt;chr&gt; &lt;date&gt;       &lt;date&gt;      &lt;chr&gt;
##  1  2000 Destiny&#39;s Child Inde… 03:38 Rock  2000-09-23   2000-11-18  x1st…
##  2  2000 Santana         Mari… 04:18 Rock  2000-02-12   2000-04-08  x1st…
##  3  2000 Savage Garden   I Kn… 04:07 Rock  1999-10-23   2000-01-29  x1st…
##  4  2000 Madonna         Music 03:45 Rock  2000-08-12   2000-09-16  x1st…
##  5  2000 Aguilera, Chri… Come… 03:38 Rock  2000-08-05   2000-10-14  x1st…
##  6  2000 Janet           Does… 04:17 Rock  2000-06-17   2000-08-26  x1st…
##  7  2000 Destiny&#39;s Child Say … 04:31 Rock  1999-12-25   2000-03-18  x1st…
##  8  2000 Iglesias, Enri… Be W… 03:36 Latin 2000-04-01   2000-06-24  x1st…
##  9  2000 Sisqo           Inco… 03:52 Rock  2000-06-24   2000-08-12  x1st…
## 10  2000 Lonestar        Amaz… 04:25 Coun… 1999-06-05   2000-03-04  x1st…
## # ... with 5,297 more rows, and 1 more variable: rank &lt;chr&gt;</code></pre>
<p>Another way to do this is with a select-helper: all those column names
end with <code>week</code>, so we can select them all thus:</p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb875-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,<span class="kw">ends_with</span>(<span class="st">&quot;week&quot;</span>),<span class="dt">na.rm=</span>T)</a></code></pre></div>
<pre><code>## # A tibble: 5,307 x 9
##     year artist.inverted track time  genre date.entered date.peaked week 
##  * &lt;int&gt; &lt;chr&gt;           &lt;chr&gt; &lt;tim&gt; &lt;chr&gt; &lt;date&gt;       &lt;date&gt;      &lt;chr&gt;
##  1  2000 Destiny&#39;s Child Inde… 03:38 Rock  2000-09-23   2000-11-18  x1st…
##  2  2000 Santana         Mari… 04:18 Rock  2000-02-12   2000-04-08  x1st…
##  3  2000 Savage Garden   I Kn… 04:07 Rock  1999-10-23   2000-01-29  x1st…
##  4  2000 Madonna         Music 03:45 Rock  2000-08-12   2000-09-16  x1st…
##  5  2000 Aguilera, Chri… Come… 03:38 Rock  2000-08-05   2000-10-14  x1st…
##  6  2000 Janet           Does… 04:17 Rock  2000-06-17   2000-08-26  x1st…
##  7  2000 Destiny&#39;s Child Say … 04:31 Rock  1999-12-25   2000-03-18  x1st…
##  8  2000 Iglesias, Enri… Be W… 03:36 Latin 2000-04-01   2000-06-24  x1st…
##  9  2000 Sisqo           Inco… 03:52 Rock  2000-06-24   2000-08-12  x1st…
## 10  2000 Lonestar        Amaz… 04:25 Coun… 1999-06-05   2000-03-04  x1st…
## # ... with 5,297 more rows, and 1 more variable: rank &lt;chr&gt;</code></pre>
<p>There are now only 9 columns, a lot fewer than we started with. This
is (I didn’t need you to say) because we have collected together all
those <code>week</code> columns into one (a column called <code>rank</code>
with an indication of which <code>week</code> it came from). The logic of
the <code>gather</code> is that all those columns contain ranks (which is
what make them the same), but they are ranks from different weeks
(which is what makes them different).</p>
<p>What has actually happened is that we have turned “wide” format into
“long” format. This is not very insightful, so I would like you to
go a bit further in your explanation. The original data frame encodes
the rank of each song in each week, and what the <code>gather</code> has
done is to make that explicit: in the new data frame, each song’s rank
in each week appears in <em>one</em> row, so that there are as many rows
as there are song-week combinations. The original data frame had 317
songs over 76 weeks, so this many:</p>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb877-1" data-line-number="1"><span class="dv">317</span><span class="op">*</span><span class="dv">76</span></a></code></pre></div>
<pre><code>## [1] 24092</code></pre>
<p>song-week combinations.</p>
<p>Not every song appeared in the Billboard chart for 76 weeks, so our tidy
data frame has a lot fewer rows than this.</p>
<p>You need to say that the original data frame had each song appearing
once (on one line), but now each song appears on multiple rows, one
for each week that the song was in the chart. Or something equivalent
to that.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Display just your two new columns (for the first few
rows). Add something appropriate onto the end of your pipe to do this.</li>
</ol>
<p>Solution</p>
<p>A <code>select</code> is the thing:</p>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb879-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb879-2" data-line-number="2"><span class="kw">select</span>(week, rank)</a></code></pre></div>
<pre><code>## # A tibble: 5,307 x 2
##    week      rank 
##  * &lt;chr&gt;     &lt;chr&gt;
##  1 x1st.week 78   
##  2 x1st.week 15   
##  3 x1st.week 71   
##  4 x1st.week 41   
##  5 x1st.week 57   
##  6 x1st.week 59   
##  7 x1st.week 83   
##  8 x1st.week 63   
##  9 x1st.week 77   
## 10 x1st.week 81   
## # ... with 5,297 more rows</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Both your <code>week</code> and <code>rank</code> columns are
(probably) text. Create new columns that contain just the numeric
values, and display just your new columns, again adding onto the
end of your pipe. (In the previous part, you probably had some
code that picked out a few columns to display them. Get rid of
that.)</li>
</ol>
<p>Solution</p>
<p><code>parse_number</code> is the easiest. Create new columns,
with <code>mutate</code>, that are the <code>parse_number</code>-ed
versions of the old ones.</p>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb881-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb881-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb881-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb881-4" data-line-number="4"><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;number&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 5,307 x 2
##    week_number rank_number
##          &lt;dbl&gt;       &lt;dbl&gt;
##  1           1          78
##  2           1          15
##  3           1          71
##  4           1          41
##  5           1          57
##  6           1          59
##  7           1          83
##  8           1          63
##  9           1          77
## 10           1          81
## # ... with 5,297 more rows</code></pre>
<p>You see that these are indeed numbers. (I gave my new columns names
that ended with <code>number</code>, which meant that I could select them
with the select-helper <code>ends_with</code>. I’m not insisting that you
do this, but it’s a handy trick.)</p>
<p>Since <code>rank</code> already looks like a number, but happens to be
text, you can also convert it with <code>as.numeric</code> (or
<code>as.integer</code>, since it is actually text that looks like a whole
number). For converting <code>rank</code>, these are also good, but for
converting <code>week</code>, you need something that will pull out the
number. (<code>str_extract</code> from <code>stringr</code> will also do it,
but that’s beyond our scope now. It’s on page 212 of the R book if
you wish to investigate it. But <code>parse_number</code> is a lot
easier.)</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>The meaning of your week-number column is that it refers
to the number of weeks <em>after</em> the song first appeared in the
Billboard chart. That is, if a song’s first appearance (in
<code>date.entered)</code> is July 24, then week 1 is July 24, week 2
is July 31, week 3 is August 7, and so on. Create a column
<code>current</code> by adding the appropriate number of <em>days</em>,
based on your week number, to <code>date.entered</code>. Display
<code>date.entered</code>, your week number, and <code>current</code> to
show that you have calculated the right thing. Note that you can
add a number of days onto a date and you will get another date.</li>
</ol>
<p>Solution</p>
<p>There is a (small) gotcha here: if you read carefully, you’ll
see that “week 1” is actually “week 0” in terms of the
number of days to add on to <code>date.entered</code>. So you have
to subtract one from the number of weeks before you multiply
it by seven to get a number of days.
After that thinking, this:</p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb883-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb883-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb883-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb883-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb883-5" data-line-number="5"><span class="kw">select</span>(date.entered,week_number,current)</a></code></pre></div>
<pre><code>## # A tibble: 5,307 x 3
##    date.entered week_number current   
##    &lt;date&gt;             &lt;dbl&gt; &lt;date&gt;    
##  1 2000-09-23             1 2000-09-23
##  2 2000-02-12             1 2000-02-12
##  3 1999-10-23             1 1999-10-23
##  4 2000-08-12             1 2000-08-12
##  5 2000-08-05             1 2000-08-05
##  6 2000-06-17             1 2000-06-17
##  7 1999-12-25             1 1999-12-25
##  8 2000-04-01             1 2000-04-01
##  9 2000-06-24             1 2000-06-24
## 10 1999-06-05             1 1999-06-05
## # ... with 5,297 more rows</code></pre>
<p>Don’t forget to use your <code>week</code>-turned-into-number, or else it
won’t work! (This bit me too, so you don’t need to feel bad.)</p>
<p>You can also combine the three column-definition statements into one
mutate. It doesn’t matter; as soon as you have defined a column, you
can use it in defining another column, even within the same
<code>mutate</code>.</p>
<p>Anyway, the rows displayed are all <code>week_number</code> 1, so the
<code>current</code> date should be the same as <code>date.entered</code>, and
is. (These are all the first week that a song is in the Billboard
chart).</p>
<p>You might be thinking that this is not much of a check, and you would
be right. A handy trick is to display a random sample of 10 (say) out
of the 5,000-odd rows of the data frame. To do that, add the line
<code>sample_n(10)</code> on the end, like this:</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb885-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-5" data-line-number="5"><span class="kw">select</span>(date.entered,week_number,current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-6" data-line-number="6"><span class="kw">sample_n</span>(<span class="dv">10</span>)  </a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    date.entered week_number current   
##    &lt;date&gt;             &lt;dbl&gt; &lt;date&gt;    
##  1 2000-03-18            27 2000-09-16
##  2 2000-08-12             3 2000-08-26
##  3 2000-09-23             4 2000-10-14
##  4 1999-12-04            11 2000-02-12
##  5 2000-01-22             8 2000-03-11
##  6 2000-05-27            16 2000-09-09
##  7 2000-04-29             5 2000-05-27
##  8 2000-06-10             4 2000-07-01
##  9 2000-04-15            12 2000-07-01
## 10 2000-08-26            18 2000-12-23</code></pre>
<p>This gives a variety of rows to check. The first <code>current</code>
should be <span class="math inline">\(27-1=26\)</span> weeks, or about 6 months, after the date the song
entered the chart, and so it is; the second one should be <span class="math inline">\(3-1=2\)</span>
weeks after entry, and it is. The third one should be 3 weeks after
September 23; this is (as I figure it) September <span class="math inline">\(23+21=44\)</span>, and
September has 30 days, so this is really October 14. Check.</p>
<p>Your random selection of rows is likely to be different from mine, but
the same kind of thinking will enable you to check whether it makes
sense.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Reaching the #1 rank on the Billboard chart is one of
the highest accolades in the popular music world. List all the
songs that reached <code>rank</code> 1. For these songs, list the
artist (as given in the data set), the song title, and the date(s)
for which the song was ranked number 1. Arrange the songs in date
order of being ranked #1. Display all the songs (I found 55 of them).</li>
</ol>
<p>Solution</p>
<p>To the previous pipe, add the last lines below. You can use
either <code>rank</code> (text) or what I called
<code>rank_number</code> (a number). It doesn’t matter here,
since we are only checking for equal-to, not something like
“less than”:</p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb887-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb887-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-5" data-line-number="5"><span class="kw">filter</span>(rank<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-6" data-line-number="6"><span class="kw">arrange</span>(current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb887-7" data-line-number="7"><span class="kw">select</span>(artist.inverted,track,current) </a></code></pre></div>
<pre><code>## # A tibble: 55 x 3
##    artist.inverted     track                 current   
##    &lt;chr&gt;               &lt;chr&gt;                 &lt;date&gt;    
##  1 Aguilera, Christina What A Girl Wants     2000-01-15
##  2 Aguilera, Christina What A Girl Wants     2000-01-22
##  3 Savage Garden       I Knew I Loved You    2000-01-29
##  4 Savage Garden       I Knew I Loved You    2000-02-05
##  5 Savage Garden       I Knew I Loved You    2000-02-12
##  6 Carey, Mariah       Thank God I Found You 2000-02-19
##  7 Savage Garden       I Knew I Loved You    2000-02-26
##  8 Lonestar            Amazed                2000-03-04
##  9 Lonestar            Amazed                2000-03-11
## 10 Destiny&#39;s Child     Say My Name           2000-03-18
## # ... with 45 more rows</code></pre>
<p>You’ll see the first ten rows, as here, but with clickable buttons to
see the next 10 (and the previous 10 if you have moved beyond 1–10).
The “artist” column is called <code>artist.inverted</code> because, if
the artist is a single person rather than a group, their last name is
listed first. The song title appears in the column <code>track</code>.</p>
<p>The song by Destiny’s Child spills into 2001 because it entered the
chart in 2000, and the data set keeps a record of all such songs until
they drop out of the chart. I’m not sure what happened to the song
that was #1 on January 8, 2000; maybe it entered the chart in
1999
<label for="tufte-mn-34" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-34" class="margin-toggle"><span class="marginnote">Which was the title of a song by Prince.</span> and so is not
listed here.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Use R to find out which song held the #1 rank for the
largest number of weeks. For this, you can assume that the song
titles are all unique (if it’s the same song title, it’s the same
song), but the artists might not be (for example, Madonna might
have had two different songs reach the #1 rank). The information
you need is in the output you obtained for the previous part, so
it’s a matter of adding some code to the end of that.
The last mark was for displaying <em>only</em> the song that was
ranked #1 for the largest number of weeks, or for otherwise
making it easy to see which song it was.</li>
</ol>
<p>Solution</p>
<p>This is a question of using <code>count</code>, but on the
<code>track</code> title:</p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb889-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb889-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-5" data-line-number="5"><span class="kw">filter</span>(rank<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-6" data-line-number="6"><span class="kw">arrange</span>(current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-7" data-line-number="7"><span class="kw">select</span>(artist.inverted,track,current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb889-8" data-line-number="8"><span class="kw">count</span>(track)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    track                                     n
##    &lt;chr&gt;                                 &lt;int&gt;
##  1 Amazed                                    2
##  2 Bent                                      1
##  3 Be With You                               3
##  4 Come On Over Baby (All I Want Is You)     4
##  5 Doesn&#39;t Really Matter                     3
##  6 Everything You Want                       1
##  7 I Knew I Loved You                        4
##  8 Incomplete                                2
##  9 Independent Women Part I                 11
## 10 It&#39;s Gonna Be Me                          2
## 11 Maria, Maria                             10
## 12 Music                                     4
## 13 Say My Name                               3
## 14 Thank God I Found You                     1
## 15 Try Again                                 1
## 16 What A Girl Wants                         2
## 17 With Arms Wide Open                       1</code></pre>
<p>Then you can scan down the <code>n</code> column, find that the
biggest number is 11, and say: it’s the song ``Independent Women Part
I’’ by Destiny’s Child. This is 3 points (out of 4, when the question
was to be handed in).</p>
<p>But, this is a data frame, so anything we can do to a data frame we
can do to this, like listing out only the row(s) where <code>n</code> is
equal to its maximum value:</p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb891-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb891-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-5" data-line-number="5"><span class="kw">filter</span>(rank<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-6" data-line-number="6"><span class="kw">arrange</span>(current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-7" data-line-number="7"><span class="kw">select</span>(artist.inverted,track,current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-8" data-line-number="8"><span class="kw">count</span>(track) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb891-9" data-line-number="9"><span class="kw">filter</span>(n<span class="op">==</span><span class="kw">max</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   track                        n
##   &lt;chr&gt;                    &lt;int&gt;
## 1 Independent Women Part I    11</code></pre>
<p>or arranging them in (most logically, descending) order by <code>n</code>
to make it easier to pick out the top one:</p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb893-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb893-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-5" data-line-number="5"><span class="kw">filter</span>(rank<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-6" data-line-number="6"><span class="kw">arrange</span>(current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-7" data-line-number="7"><span class="kw">select</span>(artist.inverted,track,current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-8" data-line-number="8"><span class="kw">count</span>(track) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb893-9" data-line-number="9"><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    track                                     n
##    &lt;chr&gt;                                 &lt;int&gt;
##  1 Independent Women Part I                 11
##  2 Maria, Maria                             10
##  3 Come On Over Baby (All I Want Is You)     4
##  4 I Knew I Loved You                        4
##  5 Music                                     4
##  6 Be With You                               3
##  7 Doesn&#39;t Really Matter                     3
##  8 Say My Name                               3
##  9 Amazed                                    2
## 10 Incomplete                                2
## 11 It&#39;s Gonna Be Me                          2
## 12 What A Girl Wants                         2
## 13 Bent                                      1
## 14 Everything You Want                       1
## 15 Thank God I Found You                     1
## 16 Try Again                                 1
## 17 With Arms Wide Open                       1</code></pre>
<p>Either of those will net you the 4th point.</p>
<p>If you want to be a little bit more careful, you can make an
artist-track combination as below. This would catch occasions where
the same song by two different artists made it to #1, or two
different songs that happened to have the same title did. It’s not
very likely that the same artist would record two <em>different</em>
songs with the same title, though it is possible that the same song by
the same artist could appear in the Billboard chart on two different
occasions.
<label for="tufte-mn-35" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-35" class="margin-toggle"><span class="marginnote">As, for example, when Prince died.</span></p>
<p>I think I want to create an artist-song combo fairly early in my pipe,
and then display <em>that</em> later, something like this. This means
replacing <code>track</code> by my <code>combo</code> later in the pipe,
wherever it appears:</p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb895-1" data-line-number="1">billboard <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(week,rank,x1st.week<span class="op">:</span>x76th.week,<span class="dt">na.rm=</span>T) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-2" data-line-number="2"><span class="kw">mutate</span>(<span class="dt">week_number=</span><span class="kw">parse_number</span>(week),</a>
<a class="sourceLine" id="cb895-3" data-line-number="3"><span class="dt">rank_number=</span><span class="kw">parse_number</span>(rank)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-4" data-line-number="4"><span class="kw">mutate</span>(<span class="dt">combo=</span><span class="kw">paste</span>(track,artist.inverted,<span class="dt">sep=</span><span class="st">&quot; by &quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-5" data-line-number="5"><span class="kw">mutate</span>(<span class="dt">current=</span>date.entered<span class="op">+</span>(week_number<span class="dv">-1</span>)<span class="op">*</span><span class="dv">7</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-6" data-line-number="6"><span class="kw">filter</span>(rank<span class="op">==</span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-7" data-line-number="7"><span class="kw">arrange</span>(current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-8" data-line-number="8"><span class="kw">select</span>(combo,current) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-9" data-line-number="9"><span class="kw">count</span>(combo) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb895-10" data-line-number="10"><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    combo                                                            n
##    &lt;chr&gt;                                                        &lt;int&gt;
##  1 Independent Women Part I by Destiny&#39;s Child                     11
##  2 Maria, Maria by Santana                                         10
##  3 Come On Over Baby (All I Want Is You) by Aguilera, Christina     4
##  4 I Knew I Loved You by Savage Garden                              4
##  5 Music by Madonna                                                 4
##  6 Be With You by Iglesias, Enrique                                 3
##  7 Doesn&#39;t Really Matter by Janet                                   3
##  8 Say My Name by Destiny&#39;s Child                                   3
##  9 Amazed by Lonestar                                               2
## 10 Incomplete by Sisqo                                              2
## 11 It&#39;s Gonna Be Me by N&#39;Sync                                       2
## 12 What A Girl Wants by Aguilera, Christina                         2
## 13 Bent by matchbox twenty                                          1
## 14 Everything You Want by Vertical Horizon                          1
## 15 Thank God I Found You by Carey, Mariah                           1
## 16 Try Again by Aaliyah                                             1
## 17 With Arms Wide Open by Creed                                     1</code></pre>
<p>I don’t think it makes any difference here, but it might in other
years, or if you look over several years where you might get cover
versions of the same song performed by different artists.</p>
<p>Zero-point bonus: how many of these artists have you heard of? How
many have your parents heard of? (I followed popular music quite
closely much earlier than this, in the early 1980s in the UK. I
remember both Madonna and U2 when they <em>first</em> became
famous. U2’s first single was called “Fire” and it just scraped into
the UK top 40. Things changed after that.)</p>

</div>
</div>
<p style="text-align: center;">
<a href="analysis-of-variance.html"><button class="btn btn-default">Previous</button></a>
<a href="regression.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
