<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2018-10-09" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li class="has-sub"><a href="2-getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a><ul>
<li><a href="2-1-getting-an-r-studio-cloud-account.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="2-2-getting-started.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="2-3-reading-data-from-a-file.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
</ul></li>
<li class="has-sub"><a href="3-reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">3</span> Reading in data and drawing some graphs</a><ul>
<li><a href="3-1-orange-juice.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="3-2-making-soap.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="3-3-handling-shipments.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="4-data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="4-1-north-carolina-births.html#north-carolina-births"><span class="toc-section-number">4.1</span> North Carolina births</a></li>
<li><a href="4-2-more-about-the-nc-births.html#more-about-the-nc-births"><span class="toc-section-number">4.2</span> More about the NC births</a></li>
<li><a href="4-3-nenana-alaska.html#nenana-alaska"><span class="toc-section-number">4.3</span> Nenana, Alaska</a></li>
<li><a href="4-4-computerized-accounting.html#computerized-accounting"><span class="toc-section-number">4.4</span> Computerized accounting</a></li>
</ul></li>
<li class="has-sub"><a href="5-one-sample-inference.html#one-sample-inference"><span class="toc-section-number">5</span> One-sample inference</a><ul>
<li><a href="5-1-hunter-gatherers-in-australia.html#hunter-gatherers-in-australia"><span class="toc-section-number">5.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="5-2-length-of-gestation-in-north-carolina.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">5.2</span> Length of gestation in North Carolina</a></li>
<li><a href="5-3-inferring-ice-break-up-in-nenana.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">5.3</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="6-two-sample-inference.html#two-sample-inference"><span class="toc-section-number">6</span> Two-sample inference</a><ul>
<li><a href="6-1-children-and-electronic-devices.html#children-and-electronic-devices"><span class="toc-section-number">6.1</span> Children and electronic devices</a></li>
<li><a href="6-2-parking-close-to-the-curb.html#parking-close-to-the-curb"><span class="toc-section-number">6.2</span> Parking close to the curb</a></li>
</ul></li>
<li class="has-sub"><a href="7-power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">7</span> Power and sample size</a><ul>
<li><a href="7-1-simulating-power.html#simulating-power"><span class="toc-section-number">7.1</span> Simulating power</a></li>
<li><a href="7-2-calculating-power-and-sample-size-for-estimating-mean.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">7.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="7-3-simulating-power-for-proportions.html#simulating-power-for-proportions"><span class="toc-section-number">7.3</span> Simulating power for proportions</a></li>
</ul></li>
<li><a href="8-the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">8</span> The sign test and Mood’s median test</a></li>
<li><a href="9-matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">9</span> Matched pairs t and sign test</a></li>
<li><a href="10-normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">10</span> Normal quantile plots</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="simulating-power-for-proportions" class="section level2">
<h2><span class="header-section-number">7.3</span> Simulating power for proportions</h2>
<p>In opinion surveys (and other places), we are testing for a
proportion <span class="math inline">\(p\)</span> (for example, the proportion of people agreeing with
some statement). Often, we want to know whether the proportion is
“really” greater than 0.5. That would entail testing a null
<span class="math inline">\(H_0: p=0.5\)</span> against an alternative <span class="math inline">\(H_a: p&gt;0.5\)</span>. This is usually done
by calculating the test statistic
<span class="math display">\[ z = { \hat{p} - 0.5 \over \sqrt{0.25/n}},\]</span>
where <span class="math inline">\(\hat{p}\)</span> is the observed proportion in the sample,
and getting a P-value from the upper tail of a standard normal
distribution. (The 0.25 is <span class="math inline">\(p(1-p)\)</span> where <span class="math inline">\(p=0.5\)</span>.) This is what
<code>prop.test</code> does, as we investigate shortly.</p>
<ol style="list-style-type: lower-alpha">
<li>Use <code>rbinom</code> to generate a random value from a
binomial distribution with <span class="math inline">\(n=100\)</span> and <span class="math inline">\(p=0.6\)</span>. There are three
inputs to <code>rbinom</code>: the first one should be the number 1, and
the second and third are the <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> of the binomial distribution.</li>
</ol>
<p>Solution</p>
<p>I am doing some preparatory work that you don’t need to do:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb298-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">457299</span>)</a></code></pre></div>
<p>By setting the “seed” for the random number generator, I guarantee
that I will get the same answers every time I run my code below (and
therefore I can talk about my answers without worrying that they will
change). Up to you whether you do this. You can “seed” the random
number generator with any number you like. A lot of people use
<code>1</code>. Mahinda seems to like <code>123</code>. Mine is an old phone
number.</p>
<p>And so to work:</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dv">1</span>,<span class="dv">100</span>,<span class="fl">0.6</span>)</a></code></pre></div>
<pre><code>## [1] 60</code></pre>
<p>I got exactly 60% successes this time. You probably won’t get exactly
60, but you should get somewhere close. (If you use my random number
seed and use the random number generator exactly the same way I did,
you should get the same values I did.)</p>
<p>For fun, you can see what happens if you change the 1:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1"><span class="kw">rbinom</span>(<span class="dv">3</span>,<span class="dv">100</span>,<span class="fl">0.6</span>)</a></code></pre></div>
<pre><code>## [1] 58 57 55</code></pre>
<p>Three random binomials, that happened to come out just below 60. We’re
going to leave the first input as 1, though, and let <code>rerun</code>
handle “lots of sampled values” later.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Using the random binomial that you generated just above, use
<code>prop.test</code> to test whether it could reasonably have come
from a binomial population with <span class="math inline">\(n=100\)</span> and <span class="math inline">\(p=0.5\)</span>, or whether <span class="math inline">\(p\)</span>
is actually bigger than 0.5. (Of course,
you know it actually did not come from a population with <span class="math inline">\(p=0.5\)</span>.)
<code>prop.test</code> has, for us, four inputs, thus:</li>
</ol>
<ul>
<li><p>the observed number of successes</p></li>
<li><p>the <code>n</code> of the binomial distribution</p></li>
<li><p>the null-hypothesis <code>p</code> of the binomial distribution</p></li>
<li><p>the alternative hypothesis, here “greater”</p></li>
</ul>
<p>Solution</p>
<p>I got exactly 60 successes, so I do this:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1"><span class="kw">prop.test</span>(<span class="dv">60</span>,<span class="dv">100</span>,<span class="fl">0.5</span>,<span class="dt">alternative=</span><span class="st">&quot;greater&quot;</span>)</a></code></pre></div>
<pre><code>## 
##  1-sample proportions test with continuity correction
## 
## data:  60 out of 100, null probability 0.5
## X-squared = 3.61, df = 1, p-value = 0.02872
## alternative hypothesis: true p is greater than 0.5
## 95 percent confidence interval:
##  0.5127842 1.0000000
## sample estimates:
##   p 
## 0.6</code></pre>
<p>The P-value should at least be fairly small, since 60 is a bit bigger
than 50. (Think about tossing a coin 100 times; would 60 heads make
you doubt the coin’s fairness? The above says it should.)</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Run <code>prop.test</code> again, just as you did before, but this
time save the result, and extract the piece of it called
<code>p.value</code>. Is that the P-value from your test?</li>
</ol>
<p>Solution</p>
<p>Copying and pasting:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1">p_test=<span class="kw">prop.test</span>(<span class="dv">60</span>,<span class="dv">100</span>,<span class="fl">0.5</span>,<span class="dt">alternative=</span><span class="st">&quot;greater&quot;</span>)</a>
<a class="sourceLine" id="cb305-2" data-line-number="2">p_test<span class="op">$</span>p.value</a></code></pre></div>
<pre><code>## [1] 0.02871656</code></pre>
<p>$ %$ %$</p>
<p>Yep, the same.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Use <code>rerun</code> to estimate the power of a test of
<span class="math inline">\(H_0: p=0.5\)</span> against <span class="math inline">\(H_a: p&gt;0.5\)</span> when <span class="math inline">\(n=500\)</span> and <span class="math inline">\(p=0.56\)</span>, using
<span class="math inline">\(\alpha=0.05\)</span>. There are three steps:</li>
</ol>
<ul>
<li><p>use <code>rerun</code> to generate random samples from binomial
distributions with <span class="math inline">\(n=500\)</span> and <span class="math inline">\(p=0.56\)</span>, repeated “many” times
(something like 1000 or 10,000 is good)</p></li>
<li><p>use <code>map</code> to run <code>prop.test</code> on each of those
random samples</p></li>
<li><p>use <code>map_dbl</code> to extract the P-value for each test and
save the results (in a vector called, perhaps, <code>pvals</code>).</p></li>
</ul>
<p>So I lied: the fourth and final step is to count how many of
those P-values are 0.05 or less.</p>
<p>Solution</p>
<p>The previous parts, using <code>rbinom</code> and <code>prop.test</code>,
were meant to provide you with the ingredients for this part.
The first step is to use <code>rbinom</code>. The first input is 1 since
we only want one random binomial each time (the <code>rerun</code> will
handle the fact that you actually want lots of them). The second step
runs <code>prop.test</code>; the first input to that is each one of the
numbers of successes from the first step. (This is an implied
for-each, with each of the simulated binomials playing the role of
“it”, in turn.). The last part is to pull out all the P-values and
make a table of them, just like the example in class.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1"><span class="kw">rerun</span>(<span class="dv">10000</span>,<span class="kw">rbinom</span>(<span class="dv">1</span>,<span class="dv">500</span>,<span class="fl">0.56</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb307-2" data-line-number="2"><span class="kw">map</span>(<span class="op">~</span><span class="kw">prop.test</span>(.,<span class="dv">500</span>,<span class="fl">0.5</span>,<span class="dt">alternative=</span><span class="st">&quot;greater&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb307-3" data-line-number="3"><span class="kw">map_dbl</span>(<span class="st">&quot;p.value&quot;</span>) -&gt;<span class="st"> </span></a>
<a class="sourceLine" id="cb307-4" data-line-number="4">pvals</a>
<a class="sourceLine" id="cb307-5" data-line-number="5"><span class="kw">tibble</span>(pvals) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(pvals<span class="op">&lt;=</span><span class="fl">0.05</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `pvals &lt;= 0.05`     n
##   &lt;lgl&gt;           &lt;int&gt;
## 1 FALSE            1491
## 2 TRUE             8509</code></pre>
<p>The estimated power is about 85%. That is, if <span class="math inline">\(p\)</span> is actually 0.56
and we have a sample of size 500, we have a good chance of (correctly)
rejecting that <span class="math inline">\(p=0.5\)</span>.</p>
<p>Extra: I know we haven’t learned about SAS yet, but it turns out that SAS can
obtain this power by calculation. We’ll see how later in the course.
SAS says our power is also about 85%, the same thing our simulation
said. I took some care to make sure that SAS did the same thing our
simulation did. I was actually pleased that my simulation came
out so close to the right answer.</p>
<p>In contrast to <code>power.t.test</code>, SAS’s <code>proc power</code>
handles power analyses for a lot of things, including analysis of
variance, correlation and (multiple) regression. What these have in
common is some normal-based theory that allows you (under assumptions
of sufficiently normal-shaped populations) to calculate the exact
answer (that is, the distribution of the test statistic when the
<em>alternative</em> hypothesis is true). The case we looked at is one
of those because of the normal approximation to the binomial: once <span class="math inline">\(n\)</span>
gets big, particularly if <span class="math inline">\(p\)</span> is somewhere near 0.5, the binomial is
very well approximated by a normal with the right mean and SD.</p>
<p>The moral of this story is that when you have a decently large sample,
<span class="math inline">\(n=500\)</span> in this case, <span class="math inline">\(p\)</span> doesn’t have to get very far away from 0.5
before you can correctly reject 0.5. Bear in mind that sample sizes
for estimating proportions need to be larger than those for estimating
means, so <span class="math inline">\(n=500\)</span> is large without being huge. The practical upshot
is that if you design a survey and give it to 500 (or more) randomly
chosen people, the actual proportion of people in favour doesn’t have to be
much above 50% for you to correctly infer that it <em>is</em> above
50%, most of the time.</p>

</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="7-2-calculating-power-and-sample-size-for-estimating-mean.html"><button class="btn btn-default">Previous</button></a>
<a href="8-the-sign-test-and-moods-median-test.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
