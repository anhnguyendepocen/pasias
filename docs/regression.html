<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Problems and Solutions in Applied Statistics" />
<meta property="og:type" content="book" />
<meta property="og:url" content="<a href="http://ritsokiguess.site/pasias" class="uri">http://ritsokiguess.site/pasias</a>" />

<meta property="og:description" content="A set of problems and solutions, in R, on various parts of applied statistics" />
<meta name="github-repo" content="nxskok/pasias" />

<meta name="author" content="Ken Butler" />

<meta name="date" content="2018-10-09" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>

<meta name="description" content="A set of problems and solutions, in R, on various parts of applied statistics">

<title>Problems and Solutions in Applied Statistics</title>

<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li class="has-sub"><a href="getting-used-to-r-and-r-studio.html#getting-used-to-r-and-r-studio"><span class="toc-section-number">2</span> Getting used to R and R Studio</a><ul>
<li><a href="getting-used-to-r-and-r-studio.html#getting-an-r-studio-cloud-account"><span class="toc-section-number">2.1</span> Getting an R Studio Cloud account</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#getting-started"><span class="toc-section-number">2.2</span> Getting started</a></li>
<li><a href="getting-used-to-r-and-r-studio.html#reading-data-from-a-file"><span class="toc-section-number">2.3</span> Reading data from a file</a></li>
</ul></li>
<li class="has-sub"><a href="reading-in-data-and-drawing-some-graphs.html#reading-in-data-and-drawing-some-graphs"><span class="toc-section-number">3</span> Reading in data and drawing some graphs</a><ul>
<li><a href="reading-in-data-and-drawing-some-graphs.html#orange-juice"><span class="toc-section-number">3.1</span> Orange juice</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#making-soap"><span class="toc-section-number">3.2</span> Making soap</a></li>
<li><a href="reading-in-data-and-drawing-some-graphs.html#handling-shipments"><span class="toc-section-number">3.3</span> Handling shipments</a></li>
</ul></li>
<li class="has-sub"><a href="data-exploration.html#data-exploration"><span class="toc-section-number">4</span> Data exploration</a><ul>
<li><a href="data-exploration.html#north-carolina-births"><span class="toc-section-number">4.1</span> North Carolina births</a></li>
<li><a href="data-exploration.html#more-about-the-nc-births"><span class="toc-section-number">4.2</span> More about the NC births</a></li>
<li><a href="data-exploration.html#nenana-alaska"><span class="toc-section-number">4.3</span> Nenana, Alaska</a></li>
<li><a href="data-exploration.html#computerized-accounting"><span class="toc-section-number">4.4</span> Computerized accounting</a></li>
</ul></li>
<li class="has-sub"><a href="one-sample-inference.html#one-sample-inference"><span class="toc-section-number">5</span> One-sample inference</a><ul>
<li><a href="one-sample-inference.html#hunter-gatherers-in-australia"><span class="toc-section-number">5.1</span> Hunter-gatherers in Australia</a></li>
<li><a href="one-sample-inference.html#length-of-gestation-in-north-carolina"><span class="toc-section-number">5.2</span> Length of gestation in North Carolina</a></li>
<li><a href="one-sample-inference.html#inferring-ice-break-up-in-nenana"><span class="toc-section-number">5.3</span> Inferring ice break-up in Nenana</a></li>
</ul></li>
<li class="has-sub"><a href="two-sample-inference.html#two-sample-inference"><span class="toc-section-number">6</span> Two-sample inference</a><ul>
<li><a href="two-sample-inference.html#children-and-electronic-devices"><span class="toc-section-number">6.1</span> Children and electronic devices</a></li>
<li><a href="two-sample-inference.html#parking-close-to-the-curb"><span class="toc-section-number">6.2</span> Parking close to the curb</a></li>
</ul></li>
<li class="has-sub"><a href="power-and-sample-size.html#power-and-sample-size"><span class="toc-section-number">7</span> Power and sample size</a><ul>
<li><a href="power-and-sample-size.html#simulating-power"><span class="toc-section-number">7.1</span> Simulating power</a></li>
<li><a href="power-and-sample-size.html#calculating-power-and-sample-size-for-estimating-mean"><span class="toc-section-number">7.2</span> Calculating power and sample size for estimating mean</a></li>
<li><a href="power-and-sample-size.html#simulating-power-for-proportions"><span class="toc-section-number">7.3</span> Simulating power for proportions</a></li>
</ul></li>
<li class="has-sub"><a href="the-sign-test-and-moods-median-test.html#the-sign-test-and-moods-median-test"><span class="toc-section-number">8</span> The sign test and Mood’s median test</a><ul>
<li><a href="the-sign-test-and-moods-median-test.html#running-a-maze"><span class="toc-section-number">8.1</span> Running a maze</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#chocolate-chips"><span class="toc-section-number">8.2</span> Chocolate chips</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#the-power-of-the-sign-test"><span class="toc-section-number">8.3</span> The power of the sign test</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#sugar-in-breakfast-cereals"><span class="toc-section-number">8.4</span> Sugar in breakfast cereals</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#fear-of-math"><span class="toc-section-number">8.5</span> Fear of math</a></li>
<li><a href="the-sign-test-and-moods-median-test.html#medical-instructions"><span class="toc-section-number">8.6</span> Medical instructions</a></li>
</ul></li>
<li class="has-sub"><a href="matched-pairs-t-and-sign-test.html#matched-pairs-t-and-sign-test"><span class="toc-section-number">9</span> Matched pairs t and sign test</a><ul>
<li><a href="matched-pairs-t-and-sign-test.html#measuring-body-fat"><span class="toc-section-number">9.1</span> Measuring body fat</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#throwing-baseballs-and-softballs"><span class="toc-section-number">9.2</span> Throwing baseballs and softballs</a></li>
<li><a href="matched-pairs-t-and-sign-test.html#changes-in-salary"><span class="toc-section-number">9.3</span> Changes in salary</a></li>
</ul></li>
<li class="has-sub"><a href="normal-quantile-plots.html#normal-quantile-plots"><span class="toc-section-number">10</span> Normal quantile plots</a><ul>
<li><a href="normal-quantile-plots.html#lengths-of-heliconia-flowers"><span class="toc-section-number">10.1</span> Lengths of heliconia flowers</a></li>
<li><a href="normal-quantile-plots.html#ferritin-and-normality"><span class="toc-section-number">10.2</span> Ferritin and normality</a></li>
</ul></li>
<li class="has-sub"><a href="analysis-of-variance.html#analysis-of-variance"><span class="toc-section-number">11</span> Analysis of variance</a><ul>
<li><a href="analysis-of-variance.html#movie-ratings-and-lengths"><span class="toc-section-number">11.1</span> Movie ratings and lengths</a></li>
<li><a href="analysis-of-variance.html#deer-and-how-much-they-eat"><span class="toc-section-number">11.2</span> Deer and how much they eat</a></li>
<li><a href="analysis-of-variance.html#movie-ratings-again"><span class="toc-section-number">11.3</span> Movie ratings again</a></li>
<li><a href="analysis-of-variance.html#atomic-weight-of-carbon"><span class="toc-section-number">11.4</span> Atomic weight of carbon</a></li>
</ul></li>
<li class="has-sub"><a href="tidying-and-selecting-data.html#tidying-and-selecting-data"><span class="toc-section-number">12</span> Tidying and selecting data</a><ul>
<li><a href="tidying-and-selecting-data.html#tidying-the-jays-data"><span class="toc-section-number">12.1</span> Tidying the Jays data</a></li>
<li><a href="tidying-and-selecting-data.html#ethanol-and-sleep-time-in-rats"><span class="toc-section-number">12.2</span> Ethanol and sleep time in rats</a></li>
<li><a href="tidying-and-selecting-data.html#growth-of-tomatoes"><span class="toc-section-number">12.3</span> Growth of tomatoes</a></li>
<li><a href="tidying-and-selecting-data.html#pain-relief-in-migraine-headaches-again"><span class="toc-section-number">12.4</span> Pain relief in migraine headaches (again)</a></li>
<li><a href="tidying-and-selecting-data.html#location-species-and-disease-in-plants"><span class="toc-section-number">12.5</span> Location, species and disease in plants</a></li>
<li><a href="tidying-and-selecting-data.html#kens-cars"><span class="toc-section-number">12.6</span> Ken’s cars</a></li>
<li><a href="tidying-and-selecting-data.html#number-1-songs"><span class="toc-section-number">12.7</span> Number 1 songs</a></li>
</ul></li>
<li class="has-sub"><a href="regression.html#regression"><span class="toc-section-number">13</span> Regression</a><ul>
<li><a href="regression.html#rainfall-in-california"><span class="toc-section-number">13.1</span> Rainfall in California</a></li>
<li><a href="regression.html#carbon-monoxide-in-cigarettes"><span class="toc-section-number">13.2</span> Carbon monoxide in cigarettes</a></li>
<li><a href="regression.html#maximal-oxygen-uptake-in-young-boys"><span class="toc-section-number">13.3</span> Maximal oxygen uptake in young boys</a></li>
<li><a href="regression.html#mating-songs-in-crickets"><span class="toc-section-number">13.4</span> Mating songs in crickets</a></li>
<li><a href="regression.html#facebook-friends-and-grey-matter"><span class="toc-section-number">13.5</span> Facebook friends and grey matter</a></li>
<li><a href="regression.html#endogenous-nitrogen-excretion-in-carp"><span class="toc-section-number">13.6</span> Endogenous nitrogen excretion in carp</a></li>
<li><a href="regression.html#sparrowhawks"><span class="toc-section-number">13.7</span> Sparrowhawks</a></li>
<li><a href="regression.html#salaries-of-social-workers"><span class="toc-section-number">13.8</span> Salaries of social workers</a></li>
<li><a href="regression.html#predicting-volume-of-wood-in-pine-trees"><span class="toc-section-number">13.9</span> Predicting volume of wood in pine trees</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="regression" class="section level1">
<h1><span class="header-section-number">Chapter 13</span> Regression</h1>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb897-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
<pre><code>## ── Attaching packages ────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.0.0     ✔ purrr   0.2.5
## ✔ tibble  1.4.2     ✔ dplyr   0.7.6
## ✔ tidyr   0.8.1     ✔ stringr 1.3.1
## ✔ readr   1.1.1     ✔ forcats 0.3.0</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div id="rainfall-in-california" class="section level2">
<h2><span class="header-section-number">13.1</span> Rainfall in California</h2>
<p>The data in
<a href="http://www.utsc.utoronto.ca/~butler/c32/calirain.txt">link</a> are
rainfall and other measurements for 30 weather stations in
California. Our aim is to understand how well the annual rainfall at
these stations (measured in inches) can be predicted from the other
measurements, which are the altitude (in feet above sea level), the
latitude (degrees north of the equator) and the distance from the
coast (in miles).</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R. You’ll have to be careful here, since the
values are space-delimited, but sometimes by more than one space, to
make the columns line up. <code>read_table2</code>, with filename or
url, will read it in.
One of the variables
is called <code>rainfall</code>, so as long as you <em>do not</em> call
the data frame that, you should be safe.</li>
</ol>
<p>Solution</p>
<p>I used <code>rains</code> as the name of my data frame:</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb901-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/calirain.txt&quot;</span></a>
<a class="sourceLine" id="cb901-2" data-line-number="2">rains=<span class="kw">read_table2</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   station = col_character(),
##   rainfall = col_double(),
##   altitude = col_integer(),
##   latitude = col_double(),
##   fromcoast = col_integer()
## )</code></pre>
<p>I have the right number of rows and columns.</p>
<p>There is also <code>read_table</code>, but that requires <em>all</em> the
columns, including the header row, to be lined up. You can try that
here and see how it fails.</p>
<p>I don’t need you to investigate the data yet (that happens in the next
part), but this is interesting (to me):</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb903-1" data-line-number="1">rains</a></code></pre></div>
<pre><code>## # A tibble: 30 x 5
##    station      rainfall altitude latitude fromcoast
##    &lt;chr&gt;           &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;     &lt;int&gt;
##  1 Eureka           39.6       43     40.8         1
##  2 RedBluff         23.3      341     40.2        97
##  3 Thermal          18.2     4152     33.8        70
##  4 FortBragg        37.5       74     39.4         1
##  5 SodaSprings      49.3     6752     39.3       150
##  6 SanFrancisco     21.8       52     37.8         5
##  7 Sacramento       18.1       25     38.5        80
##  8 SanJose          14.2       95     37.4        28
##  9 GiantForest      42.6     6360     36.6       145
## 10 Salinas          13.8       74     36.7        12
## # ... with 20 more rows</code></pre>
<p>Some of the station names are two words, but they have been smooshed
into one word, so that <code>read_table2</code> will recognize them as a
single thing. Someone had already done that for us, so I didn’t even
have to do it myself.</p>
<p>If the station names had been two genuine words, a <code>.csv</code> would
probably have been the best choice (the actual data values being
separated by commas then, and not spaces).</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a boxplot of the rainfall figures, and explain why the
values are reasonable. (A rainfall cannot be negative, and it is
unusual for a annual rainfall to exceed 60 inches.) A
<code>ggplot</code> boxplot needs <em>something</em> on the <span class="math inline">\(x\)</span>-axis: the
number 1 will do.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb905-1" data-line-number="1"><span class="kw">ggplot</span>(rains,<span class="kw">aes</span>(<span class="dt">y=</span>rainfall,<span class="dt">x=</span><span class="dv">1</span>))<span class="op">+</span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-4-1.png" width="672"  /></p>
<p>There is only one rainfall over 60 inches, and the smallest one is
close to zero but positive, so that is good.</p>
<p>Another possible plot here is a histogram, since there is only one quantitative variable:</p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb906-1" data-line-number="1"><span class="kw">ggplot</span>(rains, <span class="kw">aes</span>(<span class="dt">x=</span>rainfall))<span class="op">+</span><span class="kw">geom_histogram</span>(<span class="dt">bins=</span><span class="dv">7</span>)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-5-1.png" width="672"  /></p>
<p>This clearly shows the rainfall value above 60 inches, but some other things are less clear: are those two rainfall values around 50 inches above or below 50, and are those six rainfall values near zero actually above zero?
Extra: What stations have those extreme values? Should you wish to find out:</p>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb907-1" data-line-number="1">rains <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rainfall<span class="op">&gt;</span><span class="dv">60</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   station      rainfall altitude latitude fromcoast
##   &lt;chr&gt;           &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;     &lt;int&gt;
## 1 CrescentCity     74.9       35     41.7         1</code></pre>
<p>This is a place right on the Pacific coast, almost up into Oregon (it’s almost
the northernmost of all the stations). So it makes sense that it would
have a high rainfall, if anywhere does. (If you know anything about
rainy places, you’ll probably think of Vancouver and Seattle, in the
Pacific Northwest.) Here it is:
<a href="https://www.google.ca/maps/place/Crescent+City,+CA,+USA/@41.7552589,-123.9652917,8.42z/data=!4m5!3m4!1s0x54d066375c6288db:0x76e89ab07375e62e!8m2!3d41.7557501!4d-124.2025913">link</a>.
Which station has less than 2 inches of annual rainfall?</p>
<div class="sourceCode" id="cb909"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb909-1" data-line-number="1">rains <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rainfall<span class="op">&lt;</span><span class="dv">2</span>)  </a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   station     rainfall altitude latitude fromcoast
##   &lt;chr&gt;          &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt;     &lt;int&gt;
## 1 DeathValley     1.66     -178     36.5       194</code></pre>
<p>The name of the station is a clue: this one is in the desert. So you’d
expect very little rain. Its altitude is <em>negative</em>, so it’s
actually <em>below</em> sea level. This is correct. Here is where it is:
<a href="https://www.google.ca/maps/place/Death+Valley,+CA,+USA/@36.6341288,-118.2252974,7.75z/data=!4m5!3m4!1s0x80c739a21e8fffb1:0x1c897383d723dd25!8m2!3d36.5322649!4d-116.9325408">link</a>.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Plot <code>rainfall</code> against each of the other quantitative
variables (that is, not <code>station</code>).</li>
</ol>
<p>Solution</p>
<p>That is, <code>altitude</code>, <code>latitude</code> and
<code>fromcoast</code>. The obvious way to do this (perfectly
acceptable) is one plot at a time:</p>
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb911-1" data-line-number="1"><span class="kw">ggplot</span>(rains,<span class="kw">aes</span>(<span class="dt">y=</span>rainfall,<span class="dt">x=</span>altitude))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-8-1.png" width="672"  /></p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" data-line-number="1"><span class="kw">ggplot</span>(rains,<span class="kw">aes</span>(<span class="dt">y=</span>rainfall,<span class="dt">x=</span>latitude))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-9-1.png" width="672"  /></p>
<p>and finally</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb913-1" data-line-number="1"><span class="kw">ggplot</span>(rains,<span class="kw">aes</span>(<span class="dt">y=</span>rainfall,<span class="dt">x=</span>fromcoast))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-10-1.png" width="672"  /></p>
<p>You can add a smooth trend to these if you want. Up to you. Just the
points is fine with me.</p>
<p>Here is a funky way to get all three plots in one shot:</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" data-line-number="1">rains <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(xname,x,altitude<span class="op">:</span>fromcoast) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb914-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>rainfall))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb914-3" data-line-number="3"><span class="kw">facet_wrap</span>(<span class="op">~</span>xname,<span class="dt">scales=</span><span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-11-1.png" width="672"  /></p>
<p>This always seems extraordinarily strange if you haven’t run into it
before. The strategy is to put <em>all</em> the <span class="math inline">\(x\)</span>-variables you want
to plot into <em>one</em> column and then plot your <span class="math inline">\(y\)</span> against the
<span class="math inline">\(x\)</span>-column. A nice side-effect of the way <code>gather</code> works is
that what makes the <span class="math inline">\(x\)</span>-columns different is that they are
<span class="math inline">\(x\)</span>-variables with different <em>names</em>, which is exactly what you
want later for the facets. Thus: make a column of all the <span class="math inline">\(x\)</span>’s glued
together, labelled by which <span class="math inline">\(x\)</span> they are, then plot <span class="math inline">\(y\)</span> against <span class="math inline">\(x\)</span>
but make a different sub-plot or “facet” for each different
<span class="math inline">\(x\)</span>-name. The last thing is that each <span class="math inline">\(x\)</span> is measured on a different
scale, and unless we take steps, all the sub-plots will have the
<em>same</em> scale on each axis, which we don’t want.</p>
<p>I’m not sure I like how it came out, with three very tall
plots. <code>facet_wrap</code> can also take an <code>nrow</code> or an
<code>ncol</code>, which tells it how many rows or columns to use for the
display. Here, for example, two columns because I thought three was
too many:</p>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb915-1" data-line-number="1">rains <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gather</span>(xname,x,altitude<span class="op">:</span>fromcoast) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb915-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>rainfall))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb915-3" data-line-number="3"><span class="kw">facet_wrap</span>(<span class="op">~</span>xname,<span class="dt">scales=</span><span class="st">&quot;free&quot;</span>,<span class="dt">ncol=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-12-1.png" width="672"  /></p>
<p>Now, the three plots have come out about square, which I like a lot better.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Look at the relationship of each other variable with
<code>rainfall</code>.
Justify the assertion that <code>latitude</code> seems most strongly
related with <code>rainfall</code>. Is that relationship positive or negative? linear? Explain
briefly.</li>
</ol>
<p>Solution</p>
<p>Let’s look at the three variables in turn:</p>
<ul>
<li><p><code>altitude</code>: not much of anything. The stations near
sea level have rainfall all over the place, though the three
highest-altitude stations have the three highest rainfalls apart
from Crescent City.</p></li>
<li><p><code>latitude</code>: there is a definite upward trend here, in
that stations further north (higher latitude) are likely to have
a higher rainfall. I’d call this trend linear (or, not obviously
curved), though the two most northerly stations have one higher
and one much lower rainfall than you’d expect.</p></li>
<li><p><code>fromcoast</code>: this is a weak downward trend, though
the trend is spoiled by those three stations about 150 miles
from the coast that have more than 40 inches of rainfall.</p></li>
</ul>
<p>Out of those, only <code>latitude</code> seems to have any meaningful
relationship with <code>rainfall</code>.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Fit a regression with <code>rainfall</code> as the response
variable, and <code>latitude</code> as your explanatory variable. What
are the intercept, slope and R-squared values? Is there a
<em>significant</em> relationship between <code>rainfall</code> and your
explanatory variable? What does that mean?</li>
</ol>
<p>Solution</p>
<p>Save your <code>lm</code> into a
variable, since it will get used again later:</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" data-line-number="1">rainfall<span class="fl">.1</span>=<span class="kw">lm</span>(rainfall<span class="op">~</span>latitude,<span class="dt">data=</span>rains)</a>
<a class="sourceLine" id="cb916-2" data-line-number="2"><span class="kw">summary</span>(rainfall<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rainfall ~ latitude, data = rains)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -27.297  -7.956  -2.103   6.082  38.262 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -113.3028    35.7210  -3.172  0.00366 ** 
## latitude       3.5950     0.9623   3.736  0.00085 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 13.82 on 28 degrees of freedom
## Multiple R-squared:  0.3326, Adjusted R-squared:  0.3088 
## F-statistic: 13.96 on 1 and 28 DF,  p-value: 0.0008495</code></pre>
<p>My intercept is <span class="math inline">\(-113.3\)</span>, slope is <span class="math inline">\(3.6\)</span> and R-squared is <span class="math inline">\(0.33\)</span> or
33%. (I want you to pull these numbers out of the output and round
them off to something sensible.) The slope is significantly nonzero,
its P-value being 0.00085: rainfall really does depend on latitude, although
not strongly so.</p>
<p>Extra: Of course, I can easily do the others as well, though you don’t have to:</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" data-line-number="1">rainfall<span class="fl">.2</span>=<span class="kw">lm</span>(rainfall<span class="op">~</span>fromcoast,<span class="dt">data=</span>rains)</a>
<a class="sourceLine" id="cb918-2" data-line-number="2"><span class="kw">summary</span>(rainfall<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rainfall ~ fromcoast, data = rains)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -15.240  -9.431  -6.603   2.871  51.147 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 23.77306    4.61296   5.154 1.82e-05 ***
## fromcoast   -0.05039    0.04431  -1.137    0.265    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 16.54 on 28 degrees of freedom
## Multiple R-squared:  0.04414,    Adjusted R-squared:   0.01 
## F-statistic: 1.293 on 1 and 28 DF,  p-value: 0.2651</code></pre>
<p>Here, the intercept is 23.8, the slope is <span class="math inline">\(-0.05\)</span> and R-squared is a
dismal 0.04 (4%). This is a way of seeing that this relationship is
really weak, and it doesn’t even have a curve to the trend or anything
that would compensate for this. I looked at the scatterplot again and
saw that if it were not for the point bottom right which is furthest
from the coast and has almost no rainfall, there would be almost no
trend at all. The slope here is not significantly different from zero,
with a P-value of 0.265.</p>
<p>Finally:</p>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb920-1" data-line-number="1">rainfall<span class="fl">.3</span>=<span class="kw">lm</span>(rainfall<span class="op">~</span>altitude,<span class="dt">data=</span>rains)</a>
<a class="sourceLine" id="cb920-2" data-line-number="2"><span class="kw">summary</span>(rainfall<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rainfall ~ altitude, data = rains)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -20.620  -8.479  -2.729   4.555  58.271 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 16.514799   3.539141   4.666  6.9e-05 ***
## altitude     0.002394   0.001428   1.676    0.105    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 16.13 on 28 degrees of freedom
## Multiple R-squared:  0.09121,    Adjusted R-squared:  0.05875 
## F-statistic:  2.81 on 1 and 28 DF,  p-value: 0.1048</code></pre>
<p>The intercept is 16.5, the slope is 0.002 and the R-squared is 0.09 or
9%, also terrible. The P-value is 0.105, which is not small enough to
be significant.</p>
<p>So it looks as if it’s only <code>latitude</code> that
has any impact at all. This is the only explanatory variable with a
significantly nonzero slope. On its own, at least.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Fit a multiple regression predicting <code>rainfall</code> from
all three of the other (quantitative) variables. Display the
results. Comment is coming up later.</li>
</ol>
<p>Solution</p>
<p>This, then:</p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb922-1" data-line-number="1">rainfall<span class="fl">.4</span>=<span class="kw">lm</span>(rainfall<span class="op">~</span>latitude<span class="op">+</span>altitude<span class="op">+</span>fromcoast,<span class="dt">data=</span>rains)</a>
<a class="sourceLine" id="cb922-2" data-line-number="2"><span class="kw">summary</span>(rainfall<span class="fl">.4</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = rainfall ~ latitude + altitude + fromcoast, data = rains)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -28.722  -5.603  -0.531   3.510  33.317 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.024e+02  2.921e+01  -3.505 0.001676 ** 
## latitude     3.451e+00  7.949e-01   4.342 0.000191 ***
## altitude     4.091e-03  1.218e-03   3.358 0.002431 ** 
## fromcoast   -1.429e-01  3.634e-02  -3.931 0.000559 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 11.1 on 26 degrees of freedom
## Multiple R-squared:  0.6003, Adjusted R-squared:  0.5542 
## F-statistic: 13.02 on 3 and 26 DF,  p-value: 2.205e-05</code></pre>
<ol start="7" style="list-style-type: lower-alpha">
<li>What is the R-squared for the regression of the last part?
How does that compare with the R-squared of your regression in part (e)?</li>
</ol>
<p>Solution</p>
<p>The R-squared is 0.60 (60%), which is quite a bit bigger than the
R-squared of 0.33 (33%) we got back in (e).</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>What do you conclude about the importance of the variables
that you did <em>not</em> include in your model in
(e)? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Both variables <code>altitude</code> and <code>fromcoast</code> are
significant in this regression, so they have <em>something to add</em> over and above <code>latitude</code> when it comes to
predicting rainfall, even though (and this seems odd) they have no
apparent relationship with <code>rainfall</code> on their own.
Another way to say this is that the three variables work together
as a team to predict rainfall, and together they do much better
than any one of them can do by themselves.<br />
This also goes to show that the scatterplots we began
with don’t get to the heart of multi-variable relationships,
because they are only looking at the variables two at a time.</p>
<ol style="list-style-type: lower-roman">
<li>Make a suitable hypothesis test that the variables
<code>altitude</code> and <code>fromcoast</code> significantly improve the
prediction of <code>rainfall</code> over the use of <code>latitude</code>
alone. What do you conclude?</li>
</ol>
<p>Solution</p>
<p>This calls for <code>anova</code>. Feed this two fitted models,
smaller (fewer explanatory variables) first. The null hypothesis
is that the two models are equally good (so we should go with the
smaller); the alternative is that the larger model is better, so
that the extra complication is worth it:</p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb924-1" data-line-number="1"><span class="kw">anova</span>(rainfall<span class="fl">.1</span>,rainfall<span class="fl">.4</span>)  </a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: rainfall ~ latitude
## Model 2: rainfall ~ latitude + altitude + fromcoast
##   Res.Df    RSS Df Sum of Sq      F   Pr(&gt;F)   
## 1     28 5346.8                                
## 2     26 3202.3  2    2144.5 8.7057 0.001276 **
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The P-value is small, so we reject the null in favour of the
alternative: the regression with all three explanatory variables fits
better than the one with just <code>latitude</code>, so the bigger model
is the one we should go with.</p>
<p>If you have studied these things: this one is a
“multiple-partial <span class="math inline">\(F\)</span>-test”, for testing the combined significance of more than one <span class="math inline">\(x\)</span>
but less than all the <span class="math inline">\(x\)</span>’s.
<label for="tufte-mn-36" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-36" class="margin-toggle"><span class="marginnote">If you had just one <span class="math inline">\(x\)</span>, you’d use a <span class="math inline">\(t\)</span>-test for its slope, and if you were testing all the <span class="math inline">\(x\)</span>’s, you’d use the global <span class="math inline">\(F\)</span>-test that appears in the regression output.</span></p>
</div>
<div id="carbon-monoxide-in-cigarettes" class="section level2">
<h2><span class="header-section-number">13.2</span> Carbon monoxide in cigarettes</h2>
<p>The (US) Federal Trade Commission assesses cigarettes
according to their tar, nicotine and carbon monoxide contents. In a
particular year, 25 brands were assessed. For each brand, the tar,
nicotine and carbon monoxide (all in milligrams) were measured, along
with the weight in grams. Our aim is to predict carbon monoxide from
any or all of the other variables. The data are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/ftccigar.txt">link</a>. These are
aligned by column (except for the variable names), with more than one
space between each column of data.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R, and check that you have 25 observations
and 4 variables.</li>
</ol>
<p>Solution</p>
<p>This specification calls for <code>read_table2</code>:</p>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb926-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/ftccigar.txt&quot;</span></a>
<a class="sourceLine" id="cb926-2" data-line-number="2">cigs=<span class="kw">read_table2</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   tar = col_double(),
##   nicotine = col_double(),
##   weight = col_double(),
##   co = col_double()
## )</code></pre>
<div class="sourceCode" id="cb928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb928-1" data-line-number="1">cigs</a></code></pre></div>
<pre><code>## # A tibble: 25 x 4
##      tar nicotine weight    co
##    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1  14.1     0.86  0.985  13.6
##  2  16       1.06  1.09   16.6
##  3  29.8     2.03  1.16   23.5
##  4   8       0.67  0.928  10.2
##  5   4.1     0.4   0.946   5.4
##  6  15       1.04  0.888  15  
##  7   8.8     0.76  1.03    9  
##  8  12.4     0.95  0.922  12.3
##  9  16.6     1.12  0.937  16.3
## 10  14.9     1.02  0.886  15.4
## # ... with 15 more rows</code></pre>
<p>Yes, I have 25 observations on 4 variables indeed.</p>
<p><code>read_delim</code> won’t work (try it and see what happens), because
that would require the values to be separated by <em>exactly one</em> space.</p>
<p>(b)??part:regone?? Run a regression to predict carbon monoxide from the other
variables, and obtain a summary of the output.</p>
<p>Solution</p>
<p>The word “summary” is meant to be a big clue that
<code>summary</code> is what you need:</p>
<div class="sourceCode" id="cb930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb930-1" data-line-number="1">cigs<span class="fl">.1</span>=<span class="kw">lm</span>(co<span class="op">~</span>tar<span class="op">+</span>nicotine<span class="op">+</span>weight,<span class="dt">data=</span>cigs) </a>
<a class="sourceLine" id="cb930-2" data-line-number="2"><span class="kw">summary</span>(cigs<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = co ~ tar + nicotine + weight, data = cigs)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.89261 -0.78269  0.00428  0.92891  2.45082 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.2022     3.4618   0.925 0.365464    
## tar           0.9626     0.2422   3.974 0.000692 ***
## nicotine     -2.6317     3.9006  -0.675 0.507234    
## weight       -0.1305     3.8853  -0.034 0.973527    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.446 on 21 degrees of freedom
## Multiple R-squared:  0.9186, Adjusted R-squared:  0.907 
## F-statistic: 78.98 on 3 and 21 DF,  p-value: 1.329e-11</code></pre>
<p>(c)??part:regtwo?? Which one of your explanatory variables would you
remove from this regression? Explain (very) briefly. Go ahead and
fit the regression without it, and describe how the change in
R-squared from the regression in (??part:regone??) was entirely predictable.</p>
<p>Solution</p>
<p>First, the <span class="math inline">\(x\)</span>-variable to remove. The obvious candidate is
<code>weight</code>, since it has easily the highest, and clearly
non-significant, P-value. So, out it comes:</p>
<div class="sourceCode" id="cb932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb932-1" data-line-number="1">cigs<span class="fl">.2</span>=<span class="kw">lm</span>(co<span class="op">~</span>tar<span class="op">+</span>nicotine,<span class="dt">data=</span>cigs)</a>
<a class="sourceLine" id="cb932-2" data-line-number="2"><span class="kw">summary</span>(cigs<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = co ~ tar + nicotine, data = cigs)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.89941 -0.78470 -0.00144  0.91585  2.43064 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.0896     0.8438   3.662 0.001371 ** 
## tar           0.9625     0.2367   4.067 0.000512 ***
## nicotine     -2.6463     3.7872  -0.699 0.492035    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.413 on 22 degrees of freedom
## Multiple R-squared:  0.9186, Adjusted R-squared:  0.9112 
## F-statistic: 124.1 on 2 and 22 DF,  p-value: 1.042e-12</code></pre>
<p>R-squared has dropped from 0.9186 to 0.9186! That is, taking
out <code>weight</code> has not just had a minimal effect on R-squared;
it’s not changed R-squared at all. This is because <code>weight</code> was
so far from being significant: it literally had <em>nothing</em> to add.</p>
<p>Another way of achieving the same thing is via the function
<code>update</code>, which takes a fitted model object and describes the
<em>change</em> that you want to make:</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" data-line-number="1">cigs<span class="fl">.2</span>a=<span class="kw">update</span>(cigs<span class="fl">.1</span>,.<span class="op">~</span>.<span class="op">-</span>weight)</a>
<a class="sourceLine" id="cb934-2" data-line-number="2"><span class="kw">summary</span>(cigs<span class="fl">.2</span>a)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = co ~ tar + nicotine, data = cigs)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.89941 -0.78470 -0.00144  0.91585  2.43064 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   3.0896     0.8438   3.662 0.001371 ** 
## tar           0.9625     0.2367   4.067 0.000512 ***
## nicotine     -2.6463     3.7872  -0.699 0.492035    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.413 on 22 degrees of freedom
## Multiple R-squared:  0.9186, Adjusted R-squared:  0.9112 
## F-statistic: 124.1 on 2 and 22 DF,  p-value: 1.042e-12</code></pre>
<p>This can be shorter than describing the whole model again, as you do
with the <code>cigs.2</code> version of <code>lm</code>. The syntax is that
you first specify a “base” fitted model object that you’re going to
update. Because the model <code>cigs.1</code> contains all the information
about the kind of model it is, and which data frame the data come
from, R already knows that this is a linear
multiple regression and which <span class="math inline">\(x\)</span>’s it contains. The second thing to describe is the change from
the “base”. In this case, we want to use the same response variable
and all the same explanatory variables that we had before, except for
<code>weight</code>. This is specified by a special kind of model formula
where <code>.</code> means “whatever was there before”: in English,
“same response and same explanatories except take out <code>weight</code>”.</p>
<p>(d)??part:regthree?? Fit a regression predicting carbon monoxide from
<code>nicotine</code> <em>only</em>, and display the summary.</p>
<p>Solution</p>
<p>As you would guess:</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" data-line-number="1">cigs<span class="fl">.3</span>=<span class="kw">lm</span>(co<span class="op">~</span>nicotine,<span class="dt">data=</span>cigs)</a>
<a class="sourceLine" id="cb936-2" data-line-number="2"><span class="kw">summary</span>(cigs<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = co ~ nicotine, data = cigs)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.3273 -1.2228  0.2304  1.2700  3.9357 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   1.6647     0.9936   1.675    0.107    
## nicotine     12.3954     1.0542  11.759 3.31e-11 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.828 on 23 degrees of freedom
## Multiple R-squared:  0.8574, Adjusted R-squared:  0.8512 
## F-statistic: 138.3 on 1 and 23 DF,  p-value: 3.312e-11</code></pre>
<ol start="5" style="list-style-type: lower-alpha">
<li><code>nicotine</code> was far from being significant in the model
of (??part:regtwo??), and yet in the model of
(??part:regthree??), it was <em>strongly</em> significant, and the
R-squared value of (??part:regthree??) was almost as high as that
of (??part:regtwo??). What does this say about the importance of
<code>nicotine</code> as an explanatory variable? Explain, as briefly as
you can manage.</li>
</ol>
<p>Solution</p>
<p>What this says is that you <em>cannot</em> say anything about the
“importance” of <code>nicotine</code> without also describing the
context that you’re talking about. <em>By itself</em>,
<code>nicotine</code> is important, but , <code>nicotine</code> is not
important: precisely, it now has nothing to add over and above
the predictive value that <code>tar</code> has. You might guess that
this is because <code>tar</code> and <code>nicotine</code> are ``saying
the same thing’’ in some fashion. We’ll explore that in a moment.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Make a “pairs plot”: that is, scatter plots between all
pairs of variables. This can be done by feeding the whole data frame
into <code>plot</code>.
Do you see any strong relationships that do
<em>not</em> include <code>co</code>? Does that shed any light on the last
part? Explain briefly (or “at length” if that’s how it comes
out).</li>
</ol>
<p>Solution</p>
<p>Plot the entire data frame:</p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb938-1" data-line-number="1"><span class="kw">plot</span>(cigs)  </a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-23-1.png" width="672"  /></p>
<p>We’re supposed to ignore <code>co</code>, but I comment that strong
relationships between <code>co</code> and <em>both</em> of <code>tar</code> and
<code>nicotine</code> show up here, along with <code>weight</code> being
at most weakly related to anything else.</p>
<p>That leaves the relationship of <code>tar</code> and <code>nicotine</code>
with each other. That also looks like a strong linear trend. When you
have correlations between explanatory variables, it is called
“multicollinearity”.</p>
<p>I mentioned a while back (in class) that having correlated <span class="math inline">\(x\)</span>’s was
trouble. Here is where we find out why. The problem is that when
<code>co</code> is large, <code>nicotine</code> is large, and a large value of
<code>tar</code> will come along with it. So we don’t know whether a large
value of <code>co</code> is caused by a large value of <code>tar</code> or a
large value of <code>nicotine</code>: there is no way to separate out
their effects because in effect they are “glued together”.</p>
<p>You might know of this effect (in an experimental design context) as
“confounding”: the effect of <code>tar</code> on <code>co</code> is
confounded with the effect of <code>nicotine</code> on <code>co</code>, and
you can’t tell which one deserves the credit for predicting <code>co</code>.</p>
<p>If you were able to design an experiment here, you could (in
principle) manufacture a bunch of cigarettes with high tar; some of
them would have high nicotine and some would have low. Likewise for
low tar. Then the
correlation between <code>nicotine</code> and <code>tar</code> would go away,
their effects on <code>co</code> would no longer be confounded, and you
could see unambiguously which one of the variables deserves credit for
predicting <code>co</code>. Or maybe it depends on both, genuinely, but at
least then you’d know.</p>
<p>We, however, have an observational study, so we have to make do with
the data we have. Confounding is one of the risks we take when we work
with observational data.</p>
<p>This was a “base graphics” plot. There is a way of doing a
<code>ggplot</code>-style “pairs plot”, as this is called, thus:</p>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb939-1" data-line-number="1"><span class="kw">library</span>(GGally)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;GGally&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     nasa</code></pre>
<div class="sourceCode" id="cb942"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb942-1" data-line-number="1">cigs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggpairs</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-24-1.png" width="672"  /></p>
<p>As ever, <code>install.packages</code> first, in the likely event that you
don’t have this package installed yet. Once you do, though, I think
this is a nicer way to get a pairs plot.</p>
<p>This plot is a bit more sophisticated: instead of just having the
scatterplots of the pairs of variables in the row and column, it uses
the diagonal to show a “kernel density” (a smoothed-out histogram),
and upper-right it shows the correlation between each pair of
variables. The three correlations between <code>co</code>, <code>tar</code>
and <code>nicotine</code> are clearly the highest.</p>
<p>If you want only some of the columns to appear in your pairs plot,
<code>select</code> them first, and then pass that data frame into
<code>ggpairs</code>. Here, we found that <code>weight</code> was not
correlated with anything much, so we can take it out and then make a
pairs plot of the other variables:</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" data-line-number="1">cigs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>weight) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggpairs</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-25-1.png" width="672"  /></p>
<p>The three correlations that remain are all very high, which is
entirely consistent with the strong linear relationships that you see
bottom left.</p>
</div>
<div id="maximal-oxygen-uptake-in-young-boys" class="section level2">
<h2><span class="header-section-number">13.3</span> Maximal oxygen uptake in young boys</h2>
<p>A physiologist wanted to understand the relationship between
physical characteristics of pre-adolescent boys and their maximal
oxygen uptake (millilitres of oxygen per kilogram of body weight). The
data are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/youngboys.txt">link</a> for a
random sample of 10 pre-adolescent boys. The variables are (with
units):</p>
<ul>
<li><p><code>uptake</code>: Oxygen uptake (millitres of oxygen per kilogram
of body weight)</p></li>
<li><p><code>age</code>: boy’s age (years)</p></li>
<li><p><code>height</code>: boy’s height (cm)</p></li>
<li><p><code>weight</code>: boy’s weight (kg)</p></li>
<li><p><code>chest</code>: chest depth (cm).</p></li>
</ul>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and confirm that you do indeed have
10 observations.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb944"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb944-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/youngboys.txt&quot;</span></a>
<a class="sourceLine" id="cb944-2" data-line-number="2">boys=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   uptake = col_double(),
##   age = col_double(),
##   height = col_double(),
##   weight = col_double(),
##   chest = col_double()
## )</code></pre>
<div class="sourceCode" id="cb946"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb946-1" data-line-number="1">boys</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    uptake   age height weight chest
##     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1   1.54   8.4   132    29.1  14.4
##  2   1.74   8.7   136.   29.7  14.5
##  3   1.32   8.9   128.   28.4  14  
##  4   1.5    9.9   131.   28.8  14.2
##  5   1.46   9     130    25.9  13.6
##  6   1.35   7.7   128.   27.6  13.9
##  7   1.53   7.3   130.   29    14  
##  8   1.71   9.9   138.   33.6  14.6
##  9   1.27   9.3   127.   27.7  13.9
## 10   1.5    8.1   132.   30.8  14.5</code></pre>
<p>10 boys (rows) indeed.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Fit a regression predicting oxygen uptake from all the
other variables, and display the results.</li>
</ol>
<p>Solution</p>
<p>Fitting four explanatory variables with only ten observations is likely to be pretty shaky, but we
press ahead regardless:</p>
<div class="sourceCode" id="cb948"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb948-1" data-line-number="1">boys<span class="fl">.1</span>=<span class="kw">lm</span>(uptake<span class="op">~</span>age<span class="op">+</span>height<span class="op">+</span>weight<span class="op">+</span>chest,<span class="dt">data=</span>boys) </a>
<a class="sourceLine" id="cb948-2" data-line-number="2"><span class="kw">summary</span>(boys<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = uptake ~ age + height + weight + chest, data = boys)
## 
## Residuals:
##         1         2         3         4         5         6         7 
## -0.020697  0.019741 -0.003649  0.038470 -0.023639 -0.026026  0.050459 
##         8         9        10 
## -0.014380  0.004294 -0.024573 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -4.774739   0.862818  -5.534 0.002643 ** 
## age         -0.035214   0.015386  -2.289 0.070769 .  
## height       0.051637   0.006215   8.308 0.000413 ***
## weight      -0.023417   0.013428  -1.744 0.141640    
## chest        0.034489   0.085239   0.405 0.702490    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.03721 on 5 degrees of freedom
## Multiple R-squared:  0.9675, Adjusted R-squared:  0.9415 
## F-statistic:  37.2 on 4 and 5 DF,  p-value: 0.0006513</code></pre>
<ol start="3" style="list-style-type: lower-alpha">
<li>(A one-mark question.) Would you say, on the evidence so
far, that the regression fits well or badly? Explain (very)
briefly.</li>
</ol>
<p>Solution</p>
<p>R-squared of 0.97 (97%) is very high, so I’d say this
regression fits very well. That’s all.
I said “on the evidence so far” to dissuade you from
overthinking this, or thinking that you needed to produce
some more evidence. That, plus the fact that this was only
one mark.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>It seems reasonable that an older boy should have a
greater oxygen uptake, all else being equal. Is this supported
by your output? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>If an older boy has greater oxygen uptake (the “all else equal” was a hint),
the slope of <code>age</code> should be
positive. It is not: it is <span class="math inline">\(-0.035\)</span>, so it is suggesting
(all else equal) that a greater age goes with a
<em>smaller</em> oxygen uptake.
The reason why this happens (which you didn’t need, but
you can include it if you like) is that <code>age</code> has a
non-small P-value of 0.07, so that the <code>age</code> slope
is not significantly different from zero. With all the
other variables, <code>age</code> has nothing to <em>add</em>
over and above them, and we could therefore remove it.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>It seems reasonable that a boy with larger weight
should have larger lungs and thus a  larger oxygen uptake. Is that what happens
here? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Look at the P-value for <code>weight</code>. This is 0.14,
not small, and so a boy with larger weight does not have
a significantly larger oxygen uptake, all else
equal. (The slope for <code>weight</code> is not
significantly different from zero either.)
I emphasized “statistically significant” to remind you
that this means to do a test and get a P-value.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Fit a model that contains only the significant
explanatory variables from your first regression. How do
the R-squared values from the two regressions compare?
(The last sentence asks for more or less the same thing as
the next part. Answer it either here or there. Either
place is good.)</li>
</ol>
<p>Solution</p>
<p>Only <code>height</code> is significant, so that’s the
only explanatory variable we need to keep. I would
just do the regression straight rather than using
<code>update</code> here:</p>
<div class="sourceCode" id="cb950"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb950-1" data-line-number="1">boys<span class="fl">.2</span>=<span class="kw">lm</span>(uptake<span class="op">~</span>height,<span class="dt">data=</span>boys) </a>
<a class="sourceLine" id="cb950-2" data-line-number="2"><span class="kw">summary</span>(boys<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = uptake ~ height, data = boys)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.069879 -0.033144  0.001407  0.009581  0.084012 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -3.843326   0.609198  -6.309 0.000231 ***
## height       0.040718   0.004648   8.761 2.26e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.05013 on 8 degrees of freedom
## Multiple R-squared:  0.9056, Adjusted R-squared:  0.8938 
## F-statistic: 76.75 on 1 and 8 DF,  p-value: 2.258e-05</code></pre>
<p>If you want, you can use <code>update</code> here, which looks like this:</p>
<div class="sourceCode" id="cb952"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb952-1" data-line-number="1">boys<span class="fl">.2</span>a=<span class="kw">update</span>(boys<span class="fl">.1</span>,.<span class="op">~</span>.<span class="op">-</span>age<span class="op">-</span>weight<span class="op">-</span>chest)  </a>
<a class="sourceLine" id="cb952-2" data-line-number="2"><span class="kw">summary</span>(boys<span class="fl">.2</span>a)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = uptake ~ height, data = boys)
## 
## Residuals:
##       Min        1Q    Median        3Q       Max 
## -0.069879 -0.033144  0.001407  0.009581  0.084012 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -3.843326   0.609198  -6.309 0.000231 ***
## height       0.040718   0.004648   8.761 2.26e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.05013 on 8 degrees of freedom
## Multiple R-squared:  0.9056, Adjusted R-squared:  0.8938 
## F-statistic: 76.75 on 1 and 8 DF,  p-value: 2.258e-05</code></pre>
<p>This doesn’t go quite so smoothly here because there are three
variables being removed, and it’s a bit of work to type them all.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>How has R-squared changed between your two
regressions? Describe what you see in a few words.</li>
</ol>
<p>Solution</p>
<p>R-squared has dropped by a bit, from 97% to 91%. (Make your own
call: pull out the two R-squared numbers, and say a word or two about
how they compare. I don’t much mind what you say:
“R-squared has decreased (noticeably)”, “R-squared has hardly changed”. But say
something.)</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Carry out a test comparing the fit of your
two regression models. What do you conclude, and
therefore what recommendation would you make about the
regression that would be preferred?</li>
</ol>
<p>Solution</p>
<p>The word “test” again implies something that produces a P-value with a
null hypothesis that you might reject. In this case, the test that
compares two models differing by more than one <span class="math inline">\(x\)</span> uses
<code>anova</code>, testing the null hypothesis that the two regressions
are equally good, against the alternative that the bigger (first) one
is better. Feed <code>anova</code> two fitted model objects, smaller first:</p>
<div class="sourceCode" id="cb954"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb954-1" data-line-number="1"><span class="kw">anova</span>(boys<span class="fl">.2</span>, boys<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: uptake ~ height
## Model 2: uptake ~ age + height + weight + chest
##   Res.Df       RSS Df Sum of Sq      F Pr(&gt;F)
## 1      8 0.0201016                           
## 2      5 0.0069226  3  0.013179 3.1729  0.123</code></pre>
<p>This P-value of 0.123 is not small, so we do not reject the null
hypothesis. There is not a significant difference in fit between the
two models. Therefore, we should go with the smaller model
<code>boys.2</code> because it is simpler.</p>
<p>That drop in R-squared from 97% to 91% was, it turns out, <em>not</em>
significant: the three extra variables
could have produced a change in R-squared like that,
<em>even if they were worthless</em>.
<label for="tufte-mn-37" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-37" class="margin-toggle"><span class="marginnote">Recall that adding <span class="math inline">\(x\)</span>’s to a regression will always make R-squared go up, even if they are just random noise.</span></p>
<p>If you have learned about “adjusted R-squared”, you might recall
that this is supposed to go down <em>only</em> if the variables you took
out should not have been taken out. But adjusted R-squared goes down
here as well, from 94% to 89% (not quite as much, therefore). What
happens is that adjusted R-squared is rather more relaxed about
keeping variables than the <code>anova</code> <span class="math inline">\(F\)</span>-test is; if we had used
an <span class="math inline">\(\alpha\)</span> of something like 0.10, the decision between the two
models would have been a lot closer, and this is reflected in the
adjusted R-squared values.</p>
<ol style="list-style-type: lower-roman">
<li>Obtain a table of correlations between all
the variables in the data frame. Do this by feeding
the whole data frame into <code>cor</code>.
We found that a regression predicting oxygen uptake
from just <code>height</code> was acceptably good. What
does your table of correlations say about why that
is? (Hint: look for all the correlations that are
<em>large</em>.)</li>
</ol>
<p>Solution</p>
<p>Correlations first:</p>
<div class="sourceCode" id="cb956"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb956-1" data-line-number="1"><span class="kw">cor</span>(boys)</a></code></pre></div>
<pre><code>##           uptake       age    height    weight     chest
## uptake 1.0000000 0.1361907 0.9516347 0.6576883 0.7182659
## age    0.1361907 1.0000000 0.3274830 0.2307403 0.1657523
## height 0.9516347 0.3274830 1.0000000 0.7898252 0.7909452
## weight 0.6576883 0.2307403 0.7898252 1.0000000 0.8809605
## chest  0.7182659 0.1657523 0.7909452 0.8809605 1.0000000</code></pre>
<p>The correlations with <code>age</code> are all on the low side, but all
the other correlations are high, not just between <code>uptake</code> and the
other variables, but between the explanatory variables as well.</p>
<p>Why is this helpful in understanding what’s going on? Well, imagine a
boy with large height (a tall one). The regression <code>boys.2</code>
says that this alone is enough to predict that such a boy’s oxygen
uptake is likely to be large, since the slope is positive. But the
correlations tell you more: a boy with large height is also (somewhat)
likely to be older (have large age), heavier (large weight) and to have
larger <code>chest</code> cavity. So oxygen uptake does depend on those other
variables as well, but once you know <code>height</code> you can make a
good guess at their values; you don’t need to know them.</p>
<p>Further remarks: <code>age</code> has a low correlation with
<code>uptake</code>, so its non-significance earlier appears to be
“real”: it really does have nothing extra to say, because the other
variables have a stronger link with <code>uptake</code> than
<code>age</code>. Height, however, seems to be the best way of relating
oxygen uptake to any of the other variables. I think the suppositions
from earlier about relating oxygen uptake to “bigness” in some sense
are actually sound, but age and weight and <code>chest</code> capture
“bigness” worse than height does. Later, when you learn about
Principal Components, you will see that the first principal component,
the one that best captures how the variables vary together, is often
“bigness” in some sense.</p>
<p>Another way to think about these things is via pairwise
scatterplots. The nicest way to produce these is via <code>ggpairs</code>
from package <code>ggally</code>:</p>
<div class="sourceCode" id="cb958"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb958-1" data-line-number="1">boys <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggpairs</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-32-1.png" width="672"  /></p>
<p>A final remark: with five variables, we really ought to have more than
ten observations (something like 50 would be better). But with more
observations and the same correlation structure, the same issues would
come up again, so the question would not be materially changed.</p>
</div>
<div id="mating-songs-in-crickets" class="section level2">
<h2><span class="header-section-number">13.4</span> Mating songs in crickets</h2>
<p>Male tree crickets produce “mating songs” by rubbing their
wings together to produce a chirping sound. It is hypothesized that
female tree crickets identify males of the correct species by how fast
(in chirps per second) the male’s mating song is. This is called the
“pulse rate”. Some data for two species of crickets are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/crickets.txt">link</a>. The
columns, which are unlabelled, are temperature and pulse rate
(respectively) for <em>Oecanthus exclamationis</em> (first two
columns) and <em>Oecanthus niveus</em> (third and fourth columns). The
columns are separated by tabs. There are some missing values in the
first two columns because fewer <em>exclamationis</em> crickets than
<em>niveus</em> crickets were measured.
The research question is whether males
of the different species have different average pulse rates. It is
also of interest to see whether temperature has an effect, and if
so, what.</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data, allowing for the fact that you have no
column names. You’ll see that the
columns have names <code>X1</code> through <code>X4</code>. This is
OK.</li>
</ol>
<p>Solution</p>
<p>Tab-separated, so <code>read_tsv</code>; no column names, so <code>col_names=F</code>:</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/crickets.txt&quot;</span></a>
<a class="sourceLine" id="cb959-2" data-line-number="2">crickets=<span class="kw">read_tsv</span>(my_url,<span class="dt">col_names=</span>F)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_double(),
##   X2 = col_double(),
##   X3 = col_double(),
##   X4 = col_double()
## )</code></pre>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb961-1" data-line-number="1">crickets  </a></code></pre></div>
<pre><code>## # A tibble: 17 x 4
##       X1    X2    X3    X4
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  20.8  67.9  17.2  44.3
##  2  20.8  65.1  18.3  47.2
##  3  24    77.3  18.3  47.6
##  4  24    78.7  18.3  49.6
##  5  24    79.4  18.9  50.3
##  6  24    80.4  18.9  51.8
##  7  26.2  85.8  20.4  60  
##  8  26.2  86.6  21    58.5
##  9  26.2  87.5  21    58.9
## 10  26.2  89.1  22.1  60.7
## 11  28.4  98.6  23.5  69.8
## 12  29   101.   24.2  70.9
## 13  30.4  99.3  25.9  76.2
## 14  30.4 102.   26.5  76.1
## 15  NA    NA    26.5  77  
## 16  NA    NA    26.5  77.7
## 17  NA    NA    28.6  84.7</code></pre>
<p>As promised.</p>
<p>If you didn’t catch the tab-separated part, this probably happened to you:</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb963-1" data-line-number="1">d=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>,<span class="dt">col_names=</span>F)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_character()
## )</code></pre>
<pre><code>## Warning in rbind(names(probs), probs_f): number of columns of result is not
## a multiple of vector length (arg 1)</code></pre>
<pre><code>## Warning: 3 parsing failures.
## row # A tibble: 3 x 5 col     row col   expected  actual   file                                      expected   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;                                     actual 1    15 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32… file 2    16 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32… row 3    17 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32…</code></pre>
<p>This doesn’t look good:</p>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb967-1" data-line-number="1"><span class="kw">problems</span>(d)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##     row col   expected  actual   file                                     
##   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;                                    
## 1    15 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32…
## 2    16 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32…
## 3    17 &lt;NA&gt;  1 columns 2 colum… &#39;http://www.utsc.utoronto.ca/~butler/c32…</code></pre>
<p>The “expected columns” being 1 should bother you, since we know
there are supposed to be 4 columns. At this point, we take a look at
what got read in:</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" data-line-number="1">d</a></code></pre></div>
<pre><code>## # A tibble: 17 x 1
##    X1                       
##    &lt;chr&gt;                    
##  1 &quot;20.8\t67.9\t17.2\t44.3&quot; 
##  2 &quot;20.8\t65.1\t18.3\t47.2&quot; 
##  3 &quot;24.0\t77.3\t18.3\t47.6&quot; 
##  4 &quot;24.0\t78.7\t18.3\t49.6&quot; 
##  5 &quot;24.0\t79.4\t18.9\t50.3&quot; 
##  6 &quot;24.0\t80.4\t18.9\t51.8&quot; 
##  7 &quot;26.2\t85.8\t20.4\t60.0&quot; 
##  8 &quot;26.2\t86.6\t21.0\t58.5&quot; 
##  9 &quot;26.2\t87.5\t21.0\t58.9&quot; 
## 10 &quot;26.2\t89.1\t22.1\t60.7&quot; 
## 11 &quot;28.4\t98.6\t23.5\t69.8&quot; 
## 12 &quot;29.0\t100.8\t24.2\t70.9&quot;
## 13 &quot;30.4\t99.3\t25.9\t76.2&quot; 
## 14 &quot;30.4\t101.7\t26.5\t76.1&quot;
## 15 &quot;NA\tNA&quot;                 
## 16 &quot;NA\tNA&quot;                 
## 17 &quot;NA\tNA&quot;</code></pre>
<p>and there you see the <code>t</code> or “tab” characters separating the
values, instead of spaces. (This is what I tried first, and once I
looked at this, I realized that <code>read_tsv</code> was what I needed.)</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>These data are rather far from being tidy. There need to be
three variables, temperature, pulse rate and species, and there
are <span class="math inline">\(14+17=31\)</span> observations altogether. This one is tricky in that
there are temperature and pulse rate for each of two levels of a
factor, so I’ll suggest combining the temperature and chirp rate
together into one thing for each species, then gathering them,
then splitting them again. Create new columns, named for each species,
that contain the temperature and pulse rate for that species in
that order, <code>unite</code>d together.
For the rest of this question, start from the data frame you read
in, and build a pipe, one or two steps at a time, to save creating
a lot of temporary data frames.</li>
</ol>
<p>Solution</p>
<p>Breathe, and then begin. <code>unite</code> creates new columns by
joining together old ones:
<label for="tufte-mn-38" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-38" class="margin-toggle"><span class="marginnote">As <em>str_c</em> or <em>paste</em> do, actually, but the advantage of <em>unite</em> is that it gets rid of the other columns, which you probably no longer need.</span></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" data-line-number="1">crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb971-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb971-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) </a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    exclamationis niveus   
##    &lt;chr&gt;         &lt;chr&gt;    
##  1 20.8_67.9     17.2_44.3
##  2 20.8_65.1     18.3_47.2
##  3 24_77.3       18.3_47.6
##  4 24_78.7       18.3_49.6
##  5 24_79.4       18.9_50.3
##  6 24_80.4       18.9_51.8
##  7 26.2_85.8     20.4_60  
##  8 26.2_86.6     21_58.5  
##  9 26.2_87.5     21_58.9  
## 10 26.2_89.1     22.1_60.7
## 11 28.4_98.6     23.5_69.8
## 12 29_100.8      24.2_70.9
## 13 30.4_99.3     25.9_76.2
## 14 30.4_101.7    26.5_76.1
## 15 NA_NA         26.5_77  
## 16 NA_NA         26.5_77.7
## 17 NA_NA         28.6_84.7</code></pre>
<p>Note that the original columns <code>X1:X4</code> are <em>gone</em>, which
is fine, because the information we needed from them is contained in
the two new columns. <code>unite</code> by default uses an underscore to
separate the joined-together values, which is generally safe since you
won’t often find those in data.</p>
<p>Digression: <code>unite</code>-ing with a space could cause problems if
the data values have spaces in them already. Consider this list of names:</p>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb973-1" data-line-number="1">names=<span class="kw">c</span>(<span class="st">&quot;Cameron McDonald&quot;</span>,<span class="st">&quot;Durwin Yang&quot;</span>,<span class="st">&quot;Ole Gunnar Solskjaer&quot;</span>,<span class="st">&quot;Mahmudullah&quot;</span>)</a></code></pre></div>
<p>Two very former students of mine, a Norwegian soccer player, and a
Bangladeshi cricketer. Only one of these has played for Manchester United:</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb974-1" data-line-number="1">manu=<span class="kw">c</span>(F,F,T,F)</a></code></pre></div>
<p>and let’s make a data frame:</p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" data-line-number="1">d=<span class="kw">tibble</span>(<span class="dt">name=</span>names,<span class="dt">manu=</span>manu)</a>
<a class="sourceLine" id="cb975-2" data-line-number="2">d</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   name                 manu 
##   &lt;chr&gt;                &lt;lgl&gt;
## 1 Cameron McDonald     FALSE
## 2 Durwin Yang          FALSE
## 3 Ole Gunnar Solskjaer TRUE 
## 4 Mahmudullah          FALSE</code></pre>
<p>Now, what happens if we <code>unite</code> those columns, separating them
by a space?</p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(joined,name<span class="op">:</span>manu,<span class="dt">sep=</span><span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 1
##   joined                   
##   &lt;chr&gt;                    
## 1 Cameron McDonald FALSE   
## 2 Durwin Yang FALSE        
## 3 Ole Gunnar Solskjaer TRUE
## 4 Mahmudullah FALSE</code></pre>
<p>If we then try to separate them again, what happens?</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb979-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(joined,name<span class="op">:</span>manu,<span class="dt">sep=</span><span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb979-2" data-line-number="2"><span class="kw">separate</span>(joined,<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>,<span class="st">&quot;two&quot;</span>),<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 3 rows [1, 2,
## 3].</code></pre>
<pre><code>## # A tibble: 4 x 2
##   one         two     
##   &lt;chr&gt;       &lt;chr&gt;   
## 1 Cameron     McDonald
## 2 Durwin      Yang    
## 3 Ole         Gunnar  
## 4 Mahmudullah FALSE</code></pre>
<p>Things have gotten lost: most of the original values of <code>manu</code>
and some of the names. If we use a different separator character,
either choosing one deliberately or going with the default underscore,
everything works swimmingly:</p>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb982-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unite</span>(joined,name<span class="op">:</span>manu,<span class="dt">sep=</span><span class="st">&quot;:&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb982-2" data-line-number="2"><span class="kw">separate</span>(joined,<span class="kw">c</span>(<span class="st">&quot;one&quot;</span>,<span class="st">&quot;two&quot;</span>),<span class="st">&quot;:&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   one                  two  
##   &lt;chr&gt;                &lt;chr&gt;
## 1 Cameron McDonald     FALSE
## 2 Durwin Yang          FALSE
## 3 Ole Gunnar Solskjaer TRUE 
## 4 Mahmudullah          FALSE</code></pre>
<p>and we are back to where we started.</p>
<p>If you run just the <code>unite</code> line (move the pipe symbol to the
next line so that the <code>unite</code> line is complete as it stands),
you’ll see what happened.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>The two columns <code>exclamationis</code> and <code>niveus</code>
that you just created are both temperature-pulse rate combos, but
for different species. <code>gather</code> them together into one
column, labelled by species. (This is a straight <code>tidyr</code>
<code>gather</code>, even though they contain something odd-looking.)</li>
</ol>
<p>Solution</p>
<p>Thus, this, naming the new column <code>temp_pulse</code> since it
contains both of those things. Add to the end of the pipe you
started building in the previous part:</p>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb984-1" data-line-number="1">crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb984-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb984-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb984-4" data-line-number="4"><span class="kw">gather</span>(species,temp_pulse,exclamationis<span class="op">:</span>niveus)  </a></code></pre></div>
<pre><code>## # A tibble: 34 x 2
##    species       temp_pulse
##    &lt;chr&gt;         &lt;chr&gt;     
##  1 exclamationis 20.8_67.9 
##  2 exclamationis 20.8_65.1 
##  3 exclamationis 24_77.3   
##  4 exclamationis 24_78.7   
##  5 exclamationis 24_79.4   
##  6 exclamationis 24_80.4   
##  7 exclamationis 26.2_85.8 
##  8 exclamationis 26.2_86.6 
##  9 exclamationis 26.2_87.5 
## 10 exclamationis 26.2_89.1 
## # ... with 24 more rows</code></pre>
<p>Yep. If you scroll down with Next, you’ll see the other species of
crickets, and you’ll see some missing values at the bottom, labelled,
at the moment, <code>NA_NA</code>.</p>
<p>This is going to get rather long, but don’t fret: we debugged the two
<code>unite</code> lines before, so if you get any errors, they must
have come from the <code>gather</code>. So that would be the place to check.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Now split up the temperature-pulse combos at the underscore, into
two separate columns. This is <code>separate</code>. When specifying
what to separate by, you can use a number (“split after this many characters”) or a piece of text, in quotes (“when you see this text, split at it”).</li>
</ol>
<p>Solution</p>
<p>The text to split by is an underscore (in quotes), since
<code>unite</code> by default puts an underscore in between the
values it pastes together. Glue the <code>separate</code> onto the
end. We are creating two new variables <code>temperature</code> and
<code>pulse_rate</code>:</p>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb986-1" data-line-number="1">crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb986-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb986-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb986-4" data-line-number="4"><span class="kw">gather</span>(species,temp_pulse,exclamationis<span class="op">:</span>niveus) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb986-5" data-line-number="5"><span class="kw">separate</span>(temp_pulse,<span class="kw">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;pulse_rate&quot;</span>),<span class="st">&quot;_&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 34 x 3
##    species       temperature pulse_rate
##    &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;     
##  1 exclamationis 20.8        67.9      
##  2 exclamationis 20.8        65.1      
##  3 exclamationis 24          77.3      
##  4 exclamationis 24          78.7      
##  5 exclamationis 24          79.4      
##  6 exclamationis 24          80.4      
##  7 exclamationis 26.2        85.8      
##  8 exclamationis 26.2        86.6      
##  9 exclamationis 26.2        87.5      
## 10 exclamationis 26.2        89.1      
## # ... with 24 more rows</code></pre>
<p>You’ll note that <code>unite</code> and <code>separate</code> are opposites (“inverses”) of each other, but we haven’t just done something and then undone it, because we have a <code>gather</code> in between; in fact, arranging it this way has done precisely the tidying we wanted.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Almost there. Temperature and pulse rate are still text
(because <code>unite</code> turned them into text), but they should be
numbers. Create new variables that are numerical versions of
temperature and pulse rate (using <code>as.numeric</code>). Check that
you have no extraneous variables (and, if necessary, get rid of
the ones you don’t want). (Species is also text and really ought
to be a factor, but having it as text doesn’t seem to cause any
problems.)
You can, if you like, use <code>parse_number</code> instead of
<code>as.numeric</code>. They should both work. The distinction I
prefer to make is that <code>parse_number</code> is good for text
with a number in it (that we want to pull the number out of),
while <code>as.numeric</code> is for turning something that looks like
a number but isn’t one into a genuine number.</li>
</ol>
<p>Solution</p>
<p><code>mutate</code>-ing into a column that already exists overwrites
the variable that’s already there (which saves us some effort
here).</p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb988-1" data-line-number="1">crickets<span class="fl">.1</span> =<span class="st"> </span>crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb988-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-4" data-line-number="4"><span class="kw">gather</span>(species,temp_pulse,exclamationis<span class="op">:</span>niveus) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-5" data-line-number="5"><span class="kw">separate</span>(temp_pulse,<span class="kw">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;pulse_rate&quot;</span>),<span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-6" data-line-number="6"><span class="kw">mutate</span>(<span class="dt">temperature=</span><span class="kw">as.numeric</span>(temperature)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb988-7" data-line-number="7"><span class="kw">mutate</span>(<span class="dt">pulse_rate=</span><span class="kw">as.numeric</span>(pulse_rate))</a></code></pre></div>
<pre><code>## Warning in evalq(as.numeric(temperature), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<pre><code>## Warning in evalq(as.numeric(pulse_rate), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb991-1" data-line-number="1">crickets<span class="fl">.1</span>  </a></code></pre></div>
<pre><code>## # A tibble: 34 x 3
##    species       temperature pulse_rate
##    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
##  1 exclamationis        20.8       67.9
##  2 exclamationis        20.8       65.1
##  3 exclamationis        24         77.3
##  4 exclamationis        24         78.7
##  5 exclamationis        24         79.4
##  6 exclamationis        24         80.4
##  7 exclamationis        26.2       85.8
##  8 exclamationis        26.2       86.6
##  9 exclamationis        26.2       87.5
## 10 exclamationis        26.2       89.1
## # ... with 24 more rows</code></pre>
<p>I saved the data frame this time, since this is the one we will use
for our analysis.</p>
<p>The warning message tells us that we got genuine missing-value NAs
back, which is probably what we want. Specifically, they got turned
from missing <em>text</em> to missing <em>numbers</em>!
<label for="tufte-mn-39" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-39" class="margin-toggle"><span class="marginnote">You might think that missing is just missing, but R distinguishes between types of missing.</span>
The R word
“coercion” means values being changed from one type of thing to
another type of thing. (We’ll ignore the missings and see if they
cause us any trouble. The same warning messages will show up on graphs
later.) So I have 34 rows (including three rows of missings) instead
of the 31 rows I would have liked. Otherwise, success.</p>
<p>There is (inevitably) another way to do this. We are doing the
<code>as.numeric</code> twice, exactly the same on two different columns,
and when you are doing the same thing on a number of columns, here a
<code>mutate</code> with the same function, you have the option of using
<code>mutate_if</code> or <code>mutate_at</code>. These are like
<code>summarize_if</code> and <code>summarize_at</code> that we used way
back to compute numerical summaries of a bunch of columns: the
<code>if</code> variant works on columns that share a property, like being
numeric, and the <code>at</code> variant works on columns whose names have
something in common or that we can list, which is what we want here:</p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb993-1" data-line-number="1">crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb993-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb993-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb993-4" data-line-number="4"><span class="kw">gather</span>(species,temp_pulse,exclamationis<span class="op">:</span>niveus) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb993-5" data-line-number="5"><span class="kw">separate</span>(temp_pulse,<span class="kw">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;pulse_rate&quot;</span>),<span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb993-6" data-line-number="6"><span class="kw">mutate_at</span>(<span class="kw">vars</span>(temperature<span class="op">:</span>pulse_rate),<span class="kw">funs</span>(as.numeric))</a></code></pre></div>
<pre><code>## Warning in evalq(as.numeric(temperature), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<pre><code>## Warning in evalq(as.numeric(pulse_rate), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<pre><code>## # A tibble: 34 x 3
##    species       temperature pulse_rate
##    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
##  1 exclamationis        20.8       67.9
##  2 exclamationis        20.8       65.1
##  3 exclamationis        24         77.3
##  4 exclamationis        24         78.7
##  5 exclamationis        24         79.4
##  6 exclamationis        24         80.4
##  7 exclamationis        26.2       85.8
##  8 exclamationis        26.2       86.6
##  9 exclamationis        26.2       87.5
## 10 exclamationis        26.2       89.1
## # ... with 24 more rows</code></pre>
<p>Can’t I just say that these are columns 2 and 3?</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb997-1" data-line-number="1">crickets <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb997-2" data-line-number="2"><span class="kw">unite</span>(exclamationis,X1<span class="op">:</span>X2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb997-3" data-line-number="3"><span class="kw">unite</span>(niveus,X3<span class="op">:</span>X4) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb997-4" data-line-number="4"><span class="kw">gather</span>(species,temp_pulse,exclamationis<span class="op">:</span>niveus) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb997-5" data-line-number="5"><span class="kw">separate</span>(temp_pulse,<span class="kw">c</span>(<span class="st">&quot;temperature&quot;</span>,<span class="st">&quot;pulse_rate&quot;</span>),<span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb997-6" data-line-number="6"><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>),<span class="kw">funs</span>(as.numeric))</a></code></pre></div>
<pre><code>## Warning in evalq(as.numeric(temperature), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<pre><code>## Warning in evalq(as.numeric(pulse_rate), &lt;environment&gt;): NAs introduced by
## coercion</code></pre>
<pre><code>## # A tibble: 34 x 3
##    species       temperature pulse_rate
##    &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;
##  1 exclamationis        20.8       67.9
##  2 exclamationis        20.8       65.1
##  3 exclamationis        24         77.3
##  4 exclamationis        24         78.7
##  5 exclamationis        24         79.4
##  6 exclamationis        24         80.4
##  7 exclamationis        26.2       85.8
##  8 exclamationis        26.2       86.6
##  9 exclamationis        26.2       87.5
## 10 exclamationis        26.2       89.1
## # ... with 24 more rows</code></pre>
<p>Yes. Equally good. What goes into the <code>vars</code>
is the same as can go into a <code>select</code>: column numbers, names,
or any of those “select helpers” like <code>starts_with</code>.</p>
<p>You might think of <code>mutate_if</code> here, but if you scroll back, you’ll find that all the columns are text, before you convert temperature and pulse rate to numbers, and so there’s no way to pick out just the two columns you want that way.</p>
<p>Check that the temperature and pulse rate columns are now labelled
<code>dbl</code>, which means they actually <em>are</em> decimal numbers
(and don’t just look like decimal numbers).</p>
<p>Either way, using <code>unite</code> and then <code>separate</code> means that
all the columns we created we want to keep (or, all the ones we would
have wanted to get rid of have already been gotten rid of).</p>
<p>Now we can actually do some statistics.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Do a two-sample <span class="math inline">\(t\)</span>-test to see whether the mean pulse rates
differ between species. What do you conclude?</li>
</ol>
<p>Solution</p>
<p>Drag your mind way back to this:</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1001-1" data-line-number="1"><span class="kw">t.test</span>(pulse_rate<span class="op">~</span>species,<span class="dt">data=</span>crickets<span class="fl">.1</span>)  </a></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  pulse_rate by species
## t = 5.2236, df = 28.719, p-value = 1.401e-05
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  14.08583 32.22677
## sample estimates:
## mean in group exclamationis        mean in group niveus 
##                    85.58571                    62.42941</code></pre>
<p>There is strong evidence of a difference in means (a P-value around
0.00001), and the confidence interval says that the mean chirp rate is
higher for <em>exclamationis</em>. That is, not just for the crickets
that were observed here, but for <em>all</em> crickets of these two
species.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>The analysis in the last part did not use temperature,
however. Is it possible that temperature also has an effect? To
assess this, draw a scatterplot of pulse rate against temperature,
with the points distinguished, somehow, by the species they are
from.</li>
</ol>
<p>Solution</p>
<p>One of the wonderful things about <code>ggplot</code> is that doing
the obvious thing works:</p>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1003-1" data-line-number="1"><span class="kw">ggplot</span>(crickets<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>temperature,<span class="dt">y=</span>pulse_rate,<span class="dt">colour=</span>species))<span class="op">+</span></a>
<a class="sourceLine" id="cb1003-2" data-line-number="2"><span class="kw">geom_point</span>()</a></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-50-1.png" width="672"  /></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>What does the plot tell you that the <span class="math inline">\(t\)</span>-test doesn’t? How
would you describe differences in pulse rates between species now?</li>
</ol>
<p>Solution</p>
<p>The plot tells you that (for both species) as temperature goes
up, pulse rate goes up as well. <em>Allowing for that</em>, the
difference in pulse rates between the two species is even
clearer than it was before. To see an example, pick a
temperature, and note that the mean pulse rate at that
temperature seems to be at least 10 higher for
<em>exclamationis</em>, with a high degree of consistency.
The <span class="math inline">\(t\)</span>-test mixed up all the pulse rates at all the different
temperatures. Even though the conclusion was clear enough, it
could be clearer if we incorporated temperature into the analysis.
There was also a potential source of unfairness in that the
<em>exclamationis</em> crickets tended to be observed at higher
temperatures than <em>niveus</em> crickets; since pulse rates
increase with temperature, the apparent difference in pulse
rates between the species might have been explainable by one
species being observed mainly in higher temperatures. This was
<em>utterly invisible</em> to us when we did the <span class="math inline">\(t\)</span>-test, but it
shows the importance of accounting for all the relevant
variables when you do your analysis. If the species had been
observed at opposite temperatures, we might have
concluded
<label for="tufte-mn-40" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-40" class="margin-toggle"><span class="marginnote">Mistakenly.</span>
that <em>niveus</em> have the
higher pulse rates on average. I come back to this later when I
discuss the confidence interval for species difference that
comes out of the regression model with temperature.</p>
<ol style="list-style-type: lower-roman">
<li>Fit a regression predicting pulse rate from species and
temperature. Compare the P-value for species in this regression to
the one from the <span class="math inline">\(t\)</span>-test. What does that tell you?</li>
</ol>
<p>Solution</p>
<p>This is actually a so-called “analysis of covariance model”,
which properly belongs in D29, but it’s really just a regression:</p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" data-line-number="1">pulse<span class="fl">.1</span>=<span class="kw">lm</span>(pulse_rate<span class="op">~</span>species<span class="op">+</span>temperature,<span class="dt">data=</span>crickets<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb1005-2" data-line-number="2"><span class="kw">summary</span>(pulse<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pulse_rate ~ species + temperature, data = crickets.1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.0128 -1.1296 -0.3912  0.9650  3.7800 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    -7.21091    2.55094  -2.827  0.00858 ** 
## speciesniveus -10.06529    0.73526 -13.689 6.27e-14 ***
## temperature     3.60275    0.09729  37.032  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.786 on 28 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.9896, Adjusted R-squared:  0.9888 
## F-statistic:  1331 on 2 and 28 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The P-value for species is now <span class="math inline">\(6.27\times 10^{-14}\)</span> or 0.00000000000006, which is even less than
the P-value of 0.00001 that came out of the <span class="math inline">\(t\)</span>-test. That is to say,
when you know temperature, you can be even more sure of your
conclusion that there is a difference between the species.</p>
<p>The R-squared for this regression is almost 99%, which says that if
you know both temperature and species, you can predict the pulse rate
almost exactly.</p>
<p>In the regression output, the slope for species is about <span class="math inline">\(-10\)</span>. It is
labelled <code>speciesniveus</code>. Since species is categorical,
<code>lm</code> uses the first category, <em>exclamationis</em>, as the
baseline and expresses each other species relative to that. Since the
slope is about <span class="math inline">\(-10\)</span>, it says that at any given temperature, the mean
pulse rate for <em>niveus</em> is about 10 less than for
<em>exclamationis</em>. This is pretty much what the scatterplot told
us.</p>
<p>We can go a little further here:</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" data-line-number="1"><span class="kw">confint</span>(pulse<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##                    2.5 %    97.5 %
## (Intercept)   -12.436265 -1.985547
## speciesniveus -11.571408 -8.559175
## temperature     3.403467  3.802038</code></pre>
<p>The second line says that the pulse rate for <em>niveus</em> is
between about 8.5 and 11.5 less than for <em>exclamationis</em>, at
any given temperature (comparing the two species at the same
temperature as each other, but that temperature could be
anything). This is a lot shorter than the CI that came out of the
<span class="math inline">\(t\)</span>-test, that went from 14 to 32. This is because we are now
accounting for temperature, which also makes a difference. (In the
<span class="math inline">\(t\)</span>-test, the temperatures were all mixed up). What we also see is
that the <span class="math inline">\(t\)</span>-interval is shifted up compared to the one from the
regression. This is because the <span class="math inline">\(t\)</span>-interval conflates two things: the <em>exclamationis</em> crickets do have a
higher pulse rate, but they were also observed at higher temperatures,
which makes it look as if their pulse rates are more
higher
<label for="tufte-mn-41" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-41" class="margin-toggle"><span class="marginnote">This is actually grammatically correct.</span> than they
really are, when you account for temperature.</p>
<p>This particular model constrains the slope with temperature to be the
same for both species (just the intercepts differ). If you want to
allow the slopes to differ between species, you add an interaction
between temperature and species:</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" data-line-number="1">pulse<span class="fl">.2</span>=<span class="kw">lm</span>(pulse_rate<span class="op">~</span>species<span class="op">*</span>temperature,<span class="dt">data=</span>crickets<span class="fl">.1</span>)</a>
<a class="sourceLine" id="cb1009-2" data-line-number="2"><span class="kw">summary</span>(pulse<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = pulse_rate ~ species * temperature, data = crickets.1)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.7031 -1.3417 -0.1235  0.8100  3.6330 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)               -11.0408     4.1515  -2.659    0.013 *  
## speciesniveus              -4.3484     4.9617  -0.876    0.389    
## temperature                 3.7514     0.1601  23.429   &lt;2e-16 ***
## speciesniveus:temperature  -0.2340     0.2009  -1.165    0.254    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 1.775 on 27 degrees of freedom
##   (3 observations deleted due to missingness)
## Multiple R-squared:  0.9901, Adjusted R-squared:  0.989 
## F-statistic: 898.9 on 3 and 27 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>To see whether adding the interaction term added anything to the
prediction, compare the model with and without using <code>anova</code>:</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" data-line-number="1"><span class="kw">anova</span>(pulse<span class="fl">.1</span>,pulse<span class="fl">.2</span>)  </a></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: pulse_rate ~ species + temperature
## Model 2: pulse_rate ~ species * temperature
##   Res.Df    RSS Df Sum of Sq     F Pr(&gt;F)
## 1     28 89.350                          
## 2     27 85.074  1    4.2758 1.357 0.2542</code></pre>
<p>There’s no significant improvement by adding the interaction, so
there’s no evidence that having different slopes for each species is
necessary. Note that <code>anova</code> gave the same P-value as did the
<span class="math inline">\(t\)</span>-test for the slope coefficient for the interaction in
<code>summary</code>, 0.254 in both cases. This is because there were only
two species and therefore only one slope coefficient was required to
distinguish them. If there had been three species, we would have had
to look at the <code>anova</code> output to hunt for a difference among
species, since there would have been two slope coefficients, each with
its own P-value.</p>
<p>The upshot is that we do not need different slopes; the model
<code>pulse.1</code> with the same slope for each species describes what
is going on.</p>
<p><code>ggplot</code> makes it almost laughably easy to add regression lines
for each species to our plot, thus:</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" data-line-number="1"><span class="kw">ggplot</span>(crickets<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>temperature,<span class="dt">y=</span>pulse_rate,<span class="dt">colour=</span>species))<span class="op">+</span></a>
<a class="sourceLine" id="cb1013-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>,<span class="dt">se=</span>F)</a></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-55-1.png" width="672"  /></p>
<p>The lines are almost exactly parallel, so having the same slope for
each species makes perfect sense.</p>
</div>
<div id="facebook-friends-and-grey-matter" class="section level2">
<h2><span class="header-section-number">13.5</span> Facebook friends and grey matter</h2>
<p>Is there a relationship between the number
of Facebook friends a person has, and the density of grey matter in
the areas of the brain associated with social perception and
associative memory? To find out, a 2012 study measured both of these
variables for a sample of 40 students at City University in London
(England). The data are at
<a href="http://www.utsc.utoronto.ca/~butler/c32/facebook.txt">link</a>. The grey
matter density is on a <span class="math inline">\(z\)</span>-score standardized scale. The values are
separated by <em>tabs</em>.</p>
<p>The aim of this question is to produce an R Markdown report that
contains your answers to the questions below.</p>
<p>You should aim to make your report flow smoothly, so that it would be
pleasant for a grader to read, and can stand on its own as an analysis
(rather than just being the answer to a question that I set you).
Some suggestions: give your report a title and arrange it into
sections with an Introduction; add a small amount of additional text
here and there explaining what you are doing and why. I don’t expect
you to spend a large amount of time on this, but I <em>do</em> hope
you will make some effort. (My report came out to 4 Word pages.)</p>
<ol style="list-style-type: lower-alpha">
<li>Read in the data and make a scatterplot for predicting the
number of Facebook friends from the grey matter density. On your
scatterplot, add a smooth trend.</li>
</ol>
<p>Solution</p>
<p>Begin your document with a code chunk containing
<code>library(tidyverse)</code>. The data values are
separated by tabs, which you will need to take into account:</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1016-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/facebook.txt&quot;</span></a>
<a class="sourceLine" id="cb1016-2" data-line-number="2">fb=<span class="kw">read_tsv</span>(my_url)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   GMdensity = col_double(),
##   FBfriends = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1018-1" data-line-number="1">fb</a></code></pre></div>
<pre><code>## # A tibble: 40 x 2
##    GMdensity FBfriends
##        &lt;dbl&gt;     &lt;int&gt;
##  1      -1.8        23
##  2       0.1        35
##  3      -1.2        80
##  4      -0.4       110
##  5      -0.9       120
##  6      -2.1       140
##  7      -1.5       168
##  8       0.5       132
##  9       0.6       154
## 10      -0.5       241
## # ... with 30 more rows</code></pre>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1020-1" data-line-number="1"><span class="kw">ggplot</span>(fb,<span class="kw">aes</span>(<span class="dt">x=</span>GMdensity,<span class="dt">y=</span>FBfriends))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-56-1.png" width="672"  /></p>
<p>(b)??part:scatterconc?? Describe what you see on your scatterplot: is there a
trend, and if so, what kind of trend is it? (Don’t get too taken in
by the exact shape of your smooth trend.) Think “form, direction, strength”.</p>
<p>Solution</p>
<p>I’d say there seems to be a weak, upward, apparently linear
trend. The points are not especially close to the trend, so I
don’t think there’s any justification for calling this other
than “weak”. (If you think the trend is, let’s say,
“moderate”, you ought to say what makes you think that: for
example, that the people with a lot of Facebook friends also
tend to have a higher grey matter density. I can live with a
reasonably-justified “moderate”.)
The reason I said not to get taken in by the shape of the smooth
trend is that this has a “wiggle” in it: it goes down again
briefly in the middle. But this is likely a quirk of the data,
and the trend, if there is any, seems to be an upward one.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Fit a regression predicting the number of Facebook friends
from the grey matter density, and display the output.</li>
</ol>
<p>Solution</p>
<p>That looks like this. You can call the “fitted model object”
whatever you like, but you’ll need to get the capitalization of
the variable names correct:</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1022-1" data-line-number="1">fb<span class="fl">.1</span>=<span class="kw">lm</span>(FBfriends<span class="op">~</span>GMdensity,<span class="dt">data=</span>fb)</a>
<a class="sourceLine" id="cb1022-2" data-line-number="2"><span class="kw">summary</span>(fb<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = FBfriends ~ GMdensity, data = fb)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -339.89 -110.01   -5.12   99.80  303.64 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   366.64      26.35  13.916  &lt; 2e-16 ***
## GMdensity      82.45      27.58   2.989  0.00488 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 165.7 on 38 degrees of freedom
## Multiple R-squared:  0.1904, Adjusted R-squared:  0.1691 
## F-statistic: 8.936 on 1 and 38 DF,  p-value: 0.004882</code></pre>
<p>I observe, though I didn’t ask you to, that the R-squared is pretty
awful, going with a correlation of</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1024-1" data-line-number="1"><span class="kw">sqrt</span>(<span class="fl">0.1904</span>)</a></code></pre></div>
<pre><code>## [1] 0.4363485</code></pre>
<p>which <em>would</em> look
like as weak of a trend as we saw.
<label for="tufte-mn-42" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-42" class="margin-toggle"><span class="marginnote">Correlations have to go up beyond 0.50 before they start looking at all interesting.</span></p>
<p>(d)??part:regtest?? Is the slope of your regression line significantly
different from zero? What does that mean, in the context of the
data?</p>
<p>Solution</p>
<p>The P-value of the slope is 0.005, which is less than
0.05. Therefore the slope <em>is</em> significantly different from
zero. That means that the number of Facebook friends really does
depend on the grey matter density, for the whole population of
interest and not just the 40 students observed here (that were a
sample from that population). I don’t mind so much what you
think the population is, but it needs to be clear that the
relationship applies to a population.
Another way to approach this is to say that you would expect
this relationship to show up again in another similar
experiment. That also works, because it gets at the idea of
reproducibility.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Are you surprised by the results of
parts (??part:scatterconc??) and (??part:regtest??)? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>I <em>am</em> surprised, because I thought the trend on the
scatterplot was so weak that there would not be a significant
slope. I guess there was enough of an upward trend to be
significant, and with <span class="math inline">\(n=40\)</span> observations we were able to get a
significant slope out of that scatterplot. With this many
observations, even a weak correlation can be significantly
nonzero.
You can be surprised or not, but you need to have some kind of
consideration of the strength of the trend on the scatterplot as
against the significance of the slope. For example, if you
decided that the trend was “moderate” in strength, you would
be justified in being less surprised than I was.
Here, there is the usual issue that we have proved that the
slope is not zero (that the relationship is not flat), but we
may not have a very clear idea of what the slope actually
<em>is</em>. There are a couple of ways to get a confidence
interval. The obvious one is to use R as a calculator and go up
and down twice its standard error (to get a rough idea):</p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1026-1" data-line-number="1"><span class="fl">82.45</span><span class="op">+</span><span class="dv">2</span><span class="op">*</span><span class="fl">27.58</span><span class="op">*</span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1]  27.29 137.61</code></pre>
<p>The <code>c()</code> thing is to get both confidence limits at once. The
smoother way is this:</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1028-1" data-line-number="1"><span class="kw">confint</span>(fb<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>##                 2.5 %   97.5 %
## (Intercept) 313.30872 419.9810
## GMdensity    26.61391 138.2836</code></pre>
<p>Feed <code>confint</code> a “fitted model object” and it’ll give you
confidence intervals (by default 95%) for all the parameters in it.</p>
<p>The confidence interval for the slope goes from about 27 to about
138. That is to say, a one-unit increase in grey matter density goes
with an increase in Facebook friends of this much. This is not
especially insightful: it’s bigger than zero (the test was
significant), but other than that, it could be almost
anything. <em>This</em> is where the weakness of the trend comes back to
bite us. With this much scatter in our data, we need a <em>much</em>
larger sample size to estimate accurately how big an effect grey
matter density has.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Obtain a scatterplot with the regression line on it.</li>
</ol>
<p>Solution</p>
<p>Just a modification
of (a):</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1030-1" data-line-number="1"><span class="kw">ggplot</span>(fb,<span class="kw">aes</span>(<span class="dt">x=</span>GMdensity,<span class="dt">y=</span>FBfriends))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1030-2" data-line-number="2"><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-61-1.png" width="672"  /></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Obtain a plot of the residuals from the regression against
the fitted values, and comment briefly on it.</li>
</ol>
<p>Solution</p>
<p>This is, to my mind, the easiest way:</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1031-1" data-line-number="1"><span class="kw">ggplot</span>(fb<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-62-1.png" width="672"  /></p>
<p>There is some “magic” here, since the fitted model object is not
actually a data frame, but it works this way.
That looks to me like a completely random scatter of
points. Thus, I am completely happy with the straight-line regression
that we fitted, and I see no need to improve it.</p>
<p>(You should make two points here: one, describe what you see, and two,
what it implies about whether or not your regression is satisfactory.)</p>
<p>Compare that residual plot with this one:</p>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1032-1" data-line-number="1"><span class="kw">ggplot</span>(fb<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span></a>
<a class="sourceLine" id="cb1032-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-63-1.png" width="672"  /></p>
<p>Now, why did I try adding a smooth trend, and why is it not
necessarily a good idea? The idea of a residual plot is that there
should be no trend, and so the smooth trend curve ought to go straight
across. The problem is that it will tend to wiggle, just by chance, as
here: it looks as if it goes up and down before flattening out. But if
you look at the points, <em>they</em> are all over the place, not close
to the smooth trend at all. So the smooth trend is rather
deceiving. Or, to put it another way, to indicate a real problem, the
smooth trend would have to be a <em>lot</em> farther from flat than this
one is. I’d call this one basically flat.</p>
</div>
<div id="endogenous-nitrogen-excretion-in-carp" class="section level2">
<h2><span class="header-section-number">13.6</span> Endogenous nitrogen excretion in carp</h2>
<p>A paper in Fisheries Science reported on variables that
affect “endogenous nitrogen excretion” or ENE in carp raised in
Japan. A number of carp were divided into groups based on body weight,
and each group was placed in a different tank. The mean body weight of
the carp placed in each tank was recorded. The carp were then fed a
protein-free diet three times daily for a period of 20 days. At the
end of the experiment, the amount of ENE in each tank was measured, in
milligrams of total fish body weight per day. (Thus it should not
matter that some of the tanks had more fish than others, because the
scaling is done properly.)</p>
<p>For this question, write a report in R Markdown that answers the
questions below and contains some narrative that describes your
analysis. Create an HTML document from your R Markdown.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data in from
<a href="http://www.utsc.utoronto.ca/~butler/c32/carp.txt">link</a>. There are 10
tanks.</li>
</ol>
<p>Solution</p>
<p>Just this. Listing the data is up to you, but doing so and
commenting that the values appear to be correct will improve your report.</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1034-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/carp.txt&quot;</span></a>
<a class="sourceLine" id="cb1034-2" data-line-number="2">carp=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)  </a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   tank = col_integer(),
##   bodyweight = col_double(),
##   ENE = col_double()
## )</code></pre>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1036-1" data-line-number="1">carp</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##     tank bodyweight   ENE
##    &lt;int&gt;      &lt;dbl&gt; &lt;dbl&gt;
##  1     1       11.7  15.3
##  2     2       25.3   9.3
##  3     3       90.2   6.5
##  4     4      213     6  
##  5     5       10.2  15.7
##  6     6       17.6  10  
##  7     7       32.6   8.6
##  8     8       81.3   6.4
##  9     9      142.    5.6
## 10    10      286.    6</code></pre>
<p>(b)??scatter-one?? Create a scatterplot of ENE (response) against bodyweight
(explanatory). Add a smooth trend to your plot.</p>
<p>Solution</p>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1038-1" data-line-number="1"><span class="kw">ggplot</span>(carp,<span class="kw">aes</span>(<span class="dt">x=</span>bodyweight,<span class="dt">y=</span>ENE))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span></a>
<a class="sourceLine" id="cb1038-2" data-line-number="2"><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-65-1.png" width="672"  /></p>
<p>This part is just about getting the plot. Comments are coming in a
minute. Note that <code>ENE</code> is capital letters, so that
<code>ene</code> will not work.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Is there an upward or downward trend (or neither)? Is the
relationship a line or a curve? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The trend is downward: as bodyweight increases, ENE
decreases. However, the decrease is rapid at first and then levels
off, so the relationship is nonlinear. I want some kind of
support for an assertion of non-linearity: anything that says that
the slope or rate of decrease is not constant is good.</p>
<p>(d)??linear?? Fit a straight line to the data, and obtain the R-squared
for the regression.</p>
<p>Solution</p>
<p><code>lm</code>. The first stage is to fit the straight line, saving
the result in a variable, and the second stage is to look at the
“fitted model object”, here via <code>summary</code>:</p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1040-1" data-line-number="1">carp<span class="fl">.1</span>=<span class="kw">lm</span>(ENE<span class="op">~</span>bodyweight,<span class="dt">data=</span>carp)</a>
<a class="sourceLine" id="cb1040-2" data-line-number="2"><span class="kw">summary</span>(carp<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ENE ~ bodyweight, data = carp)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -2.800 -1.957 -1.173  1.847  4.572 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 11.40393    1.31464   8.675 2.43e-05 ***
## bodyweight  -0.02710    0.01027  -2.640   0.0297 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.928 on 8 degrees of freedom
## Multiple R-squared:  0.4656, Adjusted R-squared:  0.3988 
## F-statistic: 6.971 on 1 and 8 DF,  p-value: 0.0297</code></pre>
<p>Finally, you need to give me a (suitably rounded) value for
R-squared: 46.6% or 47% or the equivalents as a decimal. I just
need the value at this point.
This kind of R-squared is actually pretty good for natural data, but
the issue is whether we can improve it by fitting a non-linear
model.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Obtain a residual plot (residuals against fitted values)
for this regression. Do you see any problems? If so, what does that
tell you about the relationship in the data?</li>
</ol>
<p>Solution</p>
<p>This is the easiest way: feed the output of the regression
straight into <code>ggplot</code>:</p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1042-1" data-line-number="1"><span class="kw">ggplot</span>(carp<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-67-1.png" width="672"  /></p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Fit a parabola to the data (that is, including an
<span class="math inline">\(x\)</span>-squared term). Compare the R-squared values for the models in
this part and part (??linear??). Does that suggest that the parabola
model is an improvement here over the linear model?</li>
</ol>
<p>Solution</p>
<p>Add bodyweight-squared to
the regression. Don’t forget the <code>I()</code>:</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1043-1" data-line-number="1">carp<span class="fl">.2</span>=<span class="kw">lm</span>(ENE<span class="op">~</span>bodyweight<span class="op">+</span><span class="kw">I</span>(bodyweight<span class="op">^</span><span class="dv">2</span>),<span class="dt">data=</span>carp)</a>
<a class="sourceLine" id="cb1043-2" data-line-number="2"><span class="kw">summary</span>(carp<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ENE ~ bodyweight + I(bodyweight^2), data = carp)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -2.0834 -1.7388 -0.5464  1.3841  2.9976 
## 
## Coefficients:
##                   Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     13.7127373  1.3062494  10.498 1.55e-05 ***
## bodyweight      -0.1018390  0.0288109  -3.535  0.00954 ** 
## I(bodyweight^2)  0.0002735  0.0001016   2.692  0.03101 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.194 on 7 degrees of freedom
## Multiple R-squared:  0.7374, Adjusted R-squared:  0.6624 
## F-statistic: 9.829 on 2 and 7 DF,  p-value: 0.009277</code></pre>
<p>R-squared has gone up from 47% to 74%, a substantial
improvement. This suggests to me that the parabola model is a
substantial improvement.</p>
<p>I try to avoid using the word “significant” in this context, since
we haven’t actually done a test of significance.</p>
<p>The reason for the <code>I()</code> is that the up-arrow has a special
meaning in <code>lm</code>, relating to interactions between factors (as
in ANOVA), that we don’t want here. Putting <code>I()</code> around it
means “use as is”, that is, raise bodyweight to power 2, rather than
using the special meaning of the up-arrow in <code>lm</code>.</p>
<p>Because it’s the up-arrow that is the problem, this applies whenever
you’re raising an explanatory variable to a power (or taking a
reciprocal or a square root, say).</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Is the test for the slope coefficient for the squared term
significant? What does this mean?</li>
</ol>
<p>Solution</p>
<p>Look along the <code>bodyweight</code>-squared line to get a P-value
of 0.031. This is less than the default 0.05, so it <em>is</em>
significant.
This means, in short, that the quadratic model is a significant
<em>improvement</em> over the linear one.
Said longer: the null hypothesis being tested is that the slope
coefficient of the squared term is zero (that is, that the squared
term has nothing to add over the linear model). This is rejected,
so the squared term has <em>something</em> to add in terms of
quality of prediction.</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Make the scatterplot of part (??scatter-one??), but add
the fitted curve. Describe any way in which the curve fails to fit well.</li>
</ol>
<p>Solution</p>
<p>This is a bit slippery, because the points to plot and the
fitted curve are from different data frames. What you do in this
case is to put a <code>data=</code> in one of the <code>geom</code>s,
which says “don’t use the data frame that was in the <code>ggplot</code>, but use this one instead”.
I would think about
starting with the regression object <code>carp.2</code> as my base
data frame, since we want (or I want) to do two things with
that: plot the fitted values and join them with lines. Then I
want to add the original data, just the points:</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1045-1" data-line-number="1"><span class="kw">ggplot</span>(carp<span class="fl">.2</span>,<span class="kw">aes</span>(<span class="dt">x=</span>carp<span class="op">$</span>bodyweight,<span class="dt">y=</span>.fitted),<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1045-2" data-line-number="2"><span class="kw">geom_line</span>(<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1045-3" data-line-number="3"><span class="kw">geom_point</span>(<span class="dt">data=</span>carp,<span class="kw">aes</span>(<span class="dt">x=</span>bodyweight,<span class="dt">y=</span>ENE))</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-69-1.png" width="672"  /></p>
<p>This works, but is not very aesthetic, because the bodyweight that is
plotted against the fitted values is in the wrong data frame, and so
we have to use the dollar-sign thing to get it from the right one.</p>
<p>A better way around this is “augment” the data with output from the regression object.
This is done using <code>augment</code> from
package <code>broom</code>:</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1046-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1046-2" data-line-number="2">carp<span class="fl">.2</span>a=<span class="kw">augment</span>(carp<span class="fl">.2</span>, carp)</a>
<a class="sourceLine" id="cb1046-3" data-line-number="3">carp<span class="fl">.2</span>a</a></code></pre></div>
<pre><code>## # A tibble: 10 x 10
##     tank bodyweight   ENE .fitted .se.fit .resid  .hat .sigma .cooksd
##  * &lt;int&gt;      &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1     1       11.7  15.3   12.6    1.07   2.74  0.239   1.99 0.215  
##  2     2       25.3   9.3   11.3    0.886 -2.01  0.163   2.19 0.0651 
##  3     3       90.2   6.5    6.75   1.07  -0.252 0.240   2.37 0.00182
##  4     4      213     6      4.43   1.25   1.57  0.325   2.24 0.122  
##  5     5       10.2  15.7   12.7    1.10   3.00  0.251   1.90 0.279  
##  6     6       17.6  10     12.0    0.980 -2.01  0.199   2.19 0.0866 
##  7     7       32.6   8.6   10.7    0.828 -2.08  0.143   2.18 0.0583 
##  8     8       81.3   6.4    7.24   1.01  -0.841 0.211   2.34 0.0166 
##  9     9      142.    5.6    4.78   1.31   0.822 0.355   2.33 0.0398 
## 10    10      286.    6      6.94   2.05  -0.940 0.875   2.11 3.40   
## # ... with 1 more variable: .std.resid &lt;dbl&gt;</code></pre>
<p>so now you see what <code>carp.2a</code> has in it, and then:</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1048-1" data-line-number="1">g=<span class="kw">ggplot</span>(carp<span class="fl">.2</span>a,<span class="kw">aes</span>(<span class="dt">x=</span>bodyweight,<span class="dt">y=</span>.fitted))<span class="op">+</span></a>
<a class="sourceLine" id="cb1048-2" data-line-number="2"><span class="kw">geom_line</span>(<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1048-3" data-line-number="3"><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>ENE))</a></code></pre></div>
<p>This is easier coding: there are only two non-standard things. The
first is that the fitted-value lines should be a distinct colour like
blue so that you can tell them from the data points. The second thing
is that for the second <code>geom_point</code>, the one that plots the data,
the <span class="math inline">\(x\)</span> coordinate <code>bodyweight</code> is correct so that we don’t
have to change that; we only have to change the <span class="math inline">\(y\)</span>-coordinate, which
is <code>ENE</code>. The plot is this:</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1049-1" data-line-number="1">g</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-71-1.png" width="672"  /></p>
<p>Concerning interpretation, you have a number of possibilities
here. The simplest is that the points in the middle are above the
curve, and the points at the ends are below. (That is, negative
residuals at the ends, and positive ones in the middle, which gives
you a hint for the next part.) Another is that the parabola curve
fails to capture the <em>shape</em> of the relationship; for example, I
see nothing much in the data suggesting that the relationship should go
back up, and even given that, the fitted curve doesn’t go especially
near any of the points.</p>
<p>I was thinking that the data should be fit better by something like
the left half of an upward-opening parabola, but I guess the curvature
on the left half of the plot suggests that it needs most of the left
half of the parabola just to cover the left half of the plot.</p>
<p>The moral of the story, as we see in the next part, is that the
parabola is the wrong curve for the job.</p>
<ol style="list-style-type: lower-roman">
<li>Obtain a residual plot for the parabola model. Do you see
any problems with it? (If you do, I’m not asking you to do anything
about them in this question, but I will.)</li>
</ol>
<p>Solution</p>
<p>The same idea as before for the other residual plot. Use the
fitted model object <code>carp.2</code> as your data frame for the
<code>ggplot</code>:</p>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1050-1" data-line-number="1"><span class="kw">ggplot</span>(carp<span class="fl">.2</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-72-1.png" width="672"  /></p>
<p>I think this is <em>still</em> a curve (or, it goes down and then
sharply up at the end). Either way, there is still a pattern.</p>
<p>That was all I needed, but as to what this means: our parabola was a
curve all right, but it appears not to be the right <em>kind</em> of
curve. I think the original data looks more like a hyperbola (a curve
like <span class="math inline">\(y=1/x\)</span>) than a parabola, in that it seems to decrease fast and
then gradually to a limit, and <em>that</em> suggests, as in the class
example, that we should try an asymptote model. Note how I specify it,
with the <code>I()</code> thing again, since <code>/</code> has a special meaning
to <code>lm</code> in the same way that
<code>^</code> does:</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1051-1" data-line-number="1">carp<span class="fl">.3</span>=<span class="kw">lm</span>(ENE<span class="op">~</span><span class="kw">I</span>(<span class="dv">1</span><span class="op">/</span>bodyweight),<span class="dt">data=</span>carp)</a>
<a class="sourceLine" id="cb1051-2" data-line-number="2"><span class="kw">summary</span>(carp<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = ENE ~ I(1/bodyweight), data = carp)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.29801 -0.12830  0.04029  0.26702  0.91707 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)       5.1804     0.2823   18.35 8.01e-08 ***
## I(1/bodyweight) 107.6690     5.8860   18.29 8.21e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6121 on 8 degrees of freedom
## Multiple R-squared:  0.9766, Adjusted R-squared:  0.9737 
## F-statistic: 334.6 on 1 and 8 DF,  p-value: 8.205e-08</code></pre>
<p>That fits <em>extraordinarily</em> well, with an R-squared up near
98%. The intercept is the asymptote, which suggests a (lower) limit
of about 5.2 for <code>ENE</code> (in the limit for large bodyweight). We
would have to ask the fisheries scientist whether this kind of thing
is a reasonable biological mechanism. It says that a carp always has
some ENE, no matter how big it gets, but a smaller carp will have a
lot more.</p>
<p>Does the fitted value plot look reasonable now? This is <code>augment</code> again since the fitted values and observed data come from different data frames:</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1053-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1053-2" data-line-number="2"><span class="kw">augment</span>(carp<span class="fl">.3</span>, carp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1053-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>bodyweight,<span class="dt">y=</span>.fitted))<span class="op">+</span></a>
<a class="sourceLine" id="cb1053-4" data-line-number="4"><span class="kw">geom_line</span>(<span class="dt">colour=</span><span class="st">&quot;blue&quot;</span>)<span class="op">+</span></a>
<a class="sourceLine" id="cb1053-5" data-line-number="5"><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y=</span>ENE))</a></code></pre></div>
<p><img src="12-regression_files/figure-html/augment2-1.png" width="672"  /></p>
<p>I’d say that does a really nice job of fitting the data. But it would
be nice to have a few more tanks with large-bodyweight fish, to
convince us that we have the shape of the trend right.</p>
<p>And, as ever, the residual plot. That’s a lot easier than the plot we
just did:</p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1054-1" data-line-number="1"><span class="kw">ggplot</span>(carp<span class="fl">.3</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-74-1.png" width="672"  /></p>
<p>All in all, that looks pretty good (and certainly a vast improvement
over the ones you got before).</p>
<p>When you write up your report, you can make it flow better by writing
it in a way that suggests that each thing was the obvious thing to do
next: that is, that <em>you</em> would have thought to do it next,
rather than me telling you what to do.</p>
<p>My report (as an R Markdown file) is at
<a href="http://www.utsc.utoronto.ca/~butler/c32/carp.Rmd">link</a>. Download it,
knit it, play with it.</p>
</div>
<div id="sparrowhawks" class="section level2">
<h2><span class="header-section-number">13.7</span> Sparrowhawks</h2>
<p>One of nature’s patterns is the relationship
between the percentage of adult birds in a colony that return from the
previous year, and the number of new adults that join the colony. Data
for 13 colonies of sparrowhawks can be found at
<a href="http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt" class="uri">http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt</a>. The
columns are the percentage of adults returning from the previous year,
and the number of new adults that join the colony.</p>
<ol style="list-style-type: lower-alpha">
<li>Create a new R Markdown report, give it a suitable title, and
ask for HTML output. Answer the questions that follow in your
report. At any stage, you can Knit HTML
to see how the report looks so far.</li>
</ol>
<p>Solution</p>
<p>In R Studio, select File, New File, R Markdown. Fill in the Title,
Author and leave the Default Output Format at HTML. You’ll see a
template report with the document info at the top. This is my document info:</p>
<p><img src="sh0.png" /></p>
<p>This is known in the jargon as a “YAML block”.
Below that is the template R Markdown document, which you can delete now or later.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Read in the data and display the first few values. Add some text saying how many rows of data
there are.</li>
</ol>
<p>Solution</p>
<p>Read the data into a data frame. In your
report, add some text like “we read in the data”, perhaps
after a section heading like “The data”. Then add a <em>code chunk</em>
by selecting Chunks and Insert Chunk, or by pressing
control-alt-I. So far you have something like this.</p>
<p><img src="sh1.png" /></p>
<p>Inside the code chunk, that is, in the bit between the
backtick characters, put R code, just as you would type it at
the Console or put in an R notebook. In this case, that would be
the following code, minus the message that comes out of
<code>read_delim</code>:</p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1055-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1055-2" data-line-number="2">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/sparrowhawk.txt&quot;</span></a>
<a class="sourceLine" id="cb1055-3" data-line-number="3">sparrowhawks=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   returning = col_integer(),
##   newadults = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1057-1" data-line-number="1">sparrowhawks</a></code></pre></div>
<p>For you, it looks like this:</p>
<p><img src="sh2.png" /></p>
<p>We don’t know how many rows of data there are yet, so I’ve left a
“placeholder” for it, when we figure it out.
The file is annoyingly called <code>sparrowhawk.txt</code>,
singular. Sorry about that.
If you knit this (click on “Knit HTML” next to the ball of wool,
or press control-shift-K), it should run, and you’ll see a viewer
pop up with the HTML output. Now you can see how many rows there
are, and you can go back and edit the R Markdown and put in 13 in
place of <code>xxx</code>, and knit again.
You might be worried about how hard R is working with all this
knitting. Don’t worry about that. R can take it.
Mine looked like this:</p>
<p><img src="waluj.png" /></p>
<p>There is a better way of adding values that come from the output,
which I mention here in case you are interested (if you are not,
feel free to skip this). What you do is to make what is called an
“inline code chunk”. Where you want a number to appear in the
text, you have some R Markdown that looks like this:</p>
<p><img src="sh3.png" /></p>
<p>The piece inside the backticks is the letter <code>r</code>, a space,
and then one line of R code. The one line of code will be run, and
all of the stuff within the backticks will be replaced in the
output by the result of running the R code, in this case the
number 13. Typically, you are extracting a number from the data,
like the number of rows or a mean of something. If it’s a decimal
number, it will come out with a lot of decimal places unless you
explicitly <code>round</code> it.
OK, let me try it: the data frame has 13
rows altogether. I didn’t type that number; it was calculated from
the data frame. Woo hoo!</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Create a new section entitled “Exploratory analysis”, and
create a scatterplot for predicting number of new adults from the
percentage of returning adults. Describe what you see, adding some
suitable text to your report.</li>
</ol>
<p>Solution</p>
<p>The R code you add should look like this, with the results shown
(when you knit the report again):</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1058-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1058-2" data-line-number="2"><span class="kw">ggplot</span>(sparrowhawks,<span class="kw">aes</span>(<span class="dt">x=</span>returning,<span class="dt">y=</span>newadults))<span class="op">+</span></a>
<a class="sourceLine" id="cb1058-3" data-line-number="3"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-76-1.png" width="672"  /></p>
<p><br></p>
<p>The piece of report that I added looks like this:</p>
<p><img src="sh4.png" /></p>
<p>Note (i) that you have to do nothing special to get the plot to
appear, and (ii) that I put “smaller” in italics, and you see
how.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Obtain the correlation between the two variables. Is this
consistent with the scatterplot? Explain briefly. (The R function
you need is <code>cor</code>. You can feed it a data frame.)</li>
</ol>
<p>Solution</p>
<p>The appropriate R code is this, in another code chunk:</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1060-1" data-line-number="1"><span class="kw">with</span>(sparrowhawks,<span class="kw">cor</span>(newadults,returning))</a></code></pre></div>
<pre><code>## [1] -0.7484673</code></pre>
<p>Or you can ask for the correlations of the whole data frame:</p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1062-1" data-line-number="1"><span class="kw">cor</span>(sparrowhawks)</a></code></pre></div>
<pre><code>##            returning  newadults
## returning  1.0000000 -0.7484673
## newadults -0.7484673  1.0000000</code></pre>
<p>This latter is a “correlation matrix” with a correlation between each
column and each other column. Obviously the correlation between a
column and itself is 1, and that is <em>not</em> the one we want.</p>
<p>I added this to the report (still in the Exploratory Analysis
section, since it seems to belong there):</p>
<p><img src="sh5.png" /></p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Obtain the regression line for predicting the number of new
adults from the percentage of returning adults.</li>
</ol>
<p>Solution</p>
<p>This R code, in another code chunk:</p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1064-1" data-line-number="1">newadults<span class="fl">.1</span>=<span class="kw">lm</span>(newadults<span class="op">~</span>returning,<span class="dt">data=</span>sparrowhawks)</a>
<a class="sourceLine" id="cb1064-2" data-line-number="2"><span class="kw">summary</span>(newadults<span class="fl">.1</span>)  </a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = newadults ~ returning, data = sparrowhawks)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -5.8687 -1.2532  0.0508  2.0508  5.3071 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 31.93426    4.83762   6.601 3.86e-05 ***
## returning   -0.30402    0.08122  -3.743  0.00325 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 3.667 on 11 degrees of freedom
## Multiple R-squared:  0.5602, Adjusted R-squared:  0.5202 
## F-statistic: 14.01 on 1 and 11 DF,  p-value: 0.003248</code></pre>
<ol start="6" style="list-style-type: lower-alpha">
<li>What are the intercept and slope of your regression line? Is
the slope significant? What does that mean, in the context of the data?</li>
</ol>
<p>Solution</p>
<p>See the output in the previous part. That’s what we need to talk about.
I added this to the report. I thought we deserved a new section here:</p>
<p><img src="sh6.png" /></p>
<ol start="7" style="list-style-type: lower-alpha">
<li>Create a scatterplot of the data with the regression line on it.</li>
</ol>
<p>Solution</p>
<p>This code. Using <code>geom_smooth</code> with
<code>method=&quot;lm&quot;</code>
will add the regression line to the plot:</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1066-1" data-line-number="1"><span class="kw">ggplot</span>(sparrowhawks,<span class="kw">aes</span>(<span class="dt">x=</span>returning,<span class="dt">y=</span>newadults))<span class="op">+</span></a>
<a class="sourceLine" id="cb1066-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>(<span class="dt">method=</span><span class="st">&quot;lm&quot;</span>)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-80-1.png" width="672"  /></p>
<p>I added a bit of text to the report, which I will show in a moment.</p>
<ol start="8" style="list-style-type: lower-alpha">
<li>For short-lived birds, the association between these two
variables is positive: changes in weather and food supply cause the
populations of new and returning birds to increase together. For
long-lived territorial birds, however, the association is negative
because returning birds claim their territories in the colony and do
not leave room for new recruits. Which type of species is the
sparrowhawk? Add a short Conclusions section to your report with
discussion of this issue.</li>
</ol>
<p>Solution</p>
<p>My addition to the report looks like this:</p>
<p><img src="sh7.png" /></p>
<p>I think that rounds off the report nicely.</p>
</div>
<div id="salaries-of-social-workers" class="section level2">
<h2><span class="header-section-number">13.8</span> Salaries of social workers</h2>
<p>Another salary-prediction question: does the number of years
of work experience that a social worker has help to predict their
salary? Data for 50 social workers are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/socwork.txt">link</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R. Check that you have 50 observations on
two variables. Also do something to check that the years of
experience and annual salary figures look reasonable overall.</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1067-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/socwork.txt&quot;</span></a>
<a class="sourceLine" id="cb1067-2" data-line-number="2">soc=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   experience = col_integer(),
##   salary = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1069-1" data-line-number="1">soc</a></code></pre></div>
<pre><code>## # A tibble: 50 x 2
##    experience salary
##         &lt;int&gt;  &lt;int&gt;
##  1          7  26075
##  2         28  79370
##  3         23  65726
##  4         18  41983
##  5         19  62308
##  6         15  41154
##  7         24  53610
##  8         13  33697
##  9          2  22444
## 10          8  32562
## # ... with 40 more rows</code></pre>
<p>That checks that we have the right <em>number</em> of observations; to
check that we have sensible <em>values</em>, something like
<code>summary</code> is called for:</p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1071-1" data-line-number="1"><span class="kw">summary</span>(soc)  </a></code></pre></div>
<pre><code>##    experience        salary     
##  Min.   : 1.00   Min.   :16105  
##  1st Qu.:13.50   1st Qu.:36990  
##  Median :20.00   Median :50948  
##  Mean   :18.12   Mean   :50171  
##  3rd Qu.:24.75   3rd Qu.:65204  
##  Max.   :28.00   Max.   :99139</code></pre>
<p>A person working in any field cannot have a negative number of years
of experience, and cannot have more than about 40 years of experience
(or else they would have retired). Our experience numbers fit
that. Salaries had better be five or six figures, and salaries for
social workers are not generally all that high, so these figures look
reasonable.</p>
<p>A rather more <code>tidyverse</code> way is this:</p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1073-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="kw">c</span>(<span class="st">&quot;min&quot;</span>,<span class="st">&quot;max&quot;</span>)) </a></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   experience_min salary_min experience_max salary_max
##            &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;
## 1              1      16105             28      99139</code></pre>
<p>This gets the minimum and maximum of all the variables. I would have
liked them arranged in a nice rectangle (<code>min</code> and <code>max</code>
as rows, the variables as columns), but that’s not how this comes out.</p>
<p>Here is another:</p>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1075-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_df</span>(<span class="op">~</span><span class="kw">quantile</span>(.)) </a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   experience salary
##        &lt;dbl&gt;  &lt;dbl&gt;
## 1        1   16105 
## 2       13.5 36990.
## 3       20   50948.
## 4       24.8 65204.
## 5       28   99139</code></pre>
<p>These are the five-number summaries of each variable. Normally, they
come with percentiles attached:</p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1077-1" data-line-number="1"><span class="kw">quantile</span>(soc<span class="op">$</span>experience)</a></code></pre></div>
<pre><code>##    0%   25%   50%   75%  100% 
##  1.00 13.50 20.00 24.75 28.00</code></pre>
<p>but the percentiles get lost in the transition to a <code>tibble</code>, and I
haven’t found out how to get them back.</p>
<p>This almost works:</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1079-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_df</span>(<span class="op">~</span><span class="kw">enframe</span>(<span class="kw">quantile</span>(.)))</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    name    value
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 0%        1  
##  2 25%      13.5
##  3 50%      20  
##  4 75%      24.8
##  5 100%     28  
##  6 0%    16105  
##  7 25%   36990. 
##  8 50%   50948. 
##  9 75%   65204. 
## 10 100%  99139</code></pre>
<p>but, though we now have the percentiles, we’ve lost the names of the variables, so it isn’t much better.</p>
<p>In this context, <code>map</code> says
“do whatever is in the brackets for each column of the data frame”.
(That’s the implied “for each”.) The output from <code>quantile</code>
is a vector that we would like to have display as a data frame, so <code>map_df</code>
instead of any other form of <code>map</code>.</p>
<p>As you know, the <code>map</code> family is
actually very flexible: they run a function “for each” anything and
glue the results together, like this:</p>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1081-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(median) </a></code></pre></div>
<pre><code>## experience     salary 
##       20.0    50947.5</code></pre>
<p>which gets the median for each variable. That’s the same thing as this:</p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1083-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize_all</span>(<span class="st">&quot;median&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   experience salary
##        &lt;dbl&gt;  &lt;dbl&gt;
## 1         20 50948.</code></pre>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a scatterplot showing how salary depends on
experience. Does the nature of the trend make sense?</li>
</ol>
<p>Solution</p>
<p>The usual:</p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1085-1" data-line-number="1"><span class="kw">ggplot</span>(soc,<span class="kw">aes</span>(<span class="dt">x=</span>experience,<span class="dt">y=</span>salary))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-89-1.png" width="672"  /></p>
<p>As experience goes up, salary also goes up, as you would expect. Also,
the trend seems more or less straight.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Fit a regression predicting salary from experience, and
display the results. Is the slope positive or negative? Does that
make sense?</li>
</ol>
<p>Solution</p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1086-1" data-line-number="1">soc<span class="fl">.1</span>=<span class="kw">lm</span>(salary<span class="op">~</span>experience,<span class="dt">data=</span>soc)</a>
<a class="sourceLine" id="cb1086-2" data-line-number="2"><span class="kw">summary</span>(soc<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = salary ~ experience, data = soc)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -17666.3  -5498.2   -726.7   4667.7  27811.6 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  11368.7     3160.3   3.597 0.000758 ***
## experience    2141.4      160.8  13.314  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 8642 on 48 degrees of freedom
## Multiple R-squared:  0.7869, Adjusted R-squared:  0.7825 
## F-statistic: 177.3 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The slope is (significantly) positive, which squares with our guess
(more experience goes with greater salary), and also the upward trend
on the scatterplot. The value of the slope is about 2,000; this means
that one more year of experience goes with about a $2,000 increase in
salary.</p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Obtain and plot the residuals against the fitted values. What
problem do you see?</li>
</ol>
<p>Solution</p>
<p>The easiest way to do this with <code>ggplot</code> is to plot the
<em>regression object</em> (even though it is not actually a data
frame), and plot the <code>.fitted</code> and <code>.resid</code>
columns in it, not forgetting the initial dots:</p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1088-1" data-line-number="1"><span class="kw">ggplot</span>(soc<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-91-1.png" width="672"  /></p>
<p>I see a “fanning-out”: the residuals are getting bigger <em>in size</em>
(further away from zero) as the fitted values get bigger. That
is, when the (estimated) salary gets larger, it also gets more
variable.</p>
<p>Fanning-out is sometimes hard to see. What you can do if you suspect
that it might have happened is to plot the <em>absolute value</em> of
the residuals against the fitted values. The absolute value is the
residual without its plus or minus sign, so if the residuals are
getting bigger in size, their absolute values are getting bigger. That
would look like this:</p>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1089-1" data-line-number="1"><span class="kw">ggplot</span>(soc<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span><span class="kw">abs</span>(.resid)))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-92-1.png" width="672"  /></p>
<p>I added a smooth trend to this to help us judge whether the
absolute-value-residuals are getting bigger as the fitted values get
bigger. It looks to me as if the overall trend is an increasing one,
apart from those few small fitted values that have larger-sized
residuals. Don’t get thrown off by the kinks in the smooth trend. Here
is a smoother version:</p>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1091-1" data-line-number="1"><span class="kw">ggplot</span>(soc<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span><span class="kw">abs</span>(.resid)))<span class="op">+</span><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>(<span class="dt">span=</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-93-1.png" width="672"  /></p>
<p>The larger fitted values, according to this, have residuals larger in size.</p>
<p>The thing that controls the smoothness of the smooth trend is the
value of <code>span</code> in <code>geom_smooth</code>. The default is
0.75. The larger the value you use, the smoother the trend; the
smaller, the more wiggly. I’m inclined to think that the default value
is a bit too small. Possibly this value is too big, but it shows you
the idea.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>The problem you unearthed in the previous part is often helped
by a transformation. Run Box-Cox on your data to find a suitable
transformation. What transformation is suggested?</li>
</ol>
<p>Solution</p>
<p>You’ll need to call in (and install if necessary) the package
<code>MASS</code> that contains <code>boxcox</code>:</p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1093-1" data-line-number="1"><span class="kw">library</span>(MASS)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<p>I explain that “masked” thing below.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1096-1" data-line-number="1"><span class="kw">boxcox</span>(salary<span class="op">~</span>experience,<span class="dt">data=</span>soc)</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-95-1.png" width="672"  /></p>
<p>That one looks like <span class="math inline">\(\lambda=0\)</span> or log. You could probably also
justify fourth root (power 0.25), but log is a very common
transformation, which people won’t need much persuasion to accept.</p>
<p>There’s one annoyance with <code>MASS</code>: it has a <code>select</code>
(which I have never used), and if you load <code>tidyverse</code> first
and <code>MASS</code> second, as I have done here, when you mean to run
the column-selection <code>select</code>, it will actually run the
<code>select</code> that comes from <code>MASS</code>, and give you an error
that you will have a terrible time debugging. That’s what that
“masked” message was when you loaded <code>MASS</code>.</p>
<p>So I’m going to be tidy and get rid of <code>MASS</code>, now that I’m
finished with it. Let’s first see which packages are loaded, rather a
lot in my case:
<label for="tufte-mn-43" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-43" class="margin-toggle"><span class="marginnote">The packages before <em>tidyverse</em> other than <em>MASS</em> are all loaded by the <em>tidyverse</em>, which is why there are so many.</span></p>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1097-1" data-line-number="1"><span class="kw">search</span>()</a></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;        &quot;package:MASS&quot;      &quot;package:broom&quot;    
##  [4] &quot;package:GGally&quot;    &quot;package:bindrcpp&quot;  &quot;package:forcats&quot;  
##  [7] &quot;package:stringr&quot;   &quot;package:dplyr&quot;     &quot;package:purrr&quot;    
## [10] &quot;package:readr&quot;     &quot;package:tidyr&quot;     &quot;package:tibble&quot;   
## [13] &quot;package:ggplot2&quot;   &quot;package:tidyverse&quot; &quot;package:stats&quot;    
## [16] &quot;package:graphics&quot;  &quot;package:grDevices&quot; &quot;package:utils&quot;    
## [19] &quot;package:datasets&quot;  &quot;package:methods&quot;   &quot;Autoloads&quot;        
## [22] &quot;package:base&quot;</code></pre>
<p>then get rid of <code>MASS</code>:</p>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1099-1" data-line-number="1"><span class="kw">detach</span>(<span class="st">&quot;package:MASS&quot;</span>,<span class="dt">unload=</span>T)</a></code></pre></div>
<p>Now check that it has gone:</p>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1100-1" data-line-number="1"><span class="kw">search</span>()</a></code></pre></div>
<pre><code>##  [1] &quot;.GlobalEnv&quot;        &quot;package:broom&quot;     &quot;package:GGally&quot;   
##  [4] &quot;package:bindrcpp&quot;  &quot;package:forcats&quot;   &quot;package:stringr&quot;  
##  [7] &quot;package:dplyr&quot;     &quot;package:purrr&quot;     &quot;package:readr&quot;    
## [10] &quot;package:tidyr&quot;     &quot;package:tibble&quot;    &quot;package:ggplot2&quot;  
## [13] &quot;package:tidyverse&quot; &quot;package:stats&quot;     &quot;package:graphics&quot; 
## [16] &quot;package:grDevices&quot; &quot;package:utils&quot;     &quot;package:datasets&quot; 
## [19] &quot;package:methods&quot;   &quot;Autoloads&quot;         &quot;package:base&quot;</code></pre>
<p>It has. Now any calls to <code>select</code> will use the right one. We hope.</p>
<p>The output of <code>search</code> is called the <strong>search list</strong>, and
it tells you where R will go looking for things. The first one
<code>.GlobalEnv</code> is where all your
variables, data frames etc. get stored, and that is what gets
searched first. Then R will go
looking in each thing in turn until it finds what it is looking
for. When you load a package with <code>library()</code>, it gets added to
the list <em>in second place</em>, behind <code>.GlobalEnv</code>. So, when
we had <code>MASS</code> loaded (the first <code>search()</code>), if we
called <code>select</code>, then it would find the one in <code>MASS</code>
first.</p>
<p>If you want to insist on something like “the <code>select</code> that lives in <code>dplyr</code>”,
you can do that by saying
<code>dplyr::select</code>. But this is kind of cumbersome if you don’t
need to do it, which is why I got rid of <code>MASS</code> here.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>Calculate a new variable as suggested by your
transformation. Use your transformed response in a regression,
showing the summary.</li>
</ol>
<p>Solution</p>
<p>The best way is to add the new variable to the data frame using
<code>mutate</code>, and save that new data frame. That goes like this:</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1102-1" data-line-number="1">soc<span class="fl">.2</span>=soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">log_salary=</span><span class="kw">log</span>(salary))</a></code></pre></div>
<p>and then</p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1103-1" data-line-number="1">soc<span class="fl">.3</span>=<span class="kw">lm</span>(log_salary<span class="op">~</span>experience,<span class="dt">data=</span>soc<span class="fl">.2</span>)</a>
<a class="sourceLine" id="cb1103-2" data-line-number="2"><span class="kw">summary</span>(soc<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_salary ~ experience, data = soc.2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.35435 -0.09046 -0.01725  0.09739  0.26355 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 9.841315   0.056356  174.63   &lt;2e-16 ***
## experience  0.049979   0.002868   17.43   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1541 on 48 degrees of freedom
## Multiple R-squared:  0.8635, Adjusted R-squared:  0.8607 
## F-statistic: 303.7 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>I think it’s best to save the data frame with <code>log_salary</code> in
it, since we’ll be doing a couple of things with it, and it’s best to
be able to start from <code>soc.2</code>. But you can also do this:</p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1105-1" data-line-number="1">soc <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">log_salary=</span><span class="kw">log</span>(salary)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1105-2" data-line-number="2"><span class="kw">lm</span>(log_salary<span class="op">~</span>experience,<span class="dt">data=</span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1105-3" data-line-number="3"><span class="kw">summary</span>()</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log_salary ~ experience, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.35435 -0.09046 -0.01725  0.09739  0.26355 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 9.841315   0.056356  174.63   &lt;2e-16 ***
## experience  0.049979   0.002868   17.43   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1541 on 48 degrees of freedom
## Multiple R-squared:  0.8635, Adjusted R-squared:  0.8607 
## F-statistic: 303.7 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The second line is where the fun starts: <code>lm</code> wants the data
frame as a <code>data=</code> at the end. So, to specify a data frame in
something like <code>lm</code>, we have to use the special symbol
<code>.</code>, which is another way to say “the data frame that came out of the previous step”.</p>
<p>Got that? All right. The last line is a piece of cake in
comparison. Normally <code>summary</code> would require a data frame or a
fitted model object, but the second line produces one (a fitted model
object) as output, which goes into <code>summary</code> as the first
(and only) thing, so all is good and we get the regression output.</p>
<p>What we lose by doing this is that if we need something later from this
fitted model object, we are out of luck since we didn’t save
it. That’s why I created <code>soc.2</code> and <code>soc.3</code> above.</p>
<p>You can also put functions of things directly into <code>lm</code>:</p>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1107-1" data-line-number="1">soc<span class="fl">.1</span>a=<span class="kw">lm</span>(<span class="kw">log</span>(salary)<span class="op">~</span>experience, <span class="dt">data=</span>soc)</a>
<a class="sourceLine" id="cb1107-2" data-line-number="2"><span class="kw">summary</span>(soc<span class="fl">.1</span>a)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(salary) ~ experience, data = soc)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.35435 -0.09046 -0.01725  0.09739  0.26355 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 9.841315   0.056356  174.63   &lt;2e-16 ***
## experience  0.049979   0.002868   17.43   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1541 on 48 degrees of freedom
## Multiple R-squared:  0.8635, Adjusted R-squared:  0.8607 
## F-statistic: 303.7 on 1 and 48 DF,  p-value: &lt; 2.2e-16</code></pre>
<ol start="7" style="list-style-type: lower-alpha">
<li>Obtain and plot the residuals against the fitted values for
this regression. Do you seem to have solved the problem with the
previous residual plot?</li>
</ol>
<p>Solution</p>
<p>As we did before, treating the regression object as if it were a
data frame:</p>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1109-1" data-line-number="1"><span class="kw">ggplot</span>(soc<span class="fl">.3</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-103-1.png" width="672"  /></p>
<p>That, to my mind, is a horizontal band of points, so I would say yes,
I have solved the fanning out.</p>
<p>One concern I have about the residuals is that there seem to be a
couple of very negative values: that is, are the residuals normally
distributed as they should be? Well, that’s easy enough to check:</p>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1110-1" data-line-number="1"><span class="kw">ggplot</span>(soc<span class="fl">.3</span>,<span class="kw">aes</span>(<span class="dt">sample=</span>.resid))<span class="op">+</span><span class="kw">stat_qq</span>()<span class="op">+</span><span class="kw">stat_qq_line</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-104-1.png" width="672"  /></p>
<p>The issues here are that those bottom two values are a bit too low,
and the top few values are a bit bunched up (that curve at the top).
It is really not bad, though, so I am making the call that I don’t
think I needed to worry.
Note that the transformation we found here is the same as the
log-salary used by the management consultants in the
backward-elimination question, and with the same effect: an extra year
of experience goes with a <em>percent</em> increase in salary.</p>
<p>What increase? Well, the slope is about 0.05, so adding a year of
experience is predicted to increase log-salary by 0.05, or to
multiply actual salary by</p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1111-1" data-line-number="1"><span class="kw">exp</span>(<span class="fl">0.05</span>)  </a></code></pre></div>
<pre><code>## [1] 1.051271</code></pre>
<p>or to increase salary by about 5%.</p>
</div>
<div id="predicting-volume-of-wood-in-pine-trees" class="section level2">
<h2><span class="header-section-number">13.9</span> Predicting volume of wood in pine trees</h2>
<p>In forestry, the financial value of a tree
is the volume of wood that it contains. This is difficult to estimate
while the tree is still standing, but the diameter is easy to measure
with a tape measure (to measure the circumference) and a calculation
involving <span class="math inline">\(\pi\)</span>, assuming that the cross-section of the tree is at
least approximately circular. The standard measurement is “diameter at breast height”
(that is, at the height of a human breast or
chest), defined as being 4.5 feet above the ground.</p>
<p>Several pine trees had their diameter measured shortly before being
cut down, and for each tree, the volume of wood was recorded. The data
are in
<a href="http://www.utsc.utoronto.ca/~butler/c32/pinetrees.txt">link</a>. The
diameter is in inches and the volume is in cubic inches. Is it
possible to predict the volume of wood from the diameter?</p>
<ol style="list-style-type: lower-alpha">
<li>Read the data into R and display the values (there are not
very many).</li>
</ol>
<p>Solution</p>
<p>Observe that the data values are separated by spaces, and therefore
that <code>read_delim</code> will do it:</p>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1113-1" data-line-number="1">my_url=<span class="st">&quot;http://www.utsc.utoronto.ca/~butler/c32/pinetrees.txt&quot;</span></a>
<a class="sourceLine" id="cb1113-2" data-line-number="2">trees=<span class="kw">read_delim</span>(my_url,<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   diameter = col_integer(),
##   volume = col_integer()
## )</code></pre>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1115-1" data-line-number="1">trees</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    diameter volume
##       &lt;int&gt;  &lt;int&gt;
##  1       32    185
##  2       29    109
##  3       24     95
##  4       45    300
##  5       20     30
##  6       30    125
##  7       26     55
##  8       40    246
##  9       24     60
## 10       18     15</code></pre>
<p>That looks like the data file.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Make a suitable plot.</li>
</ol>
<p>Solution</p>
<p>No clues this time. You need to recognize that you have two
quantitative variables, so that a scatterplot is called
for. Also, the volume is the response, so that should go on the <span class="math inline">\(y\)</span>-axis:</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1117-1" data-line-number="1"><span class="kw">ggplot</span>(trees,<span class="kw">aes</span>(<span class="dt">x=</span>diameter,<span class="dt">y=</span>volume))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-107-1.png" width="672"  /></p>
<p>You can put a smooth trend on it if you like, which would
look like this:</p>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1118-1" data-line-number="1"><span class="kw">ggplot</span>(trees,<span class="kw">aes</span>(<span class="dt">x=</span>diameter,<span class="dt">y=</span>volume))<span class="op">+</span></a>
<a class="sourceLine" id="cb1118-2" data-line-number="2"><span class="kw">geom_point</span>()<span class="op">+</span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="12-regression_files/figure-html/unnamed-chunk-108-1.png" width="672"  /></p>
<p>I’ll take either of those for this part, though I think the smooth
trend actually obscures the issue here (because there is not so much
data).</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Describe what you learn from your plot about the
relationship between diameter and volume, if anything.</li>
</ol>
<p>Solution</p>
<p>The word “relationship” offers a clue that a scatterplot would
have been a good idea, if you hadn’t realized by now.
I am guided by “form, direction, strength” in looking at a scatterplot:</p>
<ul>
<li><p>Form: it is an apparently linear relationship.</p></li>
<li><p>Direction: it is an upward trend: that is, a tree with a larger diameter also has a larger volume of wood. (This is not very surprising.)</p></li>
<li><p>Strength: I’d call this a strong (or moderate-to-strong) relationship. (We’ll see in a minute what the R-squared is.)</p></li>
</ul>
<p>You don’t need to be as formal as this, but you <em>do</em> need
to get at the idea that it is an upward trend, apparently
linear, and at least fairly strong.
<label for="tufte-mn-44" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-44" class="margin-toggle"><span class="marginnote">When this was graded, it was 3 marks, to clue you in that there are three things to say.</span></p>
<ol start="4" style="list-style-type: lower-alpha">
<li>Fit a (linear) regression, predicting volume from diameter,
and obtain the <code>summary</code>. How would you describe the R-squared?</li>
</ol>
<p>Solution</p>
<p>My naming convention is (usually) to call the fitted model
object by the name of the response variable and a number. (I
have always used dots, but in the spirit of the
<code>tidyverse</code> I suppose I should use underscores.)</p>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1120-1" data-line-number="1">volume<span class="fl">.1</span>=<span class="kw">lm</span>(volume<span class="op">~</span>diameter,<span class="dt">data=</span>trees)</a>
<a class="sourceLine" id="cb1120-2" data-line-number="2"><span class="kw">summary</span>(volume<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = volume ~ diameter, data = trees)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -36.497  -9.982   1.751   8.959  28.139 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -191.749     23.954  -8.005 4.35e-05 ***
## diameter      10.894      0.801  13.600 8.22e-07 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 20.38 on 8 degrees of freedom
## Multiple R-squared:  0.9585, Adjusted R-squared:  0.9534 
## F-statistic:   185 on 1 and 8 DF,  p-value: 8.217e-07</code></pre>
<p>R-squared is nearly 96%, so the relationship is definitely a strong one.</p>
<p>I also wanted to mention the <code>broom</code> package, which was
installed with the <code>tidyverse</code> but which you need to load
separately. It provides two handy ways to summarize a fitted model
(regression, analysis of variance or whatever):</p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1122-1" data-line-number="1"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1122-2" data-line-number="2"><span class="kw">glance</span>(volume<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
## *     &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.959         0.953  20.4      185. 8.22e-7     2  -43.2  92.4  93.4
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>This gives a one-line summary of a model, including things like
R-squared. This is handy if you’re fitting more than one model,
because you can collect the one-line summaries together into a data
frame and eyeball them.</p>
<p>The other summary is this one:</p>
<div class="sourceCode" id="cb1124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1124-1" data-line-number="1"><span class="kw">tidy</span>(volume<span class="fl">.1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   term        estimate std.error statistic     p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 (Intercept)   -192.     24.0       -8.01 0.0000435  
## 2 diameter        10.9     0.801     13.6  0.000000822</code></pre>
<p>This gives a table of intercepts, slopes and their P-values, but the
value to this one is that it is a <em>data frame</em>, so if you want to
pull anything out of it, you know how to do that:</p>
<div class="sourceCode" id="cb1126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1126-1" data-line-number="1"><span class="kw">tidy</span>(volume<span class="fl">.1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(term<span class="op">==</span><span class="st">&quot;diameter&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term     estimate std.error statistic     p.value
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;
## 1 diameter     10.9     0.801      13.6 0.000000822</code></pre>
<p>This gets the estimated slope and its P-value, without worrying about
the corresponding things for the intercept, which are usually of less
interest anyway.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li>Draw a graph that will help you decide whether you trust
the linearity of this regression. What do you conclude? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>The thing I’m fishing for is a residual plot (of the residuals
against the fitted values), and on it you are looking for a
random mess of nothingness:</p>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1128-1" data-line-number="1"><span class="kw">ggplot</span>(volume<span class="fl">.1</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-113-1.png" width="672"  /></p>
<p>Make a call. You could say that there’s no discernible pattern,
especially with such a small data set, and
therefore that the regression is fine. Or you could say that there is
fanning-in: the two points on the right have residuals close to 0
while the points on the left have residuals larger in size. Say
something.</p>
<p>I don’t think you can justify a curve or a trend, because
the residuals on the left are both positive and negative.</p>
<p>My feeling is that the residuals on the right are close to 0 because
these points have noticeably larger diameter than the others, and they
are <em>influential</em> points in the regression that will pull the
line closer to themselves. This is why their residuals are close to
zero. But I am happy with either of the points made in the paragraph
under the plot.</p>
<ol start="6" style="list-style-type: lower-alpha">
<li>What would you guess would be the volume of a tree of
diameter zero? Is that what the regression predicts? Explain briefly.</li>
</ol>
<p>Solution</p>
<p>Logically, a tree that has diameter zero is a non-existent tree,
so its volume should be zero as well.
In the regression, the quantity that says what volume is when
diameter is zero is the <em>intercept</em>. Here the intercept is
<span class="math inline">\(-192\)</span>, which is definitely not zero. In fact, if you look at
the P-value, the intercept is significantly <em>less</em> than
zero. Thus, the model makes no logical sense for trees of small
diameter. The smallest tree in the data set has diameter 18,
which is not really small, I suppose, but it is a little
disconcerting to have a model that makes no logical sense.</p>
<ol start="7" style="list-style-type: lower-alpha">
<li>A simple way of modelling a tree’s shape is to pretend it is a
cone, like this, but probably taller and skinnier:</li>
</ol>
<p><img src="/home/ken/Pictures/conebnw.png" /></p>
<p>with its base on the ground. What is the relationship between the
<em>diameter</em> (at the base) and volume of a cone? (If you don’t
remember, look it up. You’ll probably get a formula in terms of the
radius, which you’ll have to convert.
Cite the website you used.)</p>
<p>Solution</p>
<p>According to
<a href="http://www.web-formulas.com/Math_Formulas/Geometry_Volume_of_Cone.aspx">link</a>,
the volume of a cone is <span class="math inline">\(V=\pi r^2h/3\)</span>, where <span class="math inline">\(V\)</span> is the volume,
<span class="math inline">\(r\)</span> is the radius (at the bottom of the cone) and <span class="math inline">\(h\)</span> is the
height. The diameter is twice the radius, so replace <span class="math inline">\(r\)</span> by
<span class="math inline">\(d/2\)</span>, <span class="math inline">\(d\)</span> being the diameter. A little algebra gives
<span class="math display">\[ V = \pi d^2 h / 12.\]</span></p>
<ol start="8" style="list-style-type: lower-alpha">
<li>Fit a regression model that predicts volume from diameter
according to the formula you obtained in the previous part. You can
assume that the trees in this data set are of similar heights, so
that the height can be treated as a constant.<br />
Display the
results.</li>
</ol>
<p>Solution</p>
<p>According to my formula, the volume depends on the diameter
squared, which I include in the model thus:</p>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1129-1" data-line-number="1">volume<span class="fl">.2</span>=<span class="kw">lm</span>(volume<span class="op">~</span><span class="kw">I</span>(diameter<span class="op">^</span><span class="dv">2</span>),<span class="dt">data=</span>trees)</a>
<a class="sourceLine" id="cb1129-2" data-line-number="2"><span class="kw">summary</span>(volume<span class="fl">.2</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = volume ~ I(diameter^2), data = trees)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -29.708  -9.065  -5.722   3.032  40.816 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -30.82634   13.82243   -2.23   0.0563 .  
## I(diameter^2)   0.17091    0.01342   12.74 1.36e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 21.7 on 8 degrees of freedom
## Multiple R-squared:  0.953,  Adjusted R-squared:  0.9471 
## F-statistic: 162.2 on 1 and 8 DF,  p-value: 1.359e-06</code></pre>
<p>This adds an intercept as well, which is fine (there are technical
difficulties around removing the intercept).</p>
<p>That’s as far as I wanted you to go, but (of course) I have a few
comments.</p>
<p>The intercept here is still negative, but not significantly different
from zero, which is a step forward. The R-squared for this regression
is very similar to that from our linear model (the one for which the
intercept made no sense). So, from that point of view, either model
predicts the data well. I should look at the residuals from this one:</p>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1131-1" data-line-number="1"><span class="kw">ggplot</span>(volume<span class="fl">.2</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-115-1.png" width="672"  /></p>
<p>I really don’t think there are any problems there.</p>
<p>Now, I said to assume that the trees are all of similar height. This
seems entirely questionable, since the trees vary quite a bit in
diameter, and you would guess that trees with bigger diameter would
also be taller. It seems more plausible that the same kind of trees
(pine trees in this case) would have the same “shape”, so that if
you knew the diameter you could <em>predict</em> the height, with
larger-diameter trees being taller. Except that we don’t have the
heights here, so we can’t build a model for that.</p>
<p>So I went looking in the literature. I found this paper:
<a href="https://pdfs.semanticscholar.org/5497/3d02d63428e3dfed6645acfdba874ad80822.pdf">link</a>. This
gives several models for relationships between volume, diameter and height. In
the formulas below, there is an implied “plus error” on the right,
and the <span class="math inline">\(\alpha_i\)</span> are parameters to be estimated.</p>
<p>For predicting height from diameter (equation 1 in paper):</p>
<p><span class="math display">\[  h = \exp(\alpha_1+\alpha_2 d^{\alpha_3}) \]</span></p>
<p>For predicting volume from height and diameter (equation 6):</p>
<p><span class="math display">\[  V = \alpha_1 d^{\alpha_2} h^{\alpha_3} \]</span></p>
<p>This is a take-off on our assumption that the trees were cone-shaped,
with cone-shaped trees having <span class="math inline">\(\alpha_1=\pi/12\)</span>, <span class="math inline">\(\alpha_2=2\)</span> and
<span class="math inline">\(\alpha_3=1\)</span>. The paper uses different units, so <span class="math inline">\(\alpha_1\)</span> is not
comparable, but <span class="math inline">\(\alpha_2\)</span> and <span class="math inline">\(\alpha_3\)</span> are (as estimated from the
data in the paper, which were for longleaf pine) quite close to 2 and
1.</p>
<p>Last, the actual relationship that helps us: predicting volume from
just diameter (equation 5):</p>
<p><span class="math display">\[  V = \alpha_1 d^{\alpha_2}\]</span></p>
<p>This is a power law type of relationship. For example, if you were
willing to pretend that a tree was a cone with height proportional to
diameter (one way of getting at the idea of a bigger tree typically
being taller, instead of assuming constant height as we did), that
would imply <span class="math inline">\(\alpha_2=3\)</span> here.</p>
<p>This is non-linear as it stands, but we can bash it into shape by taking
logs:</p>
<p><span class="math display">\[
\ln V = \ln \alpha_1 + \alpha_2 \ln d
\]</span></p>
<p>so that log-volume has a linear relationship with log-diameter and we
can go ahead and estimate it:</p>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1132-1" data-line-number="1">volume<span class="fl">.3</span>=<span class="kw">lm</span>(<span class="kw">log</span>(volume)<span class="op">~</span><span class="kw">log</span>(diameter),<span class="dt">data=</span>trees)</a>
<a class="sourceLine" id="cb1132-2" data-line-number="2"><span class="kw">summary</span>(volume<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = log(volume) ~ log(diameter), data = trees)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.40989 -0.22341  0.01504  0.10459  0.53596 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    -5.9243     1.1759  -5.038    0.001 ** 
## log(diameter)   3.1284     0.3527   8.870 2.06e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.3027 on 8 degrees of freedom
## Multiple R-squared:  0.9077, Adjusted R-squared:  0.8962 
## F-statistic: 78.68 on 1 and 8 DF,  p-value: 2.061e-05</code></pre>
<p>The parameter that I called <span class="math inline">\(\alpha_2\)</span> above is the slope of this
model, 3.13. This is a bit different from the figure in the paper,
which was 2.19. I think these are comparable even though the other
parameter is not (again, measurements in different units, plus, this
time we need to take the log of it). I think the “slopes” are
comparable because we haven’t estimated our slope all that accurately:</p>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1134-1" data-line-number="1"><span class="kw">confint</span>(volume<span class="fl">.3</span>)</a></code></pre></div>
<pre><code>##                   2.5 %    97.5 %
## (Intercept)   -8.635791 -3.212752
## log(diameter)  2.315115  3.941665</code></pre>
<p>From 2.3 to 3.9. It is definitely not zero, but we are rather less
sure about what it is, and 2.19 is not completely implausible.</p>
<p>The R-squared here, though it is less than the other ones we
got, is still high. The residuals are these:</p>
<div class="sourceCode" id="cb1136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1136-1" data-line-number="1"><span class="kw">ggplot</span>(volume<span class="fl">.3</span>,<span class="kw">aes</span>(<span class="dt">x=</span>.fitted,<span class="dt">y=</span>.resid))<span class="op">+</span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="12-regression_files/figure-html/unnamed-chunk-118-1.png" width="672"  /></p>
<p>which again seem to show no problems. The residuals are smaller in
size now because of the log transformation: the actual and predicted
log-volumes are smaller numbers than the actual and predicted volumes,
so the residuals are now closer to zero.</p>
<p>Does this model behave itself at zero? Well, roughly at least: if the
diameter is very small, its log is very negative, and the predicted
log-volume is also very negative (the slope is positive). So the
predicted actual volume will be close to zero. If you want to make
that mathematically rigorous, you can take limits, but that’s the
intuition. We can also do some predictions: set up a data frame that has a column called <code>diameter</code> with some diameters to predict for:</p>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1137-1" data-line-number="1">d=<span class="kw">tibble</span>(<span class="dt">diameter=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="kw">seq</span>(<span class="dv">5</span>,<span class="dv">50</span>,<span class="dv">5</span>)))</a>
<a class="sourceLine" id="cb1137-2" data-line-number="2">d</a></code></pre></div>
<pre><code>## # A tibble: 12 x 1
##    diameter
##       &lt;dbl&gt;
##  1        1
##  2        2
##  3        5
##  4       10
##  5       15
##  6       20
##  7       25
##  8       30
##  9       35
## 10       40
## 11       45
## 12       50</code></pre>
<p>and then feed that into <code>predict</code>:</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1139-1" data-line-number="1">p=<span class="kw">predict</span>(volume<span class="fl">.3</span>,d)</a>
<a class="sourceLine" id="cb1139-2" data-line-number="2">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">pred=</span>p)</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    diameter   pred
##       &lt;dbl&gt;  &lt;dbl&gt;
##  1        1 -5.92 
##  2        2 -3.76 
##  3        5 -0.889
##  4       10  1.28 
##  5       15  2.55 
##  6       20  3.45 
##  7       25  4.15 
##  8       30  4.72 
##  9       35  5.20 
## 10       40  5.62 
## 11       45  5.98 
## 12       50  6.31</code></pre>
<p>These are predicted log-volumes, so we’d better anti-log them. <code>log</code> in R is natural logs, so this is inverted using <code>exp</code>:</p>
<div class="sourceCode" id="cb1141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1141-1" data-line-number="1">d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">pred=</span><span class="kw">exp</span>(p))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 2
##    diameter      pred
##       &lt;dbl&gt;     &lt;dbl&gt;
##  1        1   0.00267
##  2        2   0.0234 
##  3        5   0.411  
##  4       10   3.59   
##  5       15  12.8    
##  6       20  31.4    
##  7       25  63.2    
##  8       30 112.     
##  9       35 181.     
## 10       40 275.     
## 11       45 397.     
## 12       50 552.</code></pre>
<p>For a diameter near zero, the predicted volume appears to be near zero as well.</p>
<p><br></p>
<p>I mentioned <code>broom</code> earlier. We can make a data frame out of
the one-line summaries of our three models:</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1143-1" data-line-number="1"><span class="kw">bind_rows</span>(<span class="kw">glance</span>(volume<span class="fl">.1</span>),<span class="kw">glance</span>(volume<span class="fl">.2</span>),<span class="kw">glance</span>(volume<span class="fl">.3</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##   r.squared adj.r.squared  sigma statistic p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.959         0.953 20.4       185.  8.22e-7     2 -43.2  92.4  93.4 
## 2     0.953         0.947 21.7       162.  1.36e-6     2 -43.8  93.7  94.6 
## 3     0.908         0.896  0.303      78.7 2.06e-5     2  -1.12  8.25  9.16
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>(I mistakenly put <code>glimpse</code> instead of <code>glance</code> there
the first time. The former is for a quick look at a <em>data frame</em>,
while the latter is for a quick look at a <em>model</em>.)</p>
<p>The three R-squareds are all high, with the one from the third model
being a bit lower as we saw before.</p>
<p>My code is rather repetitious. There has to be a way to streamline
it. I was determined to find out how. My solution involves putting the
three models in a <code>list</code>, and then using <code>map</code> to
get the <code>glance</code> output for each one, and <code>bind_rows</code>
to glue the results together into one data frame. I was inspired to
try this by remembering that <code>map_df</code> will work for a function
like <code>glance</code> that outputs a data frame:</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1145-1" data-line-number="1">model_list=<span class="kw">list</span>(volume<span class="fl">.1</span>,volume<span class="fl">.2</span>,volume<span class="fl">.3</span>)</a>
<a class="sourceLine" id="cb1145-2" data-line-number="2"><span class="kw">map_df</span>(model_list,<span class="op">~</span><span class="kw">glance</span>(.)) </a></code></pre></div>
<pre><code>## # A tibble: 3 x 11
##   r.squared adj.r.squared  sigma statistic p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.959         0.953 20.4       185.  8.22e-7     2 -43.2  92.4  93.4 
## 2     0.953         0.947 21.7       162.  1.36e-6     2 -43.8  93.7  94.6 
## 3     0.908         0.896  0.303      78.7 2.06e-5     2  -1.12  8.25  9.16
## # ... with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>It works. You see the three R-squared values in the first column. The
third model is otherwise a lot different from the others because it
has a different response variable.</p>
<p>Other thoughts:</p>
<p>How might you measure or estimate the height of a
tree (other than by climbing it and dropping a tape measure down)? One
way, that works if the tree is fairly isolated, is to walk away from
its base. Periodically, you point at the top of the tree, and when the
angle between your arm and the ground reaches 45 degrees, you stop
walking. (If it’s greater than 45 degrees, you walk further away, and
if it’s less, you walk back towards the tree.) The distance between
you and the base of the tree is then equal to the height of the tree,
and if you have a long enough tape measure you can measure it.</p>
<p>The above works because the tangent of 45 degrees is 1. If you have a
device that will measure the actual angle,
<label for="tufte-mn-45" class="margin-toggle">⊕</label><input type="checkbox" id="tufte-mn-45" class="margin-toggle"><span class="marginnote">These days, there are apps that will let you do this with your phone. I found one called Clinometer. See also <a href="https://gabrielhemery.com/how-to-calculate-tree-height-using-a-smartphone/">link</a>.</span>
you
can be any distance away from the tree, point the device at the top,
record the angle, and do some trigonometry to estimate the height of
the tree (to which you add the height of your eyes).</p>

</div>
</div>
<p style="text-align: center;">
<a href="tidying-and-selecting-data.html"><button class="btn btn-default">Previous</button></a>
</p>
</div>
</div>



</body>
</html>
